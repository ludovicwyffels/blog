{"componentChunkName":"component---src-templates-post-tsx","path":"/node-loopback/","webpackCompilationHash":"28b74a5dec589e4586df","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY023PvUrDUBTA8ZuCtoMoOLQ4dWhN14x2kEKXFkGoohQ/QBexOHRycAidKkgHHRq69APRoTjFJYODIA6+gSBYfYMmfYLE/5VT6NALP845NyeHc9UoCHZRQvonCLKKE4ZhAXYURTsYoE9dIy5iCzfUJnEdV+RF4iu6ikFH2EPxazzOcJmg4Rnn5C8ysIEOHqTe5/sT3qXOwYOtRr5/wLAqzpCTDXu4p2ETtyjgGJ/cX+se8jeU9fa4RBt5vWENpjzdkoGPcGg4RQsbOMEFmnBRRwVDHEK/yFXfvr/CoPjvZLKcdByDyzWGeajigzorGy0oOeRJiUtITe/pX1XzDk3buIMltSFR/zTtic3060X+8z8PsEUt8G3LVQAAAABJRU5ErkJggg==","width":400,"height":128,"src":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png","srcSet":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png 1x"}}},"markdownRemark":{"html":"<p>LoopBack 4 est un framework d’API open-source pour Node.js. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d’autres.</p>\n<p>Cet article a pour but de guider les débutants à travers la documentation et d’expliquer les points cruciaux nécessaires pour commencer à construire un projet d’API LoopBack 4 maintenable.</p>\n<h2>Installation</h2>\n<p>Assurez-vous d’avoir Node.js version 8+ installé sur votre machine. Le monorepo LoopBack inclut un package CLI, qui nous aidera dans l’échafaudage de notre application LoopBack 4. Pour l’installer, exécutez la commande suivante sur votre terminal :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g @loopback/cli</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>Créer un nouveau projet</h2>\n<p>Une fois que l’outil LoopBack 4 CLI a été installé en global sur notre machine locale, nous pouvons échafauder notre application en utilisant la commande suivante :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">lb4 app</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Le terminal présentera les demandes d’entrée suivantes, que j’ai remplies ci-dessous et qui formeront la base de notre exemple d’API pour l’avenir.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">? Project name: (projects) payment-api\n? Project description: (projects) A simple Payment API\n? Project root directory: (payment-api)\n? Application class name: (PaymentApiApplication)\n? Select project build settings: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection) ... Press enter for default selection</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Après avoir parcouru l’assistant CLI ci-dessus, il créera un tas de répertoires et de fichiers boilerplate ainsi que lancera <code>npm install</code> à notre place. Nous pouvons alors naviguer dans notre répertoire nouvellement créé et démarrer l’application.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> payment-api\n<span class=\"token function\">npm</span> start</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Si tout s’est bien déroulé, vous devriez voir le résultat suivant :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Server is running at http://127.0.0.1:3000\nTry http://127.0.0.1:3000/ping</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Le projet expose un simple endpoint <strong>GET</strong> <em>/ping</em>. Ce qui n’est pas clair dans la sortie du terminal, ou dans la documentation de démarrage, c’est que l’application LoopBack 4 expose également un endpoint qui rendra la documentation OpenAPI Spec. Pour y accéder, il vous suffit d’ouvrir votre navigateur et d’aller à l’url suivante : <a href=\"http://localhost:3000/swagger-ui\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/swagger-ui</a>.</p>\n<p><img src=\"\" alt=\"LoopBack 4 OpenAPI\"></p>\n<p>Cette fonctionnalité permet aux développeurs d’API de documenter facilement leurs services Web au fur et à mesure que le code est écrit et de tester les endpoints d’une manière conviviale.</p>\n<h2>Exploration de l’expression standard</h2>\n<p>Le LoopBack CLI crée beaucoup de fichiers et de dossiers pour nous. Réduisons le bruit et concentrons-nous sur les éléments dont nous avons besoin pour mettre en place et faire fonctionner un nouveau endpoint.</p>\n<p><img src=\"\" alt=\"LoopBack 4 Structure du projet\"></p>\n<p>Un fichier <strong>ping.controller.ts</strong> initial est créé pour nous. C’est la convention de nommage par défaut que l’application LoopBack applique par configuration, qui peut être modifiée dans le fichier <strong>application.ts</strong> et qui sera explorée dans de futurs articles.</p>\n<p>Après avoir ouvert le fichier <strong>ping.controller.ts</strong>, nous pouvons voir que le code utilise des décorateurs TypeScript pour fournir des métadonnées HTTP à la fonction ping() TypeScript dans la classe PingController.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\">@<span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/ping'</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Ce décorateur permet à l’application LoopBack de savoir que toute requête HTTP GET doit invoquer la fonction <code>ping()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n  greeting<span class=\"token punctuation\">:</span> <span class=\"token string\">'Hello from LoopBack'</span><span class=\"token punctuation\">,</span>\n  date<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  url<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span>\n  headers<span class=\"token punctuation\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>La fonction <code>ping()</code> renvoie un objet JSON simple. L’application LoopBack s’occupe de la sérialisation automatique des données de réponse, qui est dans ce cas JSON.</p>\n<p>Création d’un nouveau Endpoint\nUn nouveau point final peut être créé en écrivant une nouvelle fonction décorée sur le PingController dans le fichier ping.controller.ts en se référant à la fonction ping() existante. LoopBack nous permet également de créer facilement de nouveaux contrôleurs en utilisant le CLI :</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">lb4 controller\n? Controller class name: Payment\n? What kind of controller would you like to generate? (Use arrow keys)\n&gt; Empty Controller\n  REST Controller with CRUD functions</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Afin d’utiliser le contrôleur REST avec l’option de fonctions CRUD, nous devons d’abord avoir un <strong>référentiel</strong> que nous examinerons dans les prochains articles.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PaymentController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Si nous exécutons notre serveur avec npm, démarrez et rafraîchissez notre navigateur OpenAPI, remarquez qu’il n’y a pas encore de mention d’un PaymentController. C’est parce que nous n’avons pas encore mappé de fonctions aux chemins HTTP pour l’application LoopBack à documenter en utilisant les spécifications OpenAPI.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\">@<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/payments'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pay</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> payment<span class=\"token punctuation\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Object <span class=\"token punctuation\">{</span>\n  payment<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> payment<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Une fonction appelée paye accepte un seul paramètre paiement de type <code>any</code> et retourne un <code>Object</code>. Nous utilisons deux décorateurs :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\">@<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/payments'</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Ce qui dit à LoopBack de mapper la fonction <code>pay()</code> à une méthode HTTP POST sur les requêtes entrantes <code>/payments</code> et</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\">@<span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>qui indique à LoopBack de mapper le corps de requête HTTP POST au paramètre de paiement de la fonction <code>pay()</code>. LoopBack analysera automatiquement le corps de requête HTTP JSON en fonction du type requis, ce qui est le cas dans ce cas.</p>\n<p>En réexécutant le serveur (<code>npm start</code>) et en rafraîchissant le navigateur OpenAPI Spec, le <em>PaymentController</em> sera présent avec un endpoint POST /payments.</p>\n<p><img src=\"\" alt=\"PaymentController - POST /payments\"></p>\n<p>Le navigateur OpenAPI Spec affiche les paramètres disponibles que nous pouvons utiliser pour interagir avec l’API, qui est juste un corps de requête HTTP pour le moment. Nous pouvons tester ce endpoint en appuyant sur le bouton “Try it out” en haut à droite.</p>\n<p><img src=\"\" alt=\"Test POST /payments\"></p>\n<p>La <em>valeur d’exemple</em> a été initialisée avec un objet JSON vide. Ce n’est pas très utile, car cela ne communique pas les valeurs attendues par le endpoint. Grâce à des normes REST simples, nous pouvons établir que nous pouvons probablement utiliser ce endpoint pour effectuer un paiement, mais quelles sont les propriétés exactes que nous pouvons transmettre ici? Valeur? Devise? Montant?</p>\n<h2>Paramètres du document à l’aide des définitions de modèle</h2>\n<p>Dans LoopBack 3.x, tout était piloté par un modèle, qui était un simple fichier de configuration JSON décrivant les propriétés du modèle et leurs types.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Payment\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"base\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PersistedModel\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"validateUpsert\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"mysql\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"table\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"payment\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"paymentId\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"required\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"defaultFn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"uuid\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"mysql\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"columnName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"payment_id\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"amount\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"number\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"required\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"mysql\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"columnName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"amount\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"createdOn\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"defaultFn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"now\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"mysql\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"columnName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"created_on\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"updatedOn\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"mysql\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"columnName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"updated_on\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"validations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"relations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"acls\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"methods\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Les fichiers de définition de modèle permettaient également aux développeurs de spécifier si le modèle était persistant ou non et de mapper les propriétés JSON sur des colonnes spécifiques aux bases de données (si nécessaire). Le fichier permettait également de configurer des validations, des relations, des acls (Access Control Lists) et des méthodes à distance.</p>\n<p>LoopBack 4 a pour but de découpler beaucoup de ces éléments afin de permettre une plus grande flexibilité. Nous pouvons toutefois réutiliser une grande partie de la structure syntaxique des métadonnées dans LoopBack 4, en conséquence.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> property<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> Model <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@loopback/repository'</span><span class=\"token punctuation\">;</span>\n@<span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PaymentRequest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">,</span>\n    required<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  amount<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  @<span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\n    required<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  status<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Nous utilisons la classe <code>Model</code> ci-dessus pour déclarer que la classe <code>PaymentRequest</code> n’est pas persistante, car elle n’est pas conforme à l’interface <code>Persistable</code> (qui se trouve dans le paquet LoopBack Repository). La classe <code>Entity</code>, utilisée dans les articles ultérieurs, implémente l’interface <code>Persistable</code> et inclut une fonction qui est utilisée pour définir quelle propriété détermine son caractère unique, c’est-à-dire qu’elle a un identifiant unique et peut être stockée/persistée dans une source de données (Data Source).</p>\n<p>La classe <code>PaymentRequest</code> est utilisée pour modéliser les données de notre module POST /payments HTTP Request.</p>\n<p>Le décorateur <code>@model()</code> peut être utilisé pour inclure des métadonnées supplémentaires pour le modèle. Dans ce cas, il est juste utilisé pour faire savoir à LoopBack qu’il s’agit d’un modèle et qu’il doit être utilisé pour rendre la documentation dans la spécification OpenAPI.</p>\n<p>Le décorateur <code>@property</code> est utilisé pour fournir des métadonnées supplémentaires aux propriétés individuelles de notre modèle. Ces métadonnées permettent d’afficher les propriétés dans les fichiers de définition de modèle LoopBack 3 et leur but principal est de permettre aux spécifications OpenAPI de documenter facilement les propriétés ainsi que les propriétés de mapper aux noms de colonnes spécifiques à la base de données.</p>\n<p>Nous pouvons utiliser cette classe de modèle comme type de paramètre dans la fonction <em>PaymentController#pay</em> :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ts line-numbers\"><code class=\"language-ts\">@<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/payments'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pay</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> payment<span class=\"token punctuation\">:</span> PaymentRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Object <span class=\"token punctuation\">{</span>\n  payment<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> payment<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Avec une classe TypeScript spécifique utilisée comme type de paramètre, LoopBack peut maintenant fournir des détails supplémentaires à la spécification OpenAPI et notre navigateur rend maintenant ce qui suit (après avoir redémarré le serveur et actualisé la page):</p>\n<p><img src=\"\" alt=\"POST /payments Documentation Request Body\"></p>\n<p>Nos développeurs frontaux peuvent maintenant facilement lire la documentation interactive et commencer à intégrer leurs applications avec un minimum d’effort.</p>\n<p>L’exécution de cette opération après avoir appuyé sur le bouton “Try it out” et modifié certains des paramètres permet d’obtenir un code de réponse HTTP 200 avec le corps de réponse JSON suivant:</p>\n<p><img src=\"\" alt=\"200 Success\"></p>\n<p>Nous avons changé la propriété de statut à “succès” dans la fonction pay() plus tôt, ce qui est vu dans la sortie JSON ci-dessus.</p>\n<h2>Conclusion</h2>\n<p>Cet article a introduit LoopBack 4 en échafaudant une API de paiement simple par l’intermédiaire du CLI. Nous avons examiné à quel point il est facile de documenter et de tester les endpoints de l’API à l’aide des spécifications OpenAPI intégrées en utilisant les contrôleurs LoopBack 4 et les fonctions TypeScript décorées. Enfin, nous avons exploré l’évolution des fichiers de définition de modèle LoopBack 2/3 en détail.</p>\n<p>LoopBack 4 est toujours en cours de développement, avec de nombreuses nouvelles fonctionnalités construites par l’impressionnante communauté open-source. Dans les articles suivants, nous les explorerons tous plus en détail au fur et à mesure que nous construirons notre API de paiement simple.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LoopBack 4 est un framework d’API open-source pour Node.js. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d’autres."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cet article a pour but de guider les débutants à travers la documentation et d’expliquer les points cruciaux nécessaires pour commencer à construire un projet d’API LoopBack 4 maintenable."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Assurez-vous d’avoir Node.js version 8+ installé sur votre machine. Le monorepo LoopBack inclut un package CLI, qui nous aidera dans l’échafaudage de notre application LoopBack 4. Pour l’installer, exécutez la commande suivante sur votre terminal :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" -g @loopback/cli"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Créer un nouveau projet"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Une fois que l’outil LoopBack 4 CLI a été installé en global sur notre machine locale, nous pouvons échafauder notre application en utilisant la commande suivante :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"lb4 app"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le terminal présentera les demandes d’entrée suivantes, que j’ai remplies ci-dessous et qui formeront la base de notre exemple d’API pour l’avenir."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"? Project name: (projects) payment-api\n? Project description: (projects) A simple Payment API\n? Project root directory: (payment-api)\n? Application class name: (PaymentApiApplication)\n? Select project build settings: (Press <space> to select, <a> to toggle all, <i> to invert selection) ... Press enter for default selection"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Après avoir parcouru l’assistant CLI ci-dessus, il créera un tas de répertoires et de fichiers boilerplate ainsi que lancera "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm install"}]},{"type":"text","value":" à notre place. Nous pouvons alors naviguer dans notre répertoire nouvellement créé et démarrer l’application."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"cd"}]},{"type":"text","value":" payment-api\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" start"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si tout s’est bien déroulé, vous devriez voir le résultat suivant :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Server is running at http://127.0.0.1:3000\nTry http://127.0.0.1:3000/ping"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le projet expose un simple endpoint "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"GET"}]},{"type":"text","value":" "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"/ping"}]},{"type":"text","value":". Ce qui n’est pas clair dans la sortie du terminal, ou dans la documentation de démarrage, c’est que l’application LoopBack 4 expose également un endpoint qui rendra la documentation OpenAPI Spec. Pour y accéder, il vous suffit d’ouvrir votre navigateur et d’aller à l’url suivante : "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000/swagger-ui","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:3000/swagger-ui"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"LoopBack 4 OpenAPI"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cette fonctionnalité permet aux développeurs d’API de documenter facilement leurs services Web au fur et à mesure que le code est écrit et de tester les endpoints d’une manière conviviale."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Exploration de l’expression standard"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le LoopBack CLI crée beaucoup de fichiers et de dossiers pour nous. Réduisons le bruit et concentrons-nous sur les éléments dont nous avons besoin pour mettre en place et faire fonctionner un nouveau endpoint."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"LoopBack 4 Structure du projet"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Un fichier "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ping.controller.ts"}]},{"type":"text","value":" initial est créé pour nous. C’est la convention de nommage par défaut que l’application LoopBack applique par configuration, qui peut être modifiée dans le fichier "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"application.ts"}]},{"type":"text","value":" et qui sera explorée dans de futurs articles."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Après avoir ouvert le fichier "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ping.controller.ts"}]},{"type":"text","value":", nous pouvons voir que le code utilise des décorateurs TypeScript pour fournir des métadonnées HTTP à la fonction ping() TypeScript dans la classe PingController."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"get"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'/ping'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ce décorateur permet à l’application LoopBack de savoir que toute requête HTTP GET doit invoquer la fonction "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ping()"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  greeting"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Hello from LoopBack'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  date"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Date"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  url"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"req"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"url"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  headers"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Object"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"assign"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"req"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"headers"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La fonction "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ping()"}]},{"type":"text","value":" renvoie un objet JSON simple. L’application LoopBack s’occupe de la sérialisation automatique des données de réponse, qui est dans ce cas JSON."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Création d’un nouveau Endpoint\nUn nouveau point final peut être créé en écrivant une nouvelle fonction décorée sur le PingController dans le fichier ping.controller.ts en se référant à la fonction ping() existante. LoopBack nous permet également de créer facilement de nouveaux contrôleurs en utilisant le CLI :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"txt"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-txt","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-txt"]},"children":[{"type":"text","value":"lb4 controller\n? Controller class name: Payment\n? What kind of controller would you like to generate? (Use arrow keys)\n> Empty Controller\n  REST Controller with CRUD functions"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Afin d’utiliser le contrôleur REST avec l’option de fonctions CRUD, nous devons d’abord avoir un "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"référentiel"}]},{"type":"text","value":" que nous examinerons dans les prochains articles."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PaymentController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si nous exécutons notre serveur avec npm, démarrez et rafraîchissez notre navigateur OpenAPI, remarquez qu’il n’y a pas encore de mention d’un PaymentController. C’est parce que nous n’avons pas encore mappé de fonctions aux chemins HTTP pour l’application LoopBack à documenter en utilisant les spécifications OpenAPI."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"post"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'/payments'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"pay"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"requestBody"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin"]},"children":[{"type":"text","value":"any"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Object "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"status "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"success\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Une fonction appelée paye accepte un seul paramètre paiement de type "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"any"}]},{"type":"text","value":" et retourne un "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Object"}]},{"type":"text","value":". Nous utilisons deux décorateurs :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"post"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'/payments'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ce qui dit à LoopBack de mapper la fonction "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pay()"}]},{"type":"text","value":" à une méthode HTTP POST sur les requêtes entrantes "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"/payments"}]},{"type":"text","value":" et"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"requestBody"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"qui indique à LoopBack de mapper le corps de requête HTTP POST au paramètre de paiement de la fonction "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pay()"}]},{"type":"text","value":". LoopBack analysera automatiquement le corps de requête HTTP JSON en fonction du type requis, ce qui est le cas dans ce cas."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"En réexécutant le serveur ("},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm start"}]},{"type":"text","value":") et en rafraîchissant le navigateur OpenAPI Spec, le "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"PaymentController"}]},{"type":"text","value":" sera présent avec un endpoint POST /payments."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"PaymentController - POST /payments"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le navigateur OpenAPI Spec affiche les paramètres disponibles que nous pouvons utiliser pour interagir avec l’API, qui est juste un corps de requête HTTP pour le moment. Nous pouvons tester ce endpoint en appuyant sur le bouton “Try it out” en haut à droite."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"Test POST /payments"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"valeur d’exemple"}]},{"type":"text","value":" a été initialisée avec un objet JSON vide. Ce n’est pas très utile, car cela ne communique pas les valeurs attendues par le endpoint. Grâce à des normes REST simples, nous pouvons établir que nous pouvons probablement utiliser ce endpoint pour effectuer un paiement, mais quelles sont les propriétés exactes que nous pouvons transmettre ici? Valeur? Devise? Montant?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Paramètres du document à l’aide des définitions de modèle"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dans LoopBack 3.x, tout était piloté par un modèle, qui était un simple fichier de configuration JSON décrivant les propriétés du modèle et leurs types."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"json"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-json","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"name\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Payment\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"base\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"PersistedModel\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"options\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"validateUpsert\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"mysql\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"table\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"payment\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"properties\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"paymentId\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"string\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"id\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"required\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"defaultFn\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"uuid\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"mysql\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"columnName\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"payment_id\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"amount\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"number\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"required\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"mysql\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"columnName\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"amount\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"createdOn\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"date\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"defaultFn\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"now\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"mysql\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"columnName\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"created_on\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"updatedOn\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"date\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"mysql\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"columnName\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"updated_on\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"validations\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"relations\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"acls\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"methods\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Les fichiers de définition de modèle permettaient également aux développeurs de spécifier si le modèle était persistant ou non et de mapper les propriétés JSON sur des colonnes spécifiques aux bases de données (si nécessaire). Le fichier permettait également de configurer des validations, des relations, des acls (Access Control Lists) et des méthodes à distance."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LoopBack 4 a pour but de découpler beaucoup de ces éléments afin de permettre une plus grande flexibilité. Nous pouvons toutefois réutiliser une grande partie de la structure syntaxique des métadonnées dans LoopBack 4, en conséquence."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" property"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Model "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'@loopback/repository'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"model"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PaymentRequest"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"extends"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  @"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"property"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'number'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    required"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin"]},"children":[{"type":"text","value":"number"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n  @"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"property"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'string'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    required"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  status"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin"]},"children":[{"type":"text","value":"string"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous utilisons la classe "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" ci-dessus pour déclarer que la classe "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"PaymentRequest"}]},{"type":"text","value":" n’est pas persistante, car elle n’est pas conforme à l’interface "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Persistable"}]},{"type":"text","value":" (qui se trouve dans le paquet LoopBack Repository). La classe "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Entity"}]},{"type":"text","value":", utilisée dans les articles ultérieurs, implémente l’interface "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Persistable"}]},{"type":"text","value":" et inclut une fonction qui est utilisée pour définir quelle propriété détermine son caractère unique, c’est-à-dire qu’elle a un identifiant unique et peut être stockée/persistée dans une source de données (Data Source)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La classe "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"PaymentRequest"}]},{"type":"text","value":" est utilisée pour modéliser les données de notre module POST /payments HTTP Request."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le décorateur "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"@model()"}]},{"type":"text","value":" peut être utilisé pour inclure des métadonnées supplémentaires pour le modèle. Dans ce cas, il est juste utilisé pour faire savoir à LoopBack qu’il s’agit d’un modèle et qu’il doit être utilisé pour rendre la documentation dans la spécification OpenAPI."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le décorateur "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"@property"}]},{"type":"text","value":" est utilisé pour fournir des métadonnées supplémentaires aux propriétés individuelles de notre modèle. Ces métadonnées permettent d’afficher les propriétés dans les fichiers de définition de modèle LoopBack 3 et leur but principal est de permettre aux spécifications OpenAPI de documenter facilement les propriétés ainsi que les propriétés de mapper aux noms de colonnes spécifiques à la base de données."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous pouvons utiliser cette classe de modèle comme type de paramètre dans la fonction "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"PaymentController#pay"}]},{"type":"text","value":" :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-ts","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"post"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'/payments'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"pay"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"@"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"requestBody"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PaymentRequest"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Object "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"status "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"success\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" payment"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Avec une classe TypeScript spécifique utilisée comme type de paramètre, LoopBack peut maintenant fournir des détails supplémentaires à la spécification OpenAPI et notre navigateur rend maintenant ce qui suit (après avoir redémarré le serveur et actualisé la page):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"POST /payments Documentation Request Body"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nos développeurs frontaux peuvent maintenant facilement lire la documentation interactive et commencer à intégrer leurs applications avec un minimum d’effort."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L’exécution de cette opération après avoir appuyé sur le bouton “Try it out” et modifié certains des paramètres permet d’obtenir un code de réponse HTTP 200 avec le corps de réponse JSON suivant:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"","alt":"200 Success"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous avons changé la propriété de statut à “succès” dans la fonction pay() plus tôt, ce qui est vu dans la sortie JSON ci-dessus."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Conclusion"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cet article a introduit LoopBack 4 en échafaudant une API de paiement simple par l’intermédiaire du CLI. Nous avons examiné à quel point il est facile de documenter et de tester les endpoints de l’API à l’aide des spécifications OpenAPI intégrées en utilisant les contrôleurs LoopBack 4 et les fonctions TypeScript décorées. Enfin, nous avons exploré l’évolution des fichiers de définition de modèle LoopBack 2/3 en détail."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LoopBack 4 est toujours en cours de développement, avec de nombreuses nouvelles fonctionnalités construites par l’impressionnante communauté open-source. Dans les articles suivants, nous les explorerons tous plus en détail au fur et à mesure que nous construirons notre API de paiement simple."}]}],"data":{"quirksMode":false}},"excerpt":"LoopBack 4 est un framework d’API open-source pour Node.js. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d’autres. Cet article a pour but de guider les débutants à travers la documentation et d’expliquer les points cruciaux nécessaires pour commencer à construire un projet d’API LoopBack 4 maintenable. Installation Assurez-vous d’avoir Node.js version 8+ installé sur votre machine. Le monorepo LoopBack inclut un package CLI, qui nous aidera dans l’échafaudage de notre application LoopBack 4. Pour l’installer, exécutez la commande suivante sur votre terminal : Créer un nouveau projet Une fois que l’outil LoopBack 4 CLI a été installé en global sur notre machine locale, nous pouvons échafauder notre application en utilisant la commande suivante : Le terminal présentera les demandes d’entrée suivantes, que j’ai remplies ci-dessous et qui formeront la base de notre exemple d’API pour l’avenir. Après avoir parcouru l’assistant CLI ci-dessus, il créera un tas de répertoires et de fichiers boilerplate ainsi que lancera npm install à notre place. Nous pouvons alors naviguer dans notre répertoire nouvellement créé et démarrer l’application. Si tout s’est bien déroulé, vous devriez voir le résultat suivant : Le projet expose un simple endpoint GET /ping. Ce qui n’est pas clair dans la sortie du terminal, ou dans la documentation de démarrage, c’est que l’application LoopBack 4 expose également un endpoint qui rendra la documentation OpenAPI Spec. Pour y accéder, il vous suffit d’ouvrir votre navigateur et d’aller à l’url suivante : http://localhost:3000/swagger-ui. LoopBack 4 OpenAPI Cette fonctionnalité permet aux développeurs d’API de documenter facilement leurs services Web au fur et à mesure que le code est écrit et de tester les endpoints d’une manière conviviale. Exploration de l’expression standard Le LoopBack CLI crée beaucoup de fichiers et de dossiers pour nous. Réduisons le bruit et concentrons-nous sur les éléments dont nous avons besoin pour mettre en place et faire fonctionner un nouveau endpoint. LoopBack 4 Structure du projet Un fichier ping.controller.ts initial est créé pour nous. C’est la convention de nommage par défaut que l’application LoopBack applique par configuration, qui peut être modifiée dans le fichier application.ts et qui sera explorée dans de futurs articles. Après avoir ouvert le fichier ping.controller.ts, nous pouvons voir que le code utilise des décorateurs TypeScript pour fournir des métadonnées HTTP à la fonction ping() TypeScript dans la classe PingController. Ce décorateur permet à l’application LoopBack de savoir que toute requête HTTP GET doit invoquer la fonction ping(). La fonction ping() renvoie un objet JSON simple. L’application LoopBack s’occupe de la sérialisation automatique des données de réponse, qui est dans ce cas JSON. Création d’un nouveau Endpoint\nUn nouveau point final peut être créé en écrivant une nouvelle fonction décorée sur le PingController dans le fichier ping.controller.ts en se référant à la fonction ping() existante. LoopBack nous permet également de créer facilement de nouveaux contrôleurs en utilisant le CLI : Afin d’utiliser le contrôleur REST avec l’option de fonctions CRUD, nous devons d’abord avoir un référentiel que nous examinerons dans les prochains articles. Si nous exécutons notre serveur avec npm, démarrez et rafraîchissez notre navigateur OpenAPI, remarquez qu’il n’y a pas encore de mention d’un PaymentController. C’est parce que nous n’avons pas encore mappé de fonctions aux chemins HTTP pour l’application LoopBack à documenter en utilisant les spécifications OpenAPI. Une fonction appelée paye accepte un seul paramètre paiement de type any et retourne un Object. Nous utilisons deux décorateurs : Ce qui dit à LoopBack de mapper la fonction pay() à une méthode HTTP POST sur les requêtes entrantes /payments et qui indique à LoopBack de mapper le corps de requête HTTP POST au paramètre de paiement de la fonction pay(). LoopBack analysera automatiquement le corps de requête HTTP JSON en fonction du type requis, ce qui est le cas dans ce cas. En réexécutant le serveur (npm start) et en rafraîchissant le navigateur OpenAPI Spec, le PaymentController sera présent avec un endpoint POST /payments. PaymentController - POST /payments Le navigateur OpenAPI Spec affiche les paramètres disponibles que nous pouvons utiliser pour interagir avec l’API, qui est juste un corps de requête HTTP pour le moment. Nous pouvons tester ce endpoint en appuyant sur le bouton “Try it out” en haut à droite. Test POST /payments La valeur d’exemple a été initialisée avec un objet JSON vide. Ce n’est pas très utile, car cela ne communique pas les valeurs attendues par le endpoint. Grâce à des normes REST simples, nous pouvons établir que nous pouvons probablement utiliser ce endpoint pour effectuer un paiement, mais quelles sont les propriétés exactes que nous pouvons transmettre ici? Valeur? Devise? Montant? Paramètres du document à l’aide des définitions de modèle Dans LoopBack 3.x, tout était piloté par un modèle, qui était un simple fichier de configuration JSON décrivant les propriétés du modèle et leurs types. Les fichiers de définition de modèle permettaient également aux développeurs de spécifier si le modèle était persistant ou non et de mapper les propriétés JSON sur des colonnes spécifiques aux bases de données (si nécessaire). Le fichier permettait également de configurer des validations, des relations, des acls (Access Control Lists) et des méthodes à distance. LoopBack 4 a pour but de découpler beaucoup de ces éléments afin de permettre une plus grande flexibilité. Nous pouvons toutefois réutiliser une grande partie de la structure syntaxique des métadonnées dans LoopBack 4, en conséquence. Nous utilisons la classe Model ci-dessus pour déclarer que la classe PaymentRequest n’est pas persistante, car elle n’est pas conforme à l’interface Persistable (qui se trouve dans le paquet LoopBack Repository). La classe Entity, utilisée dans les articles ultérieurs, implémente l’interface Persistable et inclut une fonction qui est utilisée pour définir quelle propriété détermine son caractère unique, c’est-à-dire qu’elle a un identifiant unique et peut être stockée/persistée dans une source de données (Data Source). La classe PaymentRequest est utilisée pour modéliser les données de notre module POST /payments HTTP Request. Le décorateur @model() peut être utilisé pour inclure des métadonnées supplémentaires pour le modèle. Dans ce cas, il est juste utilisé pour faire savoir à LoopBack qu’il s’agit d’un modèle et qu’il doit être utilisé pour rendre la documentation dans la spécification OpenAPI. Le décorateur @property est utilisé pour fournir des métadonnées supplémentaires aux propriétés individuelles de notre modèle. Ces métadonnées permettent d’afficher les propriétés dans les fichiers de définition de modèle LoopBack 3 et leur but principal est de permettre aux spécifications OpenAPI de documenter facilement les propriétés ainsi que les propriétés de mapper aux noms de colonnes spécifiques à la base de données. Nous pouvons utiliser cette classe de modèle comme type de paramètre dans la fonction PaymentController#pay : Avec une classe TypeScript spécifique utilisée comme type de paramètre, LoopBack peut maintenant fournir des détails supplémentaires à la spécification OpenAPI et notre navigateur rend maintenant ce qui suit (après avoir redémarré le serveur et actualisé la page): POST /payments Documentation Request Body Nos développeurs frontaux peuvent maintenant facilement lire la documentation interactive et commencer à intégrer leurs applications avec un minimum d’effort. L’exécution de cette opération après avoir appuyé sur le bouton “Try it out” et modifié certains des paramètres permet d’obtenir un code de réponse HTTP 200 avec le corps de réponse JSON suivant: 200 Success Nous avons changé la propriété de statut à “succès” dans la fonction pay() plus tôt, ce qui est vu dans la sortie JSON ci-dessus. Conclusion Cet article a introduit LoopBack 4 en échafaudant une API de paiement simple par l’intermédiaire du CLI. Nous avons examiné à quel point il est facile de documenter et de tester les endpoints de l’API à l’aide des spécifications OpenAPI intégrées en utilisant les contrôleurs LoopBack 4 et les fonctions TypeScript décorées. Enfin, nous avons exploré l’évolution des fichiers de définition de modèle LoopBack 2/3 en détail. LoopBack 4 est toujours en cours de développement, avec de nombreuses nouvelles fonctionnalités construites par l’impressionnante communauté open-source. Dans les articles suivants, nous les explorerons tous plus en détail au fur et à mesure que nous construirons notre API de paiement simple.","timeToRead":7,"frontmatter":{"title":"Premiers pas avec LoopBack 4","subtitle":"LoopBack 4 est un framework d'API open-source. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d'autres.","userDate":"29 June 2019","date":"2019-06-29T08:00:00.000Z","tags":["LoopBack","Node.js"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAd2qFGs6KLKpA6D/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADERAS/9oACAEBAAEFAmYKBaNltZY+S8UYvf/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABcRAQADAAAAAAAAAAAAAAAAAAIBESD/2gAIAQIBAT8Bgmsf/8QAIBAAAgEBCQAAAAAAAAAAAAAAAREAAhASICExQVFhcf/aAAgBAQAGPwJmIg0+2MLTeZPu8IBxg//EABsQAAICAwEAAAAAAAAAAAAAAAERACEQIDGx/9oACAEBAAE/IWZQhjIPFTxZdwoB1CpF5SyGi0//2gAMAwEAAgADAAAAEGfvAP/EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPxBW4//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBHh/9oACAECAQE/EGaXkb//xAAeEAEBAAEEAwEAAAAAAAAAAAABESEAMUFhECBxwf/aAAgBAQABPxBSMi50HycxA+/j4mbfQaZtJz1qYZEiAUiAeB2k71ltDTzCen//2Q==","aspectRatio":1,"src":"/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg","srcSet":"/static/9611cacec962506545385f22b26d913d/f8f18/loopback.jpg 930w,\n/static/9611cacec962506545385f22b26d913d/0e6ff/loopback.jpg 1860w,\n/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"author":{"id":"ludo","name":"Wyffels Ludovic","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQ4y2MwsXf5T03MMGogGBvbOYNpUwdXOIbJwdgwNQQNhCk0snX6r2thC8Y6QGxg7QCWA/FBcrgMxepCkAZrV6//EYmpYBydkvHfMzjiv5mj2//whJT/Nm7ecEMJGgjykp6V/f+AqLj/O/Ye+L8diA8dO/m/pbv/v72n3/+tu/f9D45N/K9naYcSFESFoRXQlSCX2rh7g/kgr1u5epIWhiAMCi/3wLD/fVNn/u+fNgtMT5g+6//kmXOB/Jn/PYLCwWrINnDijDlAPBvKJ8NAZC+DIgCkGYRBbJAYSV5GjpTte/b/PwiMkLj0nP8xqVn/Dxw9AY6kwOh40iIFlmzCgUkmKjnjvx0wdu08fMFskJi1mxfxyQY9YetAEzJyQic5YaNnPeTgIDnrjZaHJGMACtTMXoVAJ6sAAAAASUVORK5CYII=","width":400,"height":400,"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png","srcSet":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png 1x"}}]}}}},"relatedPosts":{"totalCount":2,"edges":[{"node":{"id":"c1ba20f7-8208-596e-94fa-0f678722da77","timeToRead":11,"excerpt":"Introduction Presque toutes les applications Web ont besoin de conserver des données sous une forme ou une autre. LoopBack a toujours abstrait le moteur de base de données de l’application en nous fournissant plusieurs connecteurs à utiliser, tels que : MySQL, Postgres et In-memory. LoopBack 4 utilise les mêmes bibliothèques sous-jacentes que LoopBack 3 pour passer la configuration aux moteurs. Cependant, les structures du projet sont légèrement différentes, comme indiqué ci-dessous. Configuration de LoopBack 3 Dans LoopBack 3, vous définiriez un ensemble d’objets JSON à l’intérieur d’un fichier datasources.json stocké dans le dossier serveur, ce qui permettrait à l’application de récupérer la configuration. Le fichier ressemblerait à ceci : Ce fichier définit une nouvelle source de données appelée “db”, qui est configurée pour utiliser le connecteur de base de données en mémoire. Dans la plupart des applications, c’est une excellente source de données par défaut pour les modèles, car elle élimine le besoin de configurer un serveur de base de données lors du premier démarrage avec un prototype. Vous pouvez simplement configurer les modèles pour utiliser la source de données “db” et continuer avec le code. Le fichier model-config.json, dans le même dossier, relierait un modèle à une source de données et ressemblerait à ceci : Une fois que vous avez la base de votre application en place et en cours d’exécution par rapport à la configuration de la base de données en mémoire, vous pouvez vous concentrer sur la configuration d’un serveur de base de données, tel que MySQL ou Postgres, installer le bon connecteur et simplement modifier la configuration datasources.json comme suit : C’est excellent pour le développement local. Mais, lorsque vous travaillez au sein d’une équipe plus importante ou avec plusieurs environnements, un seul fichier de configuration JSON ne va pas le couper. LoopBack 3 a résolu la configuration spécifique à l’environnement en nous permettant de créer des fichiers de sources de données spécifiques à l’environnement. Le nom du fichier de source de données spécifique à l’environnement devait être dans une certaine structure : datasources.<environment>.js. Un projet avec 3 environnements aurait les fichiers suivants : datasources.json (une configuration de serveur de base de données locale) datasources.test.js (une configuration de serveur de base de données de test) datasources.production.js (une configuration de serveur de base de données de production) La version JavaScript du fichier de configuration nous a donné une flexibilité supplémentaire, car nous avons pu déterminer la configuration à l’aide de code. Le fichier de configuration le plus courant utilise les variables d’environnement système. Un exemple de fichier de configuration d’une source de données de production serait le suivant : C’est génial, car cela élimine le besoin de stocker les références de production dans notre code. Nous pourrions livrer ces fichiers de configuration et configurer la configuration sur le serveur, en toute sécurité. Par défaut, le framework utiliserait la variable d’environnement système NODE_ENV pour choisir le fichier source à utiliser. Un serveur de production aurait les variables d’environnement suivantes : NODE_ENV=production DB_HOST=aws-rds-mysql-host.example.com DB_PORT=3306 DB_USER=super-secret-user DB_PASSWORD=super-secret-password DBDATABASE=appdatabase Configuration LoopBack 4 LoopBack 4 ne lit plus automatiquement les fichiers de configuration des sources de données. Au lieu de cela, le framework nous laisse décider comment nous voulons configurer notre application. Pour l’instant, il ne semble pas qu’il existe de meilleures pratiques documentées pour la mise en place d’un tel système. Une approche est suggérée ci-dessous. Dépendance Injection Avant de nous plonger dans la configuration de la base de données, nous devons comprendre l’un des concepts clés de LoopBack 4 : Injection de dépendance. Essentiellement, l’application peut enregistrer des valeurs sur une liste de clés uniques. Ces valeurs peuvent contenir des variables normales ou des définitions de classes, que l’application peut ensuite utiliser pour gérer la création de ces objets pour nous, en reprenant les dépendances requises. Par exemple, on peut enregistrer une valeur,‘bar’ sur une clé ‘foo’. Maintenant l’application sait que la clé ‘foo’, contient la valeur ‘bar’. Nous pouvons demander cette valeur à partir de l’application n’importe où dans notre code. À titre d’exemple : En plus de lier une valeur à une clé, nous pouvons lier une classe à une clé et laisser l’application calculer récursivement ses dépendances lors de l’instanciation de l’objet sur demande. Quand nous demandons une instance de la classe Foo, comme suit: Le conteneur d’application verra que la classe Foo dépend de la valeur de la barre. Il le recherchera dans le conteneur de dépendances, le trouvera (s’il est lié) et l’injectera ensuite dans la classe. D’où l’injection de dépendance. Créer un nouveau projet On peut utiliser la CLI pour créer un nouveau projet en appelant la commande suivante : LoopBack 4 ajoute un dossier datasources au projet. Initialement, on supposerait que ce dossier est configuré pour être lu de la même manière que les fichiers JSON des sources de données LoopBack 3. Cependant, c’est juste le dossier par défaut utilisé par le CLI pour y déposer les nouveaux fichiers. Ajout d’une source de données à l’aide de l’interface CLI Utilisez le CLI pour créer une nouvelle source de données en exécutant la commande suivante : La première chose que vous remarquerez est que le fichier db.datasource.json est exactement le même que le fichier LoopBack 3 datasources.json. Dans l’assistant CLI, j’ai choisi le connecteur en mémoire, qui est l’un des nombreux connecteurs disponibles dans LoopBack 3 et LoopBack 4. Le nouvel ajout à la famille de fichiers de source de données LoopBack est le fichier datasource.ts. La classe étend un type juggler.DataSource, qui est le même type que celui utilisé dans LoopBack 3 (sauf que c’est la version de définition TypeScript). Il nécessite la même structure de configuration JSON que LoopBack 3. Dans cette version, nous devons passer la configuration à la super méthode du constructeur. Le fichier importe la configuration par défaut du fichier db.datasource.json et l’inclut comme valeur par défaut dans le paramètre dsConfig du constructeur. Cela signifie que nous n’aurons jamais besoin de passer quoi que ce soit dans le constructeur de la classe DbDataSource lors de l’instanciation d’une instance de l’objet, à moins de l’écraser… peut-être pour un environnement différent (nous y reviendrons). L’autre décorateur d’injection peu familier permet au framework d’injecter la valeur du paramètre depuis le conteneur d’injection de dépendance (s’il est lié). Dans cette optique, il existe de nombreuses façons d’instancier cette nouvelle classe DataSource : Nous avons maintenant une instance de notre dbDataSource. Mais, comment l’utilise-t-on réellement ? Comment notre nouvelle application connaît-elle notre source de données ? De la même manière que nous pouvons enregistrer (ou lier) des valeurs (ou classes) contre les applications Dependency Container, nous pouvons lier l’instance de la source de données à une clé du conteneur. Dans notre fichier application.ts, nous pouvons utiliser la fonction de liaison des applications dans le constructeur pour lier notre instance à l’application : En outre, LoopBack 4 a une fonction spéciale appelée source de données : Il existe une dernière méthode pour lier notre source de données à l’application: L’extrait de code ci-dessus lie d’abord la configuration à la clé de dépendance ’\ndatasources.config.db. Cette clé de dépendance est référencée dans le constructeur de la classe DbDataSource via le décorateur inject. En liant la clé datasources.db à la définition de classe “DbDataSource”, le conteneur de dépendances va rechercher toutes ses dépendances et les instancier pour nous. Maintenant que le conteneur de dépendances de l’application connaît notre source de données, nous pouvons la lier à un référentiel et un modèle. Note : vous devez d’abord générer un modèle avant de générer un référentiel. Pour ce faire, utilisez la commande modèle lb4 : Après avoir créé un modèle, relions-le à un nouveau référentiel. Utilisez la commande lb4 repository : Une fois que vous avez utilisé le modèle lb4 et la commande lb4 repository, vous devriez vous retrouver avec un référentiel lié à un modèle qui injecte la classe DbDataSource : Notez que le constructeur PersonRepository utilise à nouveau le décorateur inject mais cette fois-ci il fait référence à la clé datasources.db que nous avons définie précédemment. Le référentiel est responsable de la connexion du modèle à la source de données et fournit les fonctions CRUD (Create, Read, Update and Delete), grâce à la classe DefaultCrudRepository dont nous héritons. De la même manière que nous avons lié la source de données à l’application, nous devons lier le référentiel à l’application : Une fois enregistré, nous pouvons utiliser la commande contrôleur lb4 pour créer un nouveau contrôleur REST pour nous, qui utilise notre nouveau modèle de configuration, source de données et référentiel : Vous pouvez enregistrer le contrôleur contre l’application de la même manière que nous avons la source de données et le référentiel. En plus d’utiliser les fonctions de référentiel et de contrôleur pour lier nos classes à notre application, LoopBack les lie automatiquement pour nous. Ceci peut être configuré dans le constructeur de classe d’application : Ceci indique à notre application de regarder à l’intérieur du dossier Contollers pour tous nos contrôleurs et appelle automatiquement this.controller pour nous. Vous pouvez également configurer la valeur du référentiel bootOptions pour faire de même avec les référentiels. Nous n’analyserons pas ici l’ensemble du fichier du contrôleur pour gagner de la place. Les sections importantes seront soulignées : Le décorateur du référentiel s’enroule autour du décorateur d’injection. C’est la même chose que de faire ce qui suit : Nous pouvons maintenant utiliser le référentiel pour accéder à nos données de modèle dans notre source de données configurée. Conclusion Cet article compare les différences entre la configuration d’une source de données de base de données et une application LoopBack 3 et LoopBack 4. En plus de comprendre comment configurer une source de données, nous avons examiné comment configurer la configuration en fonction de divers environnements en permettant aux données de configuration d’être définies par les variables d’environnement système, auxquelles nous accédons par process.env.ENV_VARIABLE.","frontmatter":{"title":"Loopback 4 - Configuration de la base de données","subtitle":"Cet article va décrire quelques façons de configurer une application LoopBack 4 par rapport à une base de données à travers plusieurs environnements de développement (dev, test et production)."},"fields":{"slug":"/node-loopback-database/"}}},{"node":{"id":"5954b4ef-50d2-5959-ab6c-62e8c85df77f","timeToRead":7,"excerpt":"LoopBack 4 est un framework d’API open-source pour Node.js. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d’autres. Cet article a pour but de guider les débutants à travers la documentation et d’expliquer les points cruciaux nécessaires pour commencer à construire un projet d’API LoopBack 4 maintenable. Installation Assurez-vous d’avoir Node.js version 8+ installé sur votre machine. Le monorepo LoopBack inclut un package CLI, qui nous aidera dans l’échafaudage de notre application LoopBack 4. Pour l’installer, exécutez la commande suivante sur votre terminal : Créer un nouveau projet Une fois que l’outil LoopBack 4 CLI a été installé en global sur notre machine locale, nous pouvons échafauder notre application en utilisant la commande suivante : Le terminal présentera les demandes d’entrée suivantes, que j’ai remplies ci-dessous et qui formeront la base de notre exemple d’API pour l’avenir. Après avoir parcouru l’assistant CLI ci-dessus, il créera un tas de répertoires et de fichiers boilerplate ainsi que lancera npm install à notre place. Nous pouvons alors naviguer dans notre répertoire nouvellement créé et démarrer l’application. Si tout s’est bien déroulé, vous devriez voir le résultat suivant : Le projet expose un simple endpoint GET /ping. Ce qui n’est pas clair dans la sortie du terminal, ou dans la documentation de démarrage, c’est que l’application LoopBack 4 expose également un endpoint qui rendra la documentation OpenAPI Spec. Pour y accéder, il vous suffit d’ouvrir votre navigateur et d’aller à l’url suivante : http://localhost:3000/swagger-ui. LoopBack 4 OpenAPI Cette fonctionnalité permet aux développeurs d’API de documenter facilement leurs services Web au fur et à mesure que le code est écrit et de tester les endpoints d’une manière conviviale. Exploration de l’expression standard Le LoopBack CLI crée beaucoup de fichiers et de dossiers pour nous. Réduisons le bruit et concentrons-nous sur les éléments dont nous avons besoin pour mettre en place et faire fonctionner un nouveau endpoint. LoopBack 4 Structure du projet Un fichier ping.controller.ts initial est créé pour nous. C’est la convention de nommage par défaut que l’application LoopBack applique par configuration, qui peut être modifiée dans le fichier application.ts et qui sera explorée dans de futurs articles. Après avoir ouvert le fichier ping.controller.ts, nous pouvons voir que le code utilise des décorateurs TypeScript pour fournir des métadonnées HTTP à la fonction ping() TypeScript dans la classe PingController. Ce décorateur permet à l’application LoopBack de savoir que toute requête HTTP GET doit invoquer la fonction ping(). La fonction ping() renvoie un objet JSON simple. L’application LoopBack s’occupe de la sérialisation automatique des données de réponse, qui est dans ce cas JSON. Création d’un nouveau Endpoint\nUn nouveau point final peut être créé en écrivant une nouvelle fonction décorée sur le PingController dans le fichier ping.controller.ts en se référant à la fonction ping() existante. LoopBack nous permet également de créer facilement de nouveaux contrôleurs en utilisant le CLI : Afin d’utiliser le contrôleur REST avec l’option de fonctions CRUD, nous devons d’abord avoir un référentiel que nous examinerons dans les prochains articles. Si nous exécutons notre serveur avec npm, démarrez et rafraîchissez notre navigateur OpenAPI, remarquez qu’il n’y a pas encore de mention d’un PaymentController. C’est parce que nous n’avons pas encore mappé de fonctions aux chemins HTTP pour l’application LoopBack à documenter en utilisant les spécifications OpenAPI. Une fonction appelée paye accepte un seul paramètre paiement de type any et retourne un Object. Nous utilisons deux décorateurs : Ce qui dit à LoopBack de mapper la fonction pay() à une méthode HTTP POST sur les requêtes entrantes /payments et qui indique à LoopBack de mapper le corps de requête HTTP POST au paramètre de paiement de la fonction pay(). LoopBack analysera automatiquement le corps de requête HTTP JSON en fonction du type requis, ce qui est le cas dans ce cas. En réexécutant le serveur (npm start) et en rafraîchissant le navigateur OpenAPI Spec, le PaymentController sera présent avec un endpoint POST /payments. PaymentController - POST /payments Le navigateur OpenAPI Spec affiche les paramètres disponibles que nous pouvons utiliser pour interagir avec l’API, qui est juste un corps de requête HTTP pour le moment. Nous pouvons tester ce endpoint en appuyant sur le bouton “Try it out” en haut à droite. Test POST /payments La valeur d’exemple a été initialisée avec un objet JSON vide. Ce n’est pas très utile, car cela ne communique pas les valeurs attendues par le endpoint. Grâce à des normes REST simples, nous pouvons établir que nous pouvons probablement utiliser ce endpoint pour effectuer un paiement, mais quelles sont les propriétés exactes que nous pouvons transmettre ici? Valeur? Devise? Montant? Paramètres du document à l’aide des définitions de modèle Dans LoopBack 3.x, tout était piloté par un modèle, qui était un simple fichier de configuration JSON décrivant les propriétés du modèle et leurs types. Les fichiers de définition de modèle permettaient également aux développeurs de spécifier si le modèle était persistant ou non et de mapper les propriétés JSON sur des colonnes spécifiques aux bases de données (si nécessaire). Le fichier permettait également de configurer des validations, des relations, des acls (Access Control Lists) et des méthodes à distance. LoopBack 4 a pour but de découpler beaucoup de ces éléments afin de permettre une plus grande flexibilité. Nous pouvons toutefois réutiliser une grande partie de la structure syntaxique des métadonnées dans LoopBack 4, en conséquence. Nous utilisons la classe Model ci-dessus pour déclarer que la classe PaymentRequest n’est pas persistante, car elle n’est pas conforme à l’interface Persistable (qui se trouve dans le paquet LoopBack Repository). La classe Entity, utilisée dans les articles ultérieurs, implémente l’interface Persistable et inclut une fonction qui est utilisée pour définir quelle propriété détermine son caractère unique, c’est-à-dire qu’elle a un identifiant unique et peut être stockée/persistée dans une source de données (Data Source). La classe PaymentRequest est utilisée pour modéliser les données de notre module POST /payments HTTP Request. Le décorateur @model() peut être utilisé pour inclure des métadonnées supplémentaires pour le modèle. Dans ce cas, il est juste utilisé pour faire savoir à LoopBack qu’il s’agit d’un modèle et qu’il doit être utilisé pour rendre la documentation dans la spécification OpenAPI. Le décorateur @property est utilisé pour fournir des métadonnées supplémentaires aux propriétés individuelles de notre modèle. Ces métadonnées permettent d’afficher les propriétés dans les fichiers de définition de modèle LoopBack 3 et leur but principal est de permettre aux spécifications OpenAPI de documenter facilement les propriétés ainsi que les propriétés de mapper aux noms de colonnes spécifiques à la base de données. Nous pouvons utiliser cette classe de modèle comme type de paramètre dans la fonction PaymentController#pay : Avec une classe TypeScript spécifique utilisée comme type de paramètre, LoopBack peut maintenant fournir des détails supplémentaires à la spécification OpenAPI et notre navigateur rend maintenant ce qui suit (après avoir redémarré le serveur et actualisé la page): POST /payments Documentation Request Body Nos développeurs frontaux peuvent maintenant facilement lire la documentation interactive et commencer à intégrer leurs applications avec un minimum d’effort. L’exécution de cette opération après avoir appuyé sur le bouton “Try it out” et modifié certains des paramètres permet d’obtenir un code de réponse HTTP 200 avec le corps de réponse JSON suivant: 200 Success Nous avons changé la propriété de statut à “succès” dans la fonction pay() plus tôt, ce qui est vu dans la sortie JSON ci-dessus. Conclusion Cet article a introduit LoopBack 4 en échafaudant une API de paiement simple par l’intermédiaire du CLI. Nous avons examiné à quel point il est facile de documenter et de tester les endpoints de l’API à l’aide des spécifications OpenAPI intégrées en utilisant les contrôleurs LoopBack 4 et les fonctions TypeScript décorées. Enfin, nous avons exploré l’évolution des fichiers de définition de modèle LoopBack 2/3 en détail. LoopBack 4 est toujours en cours de développement, avec de nombreuses nouvelles fonctionnalités construites par l’impressionnante communauté open-source. Dans les articles suivants, nous les explorerons tous plus en détail au fur et à mesure que nous construirons notre API de paiement simple.","frontmatter":{"title":"Premiers pas avec LoopBack 4","subtitle":"LoopBack 4 est un framework d'API open-source. La dernière version a adopté les dernières fonctionnalités de ES2016/2017/2018, supporte TypeScript et intègre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d'autres."},"fields":{"slug":"/node-loopback/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/node-loopback/","prev":{"excerpt":"Si vous travaillez dans le terminal, vous utilisez probablement Vim fréquemment. Beaucoup de gens ont une relation d’amour/haine avec Vim, mais personnellement c’est mon éditeur de ligne de commande préféré, surtout quand je suis sur une machine Linux, et je l’utilise aussi fréquemment sur mon Mac, aussi. Récemment, une vulnérabilité a été identifiée à Vim. La vulnérabilité concerne l’utilisation malveillante de la fonction modelines de Vim. Cette vulnérabilité affecte toutes les versions de Vim antérieures à la version 8.1.1365, ce qui signifie qu’elle affecte aussi votre Mac, si vous utilisez la version fournie avec macOS 10.14.5, qui est 8.0.1283. Au moment d’écrire ces lignes, la version que nous installons est la 8.1.1573, ce qui permettra de corriger la vulnérabilité. Nous allons discuter comment mettre à jour Vim à la dernière version pour éviter ce problème et aussi couvrir brièvement ce que signifie cette vulnérabilité. Parlons d’abord des mauvaises choses. Que sont les modelines et pourquoi devrais-je m’en soucier? Sans vous ennuyer avec les détails précis, nous pouvons dire que les modelines sont un moyent de configurer les préréglages dans Vim en ajoutant des commandes en haut des fichier qui définissent ces préréglages lors de l’exécution du fichier. Alors qu’est-ce que cela signifie? En termes de vulnérabilité, cela signifie que bien que les modelines aient des cas d’utilisation légitimes, si vous avez une version vulnérable de Vim, il est possible d’abuser de cette fonctionnalité et d’échapper à la sandbox d’exécution de Vim, ce qui permet d’exécuter du code arbitraire de manière non sécurisée. Comment fonctionne cette vulnérabilité? Imaginez un scénario dans lequel un acteur malveillant a chargé un script contenant des modelines dans GitHub et a réussi à valider le fichier dans un référentiel que vous utilisez. L’attaquant a ajouté quelques lignes de commandes modeline en haut d’un script censé être un script Bash standard. Vous décidez d’ouvrir le fichier dans Vim pour lire le code avant de l’exécuter (toujours une bonne idée… en général). C’est tout ce dont nous avons besoin; le code malveillant s’exécute car tout ce que Vim doit faire est de lire le fichier et les modelines sont exécutées, c’est ainsi que les modelines sont supposées fonctionner. Malheureusement pour vous, votre version de Vim est obsolète et vous avez été infecté car ce code malveillant peut maintenant être exécuté en dehors de Vim. Ou peut-être pas, parce que vous avez lu cet article en premier, puis vous avez mis à jour Vim. Liste de pré-installation Il convient de discuter de certaines mises en garde avant de poursuivre. Chaque fois que vous apportez des modifications à macOS en utilisant un terminal, et en particulier en exécutant des commandes utilisant sudo, vous devez faire attention car il est facile de casser des choses. Premièrement, nous ne pouvons pas supprimer la version de Vim installée avec macOS. Au lieu de cela, nous allons installer la dernière version et nous assurer que c’est celle utilisée lorsque vous accédez au terminal. La raison pour laquelle nous ne pouvons pas supprimer la version de Vim fournie avec macOS est due à la configuration des autorisations dans macOS. Apple a configuré en toute sécurité les autorisations de sorte que l’utilisateur ne puisse plus modifier (ni même casser les composants) du système principal, y compris Vim. De plus, nous ne souhaitons pas vraiment supprimer les logiciels de base afin de ne pas causer de conflits. Nous apportons un changement qui peut facilement être annulé si quelque chose se passait mal ou devait être changé à l’avenir. Deuxièmement, nous allons exécuter quelques commandes en utilisant sudo. Cela signifie que vous allez exécuter ces commandes comme si vous étiez l’utilisateur root. Cela pourrait poser problème si vous ne lisez pas et ne suivez pas les instructions à la lettre. Cela signifie également que vous devez avoir un accès administrateur dans macOS et que vous devrez fournir votre mot de passe lors de l’exécution de la commande. Tu as été prévenu. Mais ne vous inquiétez pas, ce que nous faisons est assez simple, et utiliser sudo n’est pas mauvais, c’est juste que vous voulez vous rappeler qu’un grand pouvoir implique de grandes responsabilités, et que sudo a définitivement un grand pouvoir. Un grand pouvoir implique de grandes responsabilités. Oncle Ben Cela dit, passons à autre chose et commençons à mettre à jour Vim. Compiler Vim sur macOS Pour commencer, ouvrons l’application Terminal. Vous pouvez rechercher cela en utilisant Spotlight (Cmd + Space) ou ouvrir votre dossier Applications, cliquez sur Utilitaires, puis sur Terminal. Tout d’abord, nous devons récupérer la dernière version de Vim dans le dépôt officiel GitHub, puis nous allons changer de répertoire dans le répertoire vim qui vient d’être créé. Nous venons de télécharger le code source de Vim, ce qui signifie que nous devrons le compiler avant de pouvoir l’installer. Pour ce faire, tapez simplement make dans le même répertoire. Vous allez voir un mur de texte en cours de création lors de la compilation de l’application. Cela prendra probablement quelques minutes, en fonction de la vitesse de votre Mac. Une fois terminé, vous serez renvoyé à l’invite de commande. Installer le dernier Vim sur macOS Maintenant que nous avons compilé Vim, il est temps de terminer l’installation. Pour exécuter la commande d’installation, vous devrez utiliser sudo. C’est une considération importante car cela signifie que nous installons dans un répertoire système et, comme je l’ai mentionné ci-dessus, nous souhaitons faire attention, veillez à exécuter correctement la commande suivante. Exécutez ce qui suit dans le même dossier vim que nous utilisions. Votre mot de passe vous sera demandé, indiquez-le et la commande sera exécutée. Encore une fois, vous verrez un mur de texte semblable à celui que vous avez vu lors de la compilation de Vim. Une fois ce processus terminé, Vim sera installé et vous reviendrez à l’invite de commande, mais nous ne l’avons pas encore terminée. Comme je l’ai mentionné plus tôt, nous installons une installation supplémentaire de Vim. Nous voulons être certains que lorsque nous exécutons vim à partir du terminal, nous obtenons vraiment la bonne version. Lisez la suite pour voir comment configurer ceci correctement. Configurer le bon Vim Lorsque nous avons installé Vim, l’application binaire exécutable a été placée dans /usr/local/bin/vim. Toutefois, l’installation initiale de MacOS se trouve toujours dans /usr/bin/vim. Cela ne posera aucun problème lorsque nous utiliserons vim depuis le terminal, mais cela posera des problèmes si nous exécutons vi, ce qui est très courant pour les utilisateurs de longue date de Vim, car Vi est l’application sur laquelle Vim est basé. Sur macOS, la commande vi est un lien symbolique vers /usr/bin/vim et cela n’a pas changé après notre installation. Vous remarquerez que la version affichée sur l’écran d’accueil de Vim est différente si vous exécutez vim vs. vi. Cela pourrait causer des problèmes plus tard. Voyons ce qui se passe. Que se passe t-il ici? Le problème est notre PATH - il sait toujours que le lien symbolique vi existe et lit le répertoire /usr/bin lorsque notre profil est chargé. Cependant, par défaut, /usr/local/bin est lu en premier, puis /usr/bin, ce qui signifie que nous devons simplement fournir un lien symbolique vers le chemin de l’application que nous voulons exécuter lorsque nous exécutons vi. Faisons-le maintenant. Créez un lien symbolique à l’aide de la commande suivante, puis redémarrez votre terminal. C’est tout! Une fois que vous aurez redémarré votre terminal, que vous utilisiez Vi ou Vim, vous obtiendrez la même installation mise à jour de Vim. Conclusion J’espère que cela a été une expérience éducative, mais simple, mettant à jour l’éditeur de texte en ligne de commande préféré de tout le monde. Merci d’avoir lu!","timeToRead":6,"frontmatter":{"title":"Vim est vulnérable - Mise à jour de Vim sur macOS","subtitle":"Mettez à jour Vim avec la dernière version en quelques minutes.","tags":["Vim","Mac"],"category":["Vim"],"date":"2019-06-23T19:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABnPJRfYRJ3eAH/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEEBMh/9oACAEBAAEFAr+d1Wj3LA4kTSYuqAIoUYcf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgEEAwAAAAAAAAAAAAAAAAEhAhEigRASUf/aAAgBAQAGPwLGndUCqv2a0jKC7Zio9JZdrn//xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhMXEQQWGRof/aAAgBAQABPyHF3pxvUElc2AUQ1SO9Eu7XLPvxqV1b8TNfXZ1Koo6f/9oADAMBAAIAAwAAABCDLzz/xAAWEQEBAQAAAAAAAAAAAAAAAAABESD/2gAIAQMBAT8QVSLj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAREgIf/aAAgBAgEBPxANmn//xAAfEAEBAAIBBAMAAAAAAAAAAAABEQAhMUFRcaEQ4fD/2gAIAQEAAT8QTY2F4eBtwaGwenXlylUwS6h95VQu9P3rN0jXLMAV+uQPeSBaA2V3nVwAAAcAQPj/2Q==","sizes":"(max-width: 1800px) 100vw, 1800px","src":"/static/368261693a41f4548bf3cc82019ebe1a/fb184/vim.jpg","srcSet":"/static/368261693a41f4548bf3cc82019ebe1a/f8f18/vim.jpg 930w,\n/static/368261693a41f4548bf3cc82019ebe1a/fb184/vim.jpg 1800w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/vim-modelines-vulnerable/"}},"next":{"excerpt":"Introduction Presque toutes les applications Web ont besoin de conserver des données sous une forme ou une autre. LoopBack a toujours abstrait le moteur de base de données de l’application en nous fournissant plusieurs connecteurs à utiliser, tels que : MySQL, Postgres et In-memory. LoopBack 4 utilise les mêmes bibliothèques sous-jacentes que LoopBack 3 pour passer la configuration aux moteurs. Cependant, les structures du projet sont légèrement différentes, comme indiqué ci-dessous. Configuration de LoopBack 3 Dans LoopBack 3, vous définiriez un ensemble d’objets JSON à l’intérieur d’un fichier datasources.json stocké dans le dossier serveur, ce qui permettrait à l’application de récupérer la configuration. Le fichier ressemblerait à ceci : Ce fichier définit une nouvelle source de données appelée “db”, qui est configurée pour utiliser le connecteur de base de données en mémoire. Dans la plupart des applications, c’est une excellente source de données par défaut pour les modèles, car elle élimine le besoin de configurer un serveur de base de données lors du premier démarrage avec un prototype. Vous pouvez simplement configurer les modèles pour utiliser la source de données “db” et continuer avec le code. Le fichier model-config.json, dans le même dossier, relierait un modèle à une source de données et ressemblerait à ceci : Une fois que vous avez la base de votre application en place et en cours d’exécution par rapport à la configuration de la base de données en mémoire, vous pouvez vous concentrer sur la configuration d’un serveur de base de données, tel que MySQL ou Postgres, installer le bon connecteur et simplement modifier la configuration datasources.json comme suit : C’est excellent pour le développement local. Mais, lorsque vous travaillez au sein d’une équipe plus importante ou avec plusieurs environnements, un seul fichier de configuration JSON ne va pas le couper. LoopBack 3 a résolu la configuration spécifique à l’environnement en nous permettant de créer des fichiers de sources de données spécifiques à l’environnement. Le nom du fichier de source de données spécifique à l’environnement devait être dans une certaine structure : datasources.<environment>.js. Un projet avec 3 environnements aurait les fichiers suivants : datasources.json (une configuration de serveur de base de données locale) datasources.test.js (une configuration de serveur de base de données de test) datasources.production.js (une configuration de serveur de base de données de production) La version JavaScript du fichier de configuration nous a donné une flexibilité supplémentaire, car nous avons pu déterminer la configuration à l’aide de code. Le fichier de configuration le plus courant utilise les variables d’environnement système. Un exemple de fichier de configuration d’une source de données de production serait le suivant : C’est génial, car cela élimine le besoin de stocker les références de production dans notre code. Nous pourrions livrer ces fichiers de configuration et configurer la configuration sur le serveur, en toute sécurité. Par défaut, le framework utiliserait la variable d’environnement système NODE_ENV pour choisir le fichier source à utiliser. Un serveur de production aurait les variables d’environnement suivantes : NODE_ENV=production DB_HOST=aws-rds-mysql-host.example.com DB_PORT=3306 DB_USER=super-secret-user DB_PASSWORD=super-secret-password DBDATABASE=appdatabase Configuration LoopBack 4 LoopBack 4 ne lit plus automatiquement les fichiers de configuration des sources de données. Au lieu de cela, le framework nous laisse décider comment nous voulons configurer notre application. Pour l’instant, il ne semble pas qu’il existe de meilleures pratiques documentées pour la mise en place d’un tel système. Une approche est suggérée ci-dessous. Dépendance Injection Avant de nous plonger dans la configuration de la base de données, nous devons comprendre l’un des concepts clés de LoopBack 4 : Injection de dépendance. Essentiellement, l’application peut enregistrer des valeurs sur une liste de clés uniques. Ces valeurs peuvent contenir des variables normales ou des définitions de classes, que l’application peut ensuite utiliser pour gérer la création de ces objets pour nous, en reprenant les dépendances requises. Par exemple, on peut enregistrer une valeur,‘bar’ sur une clé ‘foo’. Maintenant l’application sait que la clé ‘foo’, contient la valeur ‘bar’. Nous pouvons demander cette valeur à partir de l’application n’importe où dans notre code. À titre d’exemple : En plus de lier une valeur à une clé, nous pouvons lier une classe à une clé et laisser l’application calculer récursivement ses dépendances lors de l’instanciation de l’objet sur demande. Quand nous demandons une instance de la classe Foo, comme suit: Le conteneur d’application verra que la classe Foo dépend de la valeur de la barre. Il le recherchera dans le conteneur de dépendances, le trouvera (s’il est lié) et l’injectera ensuite dans la classe. D’où l’injection de dépendance. Créer un nouveau projet On peut utiliser la CLI pour créer un nouveau projet en appelant la commande suivante : LoopBack 4 ajoute un dossier datasources au projet. Initialement, on supposerait que ce dossier est configuré pour être lu de la même manière que les fichiers JSON des sources de données LoopBack 3. Cependant, c’est juste le dossier par défaut utilisé par le CLI pour y déposer les nouveaux fichiers. Ajout d’une source de données à l’aide de l’interface CLI Utilisez le CLI pour créer une nouvelle source de données en exécutant la commande suivante : La première chose que vous remarquerez est que le fichier db.datasource.json est exactement le même que le fichier LoopBack 3 datasources.json. Dans l’assistant CLI, j’ai choisi le connecteur en mémoire, qui est l’un des nombreux connecteurs disponibles dans LoopBack 3 et LoopBack 4. Le nouvel ajout à la famille de fichiers de source de données LoopBack est le fichier datasource.ts. La classe étend un type juggler.DataSource, qui est le même type que celui utilisé dans LoopBack 3 (sauf que c’est la version de définition TypeScript). Il nécessite la même structure de configuration JSON que LoopBack 3. Dans cette version, nous devons passer la configuration à la super méthode du constructeur. Le fichier importe la configuration par défaut du fichier db.datasource.json et l’inclut comme valeur par défaut dans le paramètre dsConfig du constructeur. Cela signifie que nous n’aurons jamais besoin de passer quoi que ce soit dans le constructeur de la classe DbDataSource lors de l’instanciation d’une instance de l’objet, à moins de l’écraser… peut-être pour un environnement différent (nous y reviendrons). L’autre décorateur d’injection peu familier permet au framework d’injecter la valeur du paramètre depuis le conteneur d’injection de dépendance (s’il est lié). Dans cette optique, il existe de nombreuses façons d’instancier cette nouvelle classe DataSource : Nous avons maintenant une instance de notre dbDataSource. Mais, comment l’utilise-t-on réellement ? Comment notre nouvelle application connaît-elle notre source de données ? De la même manière que nous pouvons enregistrer (ou lier) des valeurs (ou classes) contre les applications Dependency Container, nous pouvons lier l’instance de la source de données à une clé du conteneur. Dans notre fichier application.ts, nous pouvons utiliser la fonction de liaison des applications dans le constructeur pour lier notre instance à l’application : En outre, LoopBack 4 a une fonction spéciale appelée source de données : Il existe une dernière méthode pour lier notre source de données à l’application: L’extrait de code ci-dessus lie d’abord la configuration à la clé de dépendance ’\ndatasources.config.db. Cette clé de dépendance est référencée dans le constructeur de la classe DbDataSource via le décorateur inject. En liant la clé datasources.db à la définition de classe “DbDataSource”, le conteneur de dépendances va rechercher toutes ses dépendances et les instancier pour nous. Maintenant que le conteneur de dépendances de l’application connaît notre source de données, nous pouvons la lier à un référentiel et un modèle. Note : vous devez d’abord générer un modèle avant de générer un référentiel. Pour ce faire, utilisez la commande modèle lb4 : Après avoir créé un modèle, relions-le à un nouveau référentiel. Utilisez la commande lb4 repository : Une fois que vous avez utilisé le modèle lb4 et la commande lb4 repository, vous devriez vous retrouver avec un référentiel lié à un modèle qui injecte la classe DbDataSource : Notez que le constructeur PersonRepository utilise à nouveau le décorateur inject mais cette fois-ci il fait référence à la clé datasources.db que nous avons définie précédemment. Le référentiel est responsable de la connexion du modèle à la source de données et fournit les fonctions CRUD (Create, Read, Update and Delete), grâce à la classe DefaultCrudRepository dont nous héritons. De la même manière que nous avons lié la source de données à l’application, nous devons lier le référentiel à l’application : Une fois enregistré, nous pouvons utiliser la commande contrôleur lb4 pour créer un nouveau contrôleur REST pour nous, qui utilise notre nouveau modèle de configuration, source de données et référentiel : Vous pouvez enregistrer le contrôleur contre l’application de la même manière que nous avons la source de données et le référentiel. En plus d’utiliser les fonctions de référentiel et de contrôleur pour lier nos classes à notre application, LoopBack les lie automatiquement pour nous. Ceci peut être configuré dans le constructeur de classe d’application : Ceci indique à notre application de regarder à l’intérieur du dossier Contollers pour tous nos contrôleurs et appelle automatiquement this.controller pour nous. Vous pouvez également configurer la valeur du référentiel bootOptions pour faire de même avec les référentiels. Nous n’analyserons pas ici l’ensemble du fichier du contrôleur pour gagner de la place. Les sections importantes seront soulignées : Le décorateur du référentiel s’enroule autour du décorateur d’injection. C’est la même chose que de faire ce qui suit : Nous pouvons maintenant utiliser le référentiel pour accéder à nos données de modèle dans notre source de données configurée. Conclusion Cet article compare les différences entre la configuration d’une source de données de base de données et une application LoopBack 3 et LoopBack 4. En plus de comprendre comment configurer une source de données, nous avons examiné comment configurer la configuration en fonction de divers environnements en permettant aux données de configuration d’être définies par les variables d’environnement système, auxquelles nous accédons par process.env.ENV_VARIABLE.","timeToRead":11,"frontmatter":{"title":"Loopback 4 - Configuration de la base de données","subtitle":"Cet article va décrire quelques façons de configurer une application LoopBack 4 par rapport à une base de données à travers plusieurs environnements de développement (dev, test et production).","tags":["LoopBack","Node.js"],"category":["Node.js"],"date":"2019-06-29T21:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAd2qFGs6KLKpA6D/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADERAS/9oACAEBAAEFAmYKBaNltZY+S8UYvf/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABcRAQADAAAAAAAAAAAAAAAAAAIBESD/2gAIAQIBAT8Bgmsf/8QAIBAAAgEBCQAAAAAAAAAAAAAAAREAAhASICExQVFhcf/aAAgBAQAGPwJmIg0+2MLTeZPu8IBxg//EABsQAAICAwEAAAAAAAAAAAAAAAERACEQIDGx/9oACAEBAAE/IWZQhjIPFTxZdwoB1CpF5SyGi0//2gAMAwEAAgADAAAAEGfvAP/EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPxBW4//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBHh/9oACAECAQE/EGaXkb//xAAeEAEBAAEEAwEAAAAAAAAAAAABESEAMUFhECBxwf/aAAgBAQABPxBSMi50HycxA+/j4mbfQaZtJz1qYZEiAUiAeB2k71ltDTzCen//2Q==","sizes":"(max-width: 2000px) 100vw, 2000px","src":"/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg","srcSet":"/static/9611cacec962506545385f22b26d913d/f8f18/loopback.jpg 930w,\n/static/9611cacec962506545385f22b26d913d/0e6ff/loopback.jpg 1860w,\n/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg 2000w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/node-loopback-database/"}},"primaryTag":"LoopBack","primaryCategory":"Node.js"}}}