{"componentChunkName":"component---src-templates-post-tsx","path":"/bash-justeAssezPourEtreDangereux/","webpackCompilationHash":"28b74a5dec589e4586df","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY023PvUrDUBTA8ZuCtoMoOLQ4dWhN14x2kEKXFkGoohQ/QBexOHRycAidKkgHHRq69APRoTjFJYODIA6+gSBYfYMmfYLE/5VT6NALP845NyeHc9UoCHZRQvonCLKKE4ZhAXYURTsYoE9dIy5iCzfUJnEdV+RF4iu6ikFH2EPxazzOcJmg4Rnn5C8ysIEOHqTe5/sT3qXOwYOtRr5/wLAqzpCTDXu4p2ETtyjgGJ/cX+se8jeU9fa4RBt5vWENpjzdkoGPcGg4RQsbOMEFmnBRRwVDHEK/yFXfvr/CoPjvZLKcdByDyzWGeajigzorGy0oOeRJiUtITe/pX1XzDk3buIMltSFR/zTtic3060X+8z8PsEUt8G3LVQAAAABJRU5ErkJggg==","width":400,"height":128,"src":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png","srcSet":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png 1x"}}},"markdownRemark":{"html":"<p>La configuration, le CI et les flux de déploiement représente un peu l’ancien script bash.</p>\n<p>Malgré mon profond intérêt pour les subtilités de Bash (<em>/sarcasme</em>), j’ai continué à chercher des solution aux mêmes situations sur  Google et StackOverflow.</p>\n<p>Pour éviter d’avoir à le refaire moi-même et pour votre plaisir de lecture, les voici.</p>\n<p>Pour être dangereux en termes d’installation, de CI et de flux de déploiement, nous rencontrerons ce qui suit:</p>\n<ul>\n<li>azerty</li>\n<li>azerty</li>\n</ul>\n<h2>Vérifier si un fichier existe</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> -f ./pdfgen/pdfgen <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Building pdfgen binary\"</span>\n    <span class=\"token function\">npm</span> run --prefix pdfgen build:linux\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Pdfgen binary already exists, skipping build\"</span>\n<span class=\"token keyword\">fi</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Vérifier si un lien symbolique existe</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> -L /usr/local/bin/heroku <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token function\">wget</span> https://cli-assets.heroku.com/branches/stable/heroku-linux-amd64.tar.gz\n    <span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /usr/local/lib /usr/local/bin\n    <span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> -xvzf heroku-linux-amd64.tar.gz -C /usr/local/lib\n    <span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/lib/heroku/bin/heroku /usr/local/bin/heroku\n<span class=\"token keyword\">fi</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Vérifier si une variable d’environnement est définie</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># long</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -z <span class=\"token string\">\"<span class=\"token variable\">${CIRCLE_BRANCH}</span>\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token function\">npm</span> run redis-cli flushall\n<span class=\"token keyword\">fi</span>\n \n<span class=\"token function\">npm</span> run <span class=\"token function\">sync</span>\n\n<span class=\"token comment\"># one-liner</span>\n<span class=\"token punctuation\">[</span>-z <span class=\"token string\">\"<span class=\"token variable\">${CIRCLE_BRANCH}</span>\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run redis-cli flushall<span class=\"token punctuation\">;</span> <span class=\"token function\">npm</span> run <span class=\"token function\">sync</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Basculer une variable d’environnement</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token keyword\">case</span> <span class=\"token variable\">$CIRCLE_BRANCH</span> <span class=\"token keyword\">in</span>\n    <span class=\"token string\">\"develop\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ENVIRONMENT</span><span class=\"token operator\">=</span><span class=\"token string\">\"dev\"</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">HEROKU_APP</span><span class=\"token operator\">=</span>dev-app\n        <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token string\">\"staging\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ENVIRONMENT</span><span class=\"token operator\">=</span><span class=\"token string\">\"staging\"</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">HEROKU_APP</span><span class=\"token operator\">=</span>staging-app\n        <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ENVIRONMENT</span><span class=\"token operator\">=</span><span class=\"token string\">\"production\"</span>\n        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">HEROKU_APP</span><span class=\"token operator\">=</span>production-app\n        <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">esac</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Demander à l’utilisateur</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">read</span> -p <span class=\"token string\">\"Are you sure you want to merge 'develop' into 'staging'? (y/N)\"</span> -n <span class=\"token number\">1</span> -r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token comment\"># we like having a new line</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token environment constant\">$REPLY</span> <span class=\"token operator\">=</span>~ ^<span class=\"token punctuation\">[</span>Yy<span class=\"token punctuation\">]</span>$ <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n  <span class=\"token function\">git</span> merge develop --ff-only\n  <span class=\"token function\">git</span> push\n<span class=\"token keyword\">fi</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Un dernier conseil, s’il s’agit de plusieurs lignes, essayez d’utiliser quelque chose comme JavaScript ou Python pour écrire votre script.</p>\n<h2>Injecter .env dans votre session/environnement</h2>\n<p>Nous avons des fichiers <code>.env</code>, Docker Compose traite cela avec une utilisation habituelle, mais disons que nous voulons que quelque chose tourne en dehors de Docker (et sans utiliser quelque chose comme <a href=\"https://github.com/motdotla/dotenv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dotenv</a>).</p>\n<p>Voici l’extrait de code pour un shell UNIX</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> .env <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span><span class=\"token variable\">)</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La configuration, le CI et les flux de déploiement représente un peu l’ancien script bash."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Malgré mon profond intérêt pour les subtilités de Bash ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"/sarcasme"}]},{"type":"text","value":"), j’ai continué à chercher des solution aux mêmes situations sur  Google et StackOverflow."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour éviter d’avoir à le refaire moi-même et pour votre plaisir de lecture, les voici."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour être dangereux en termes d’installation, de CI et de flux de déploiement, nous rencontrerons ce qui suit:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"azerty"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"azerty"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Vérifier si un fichier existe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":" -f ./pdfgen/pdfgen "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Building pdfgen binary\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run --prefix pdfgen build:linux\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Pdfgen binary already exists, skipping build\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Vérifier si un lien symbolique existe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":" -L /usr/local/bin/heroku "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"wget"}]},{"type":"text","value":" https://cli-assets.heroku.com/branches/stable/heroku-linux-amd64.tar.gz\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"mkdir"}]},{"type":"text","value":" -p /usr/local/lib /usr/local/bin\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"tar"}]},{"type":"text","value":" -xvzf heroku-linux-amd64.tar.gz -C /usr/local/lib\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ln"}]},{"type":"text","value":" -s /usr/local/lib/heroku/bin/heroku /usr/local/bin/heroku\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Vérifier si une variable d’environnement est définie"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# long"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" -z "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CIRCLE_BRANCH}"}]},{"type":"text","value":"\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run redis-cli flushall\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]},{"type":"text","value":"\n \n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sync"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# one-liner"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"-z "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\""},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"${CIRCLE_BRANCH}"}]},{"type":"text","value":"\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"&&"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run redis-cli flushall"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sync"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Basculer une variable d’environnement"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"case"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$CIRCLE_BRANCH"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"develop\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ENVIRONMENT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"dev\""}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"HEROKU_APP"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"dev-app\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"staging\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ENVIRONMENT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"staging\""}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"HEROKU_APP"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"staging-app\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"production\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ENVIRONMENT"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"production\""}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"HEROKU_APP"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"production-app\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"esac"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Demander à l’utilisateur"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"read"}]},{"type":"text","value":" -p "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Are you sure you want to merge 'develop' into 'staging'? (y/N)\""}]},{"type":"text","value":" -n "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" -r\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# we like having a new line"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","environment","constant"]},"children":[{"type":"text","value":"$REPLY"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"~ ^"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"Yy"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"git"}]},{"type":"text","value":" merge develop --ff-only\n  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"git"}]},{"type":"text","value":" push\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Un dernier conseil, s’il s’agit de plusieurs lignes, essayez d’utiliser quelque chose comme JavaScript ou Python pour écrire votre script."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Injecter .env dans votre session/environnement"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous avons des fichiers "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".env"}]},{"type":"text","value":", Docker Compose traite cela avec une utilisation habituelle, mais disons que nous voulons que quelque chose tourne en dehors de Docker (et sans utiliser quelque chose comme "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/motdotla/dotenv","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"dotenv"}]},{"type":"text","value":")."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Voici l’extrait de code pour un shell UNIX"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"cat"}]},{"type":"text","value":" .env "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"xargs"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]}],"data":{"quirksMode":false}},"excerpt":"La configuration, le CI et les flux de déploiement représente un peu l’ancien script bash. Malgré mon profond intérêt pour les subtilités de Bash (/sarcasme), j’ai continué à chercher des solution aux mêmes situations sur  Google et StackOverflow. Pour éviter d’avoir à le refaire moi-même et pour votre plaisir de lecture, les voici. Pour être dangereux en termes d’installation, de CI et de flux de déploiement, nous rencontrerons ce qui suit: azerty azerty Vérifier si un fichier existe Vérifier si un lien symbolique existe Vérifier si une variable d’environnement est définie Basculer une variable d’environnement Demander à l’utilisateur Un dernier conseil, s’il s’agit de plusieurs lignes, essayez d’utiliser quelque chose comme JavaScript ou Python pour écrire votre script. Injecter .env dans votre session/environnement Nous avons des fichiers .env, Docker Compose traite cela avec une utilisation habituelle, mais disons que nous voulons que quelque chose tourne en dehors de Docker (et sans utiliser quelque chose comme dotenv). Voici l’extrait de code pour un shell UNIX","timeToRead":2,"frontmatter":{"title":"Bash - Vérifier les variables d'environnement sont définies ou s'il existe des fichiers/références","subtitle":"","userDate":"21 May 2019","date":"2019-05-21T22:00:00.000Z","tags":["Bash","DevOps"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFak9W5wHg//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACAxESISL/2gAIAQEAAQUCKy6E1BuzHEyqC//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAQACAwEAAAAAAAAAAAAAAAABMRESIYH/2gAIAQEABj8C8Qi3WdVP/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERITGR/9oACAEBAAE/IaNiOjRsui2rXBjEiRSTh//aAAwDAQACAAMAAAAQpN//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBX/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qp//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFRMUFhwf/aAAgBAQABPxDieh8j0AS9GPIJjMXQwMpryCyIpy61KNPs2wWhNAn/2Q==","aspectRatio":1.7777777777777777,"src":"/static/b9929b1a4915b5e4d241ad5af23c0901/989b1/servers.jpg","srcSet":"/static/b9929b1a4915b5e4d241ad5af23c0901/f8f18/servers.jpg 930w,\n/static/b9929b1a4915b5e4d241ad5af23c0901/989b1/servers.jpg 1600w","sizes":"(max-width: 1600px) 100vw, 1600px"}}},"author":{"id":"ludo","name":"Wyffels Ludovic","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQ4y2MwsXf5T03MMGogGBvbOYNpUwdXOIbJwdgwNQQNhCk0snX6r2thC8Y6QGxg7QCWA/FBcrgMxepCkAZrV6//EYmpYBydkvHfMzjiv5mj2//whJT/Nm7ecEMJGgjykp6V/f+AqLj/O/Ye+L8diA8dO/m/pbv/v72n3/+tu/f9D45N/K9naYcSFESFoRXQlSCX2rh7g/kgr1u5epIWhiAMCi/3wLD/fVNn/u+fNgtMT5g+6//kmXOB/Jn/PYLCwWrINnDijDlAPBvKJ8NAZC+DIgCkGYRBbJAYSV5GjpTte/b/PwiMkLj0nP8xqVn/Dxw9AY6kwOh40iIFlmzCgUkmKjnjvx0wdu08fMFskJi1mxfxyQY9YetAEzJyQic5YaNnPeTgIDnrjZaHJGMACtTMXoVAJ6sAAAAASUVORK5CYII=","width":400,"height":400,"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png","srcSet":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png 1x"}}]}}}},"relatedPosts":{"totalCount":3,"edges":[{"node":{"id":"437abfe0-f7fa-5810-9d38-b2acb6244845","timeToRead":2,"excerpt":"La configuration, le CI et les flux de déploiement représente un peu l’ancien script bash. Malgré mon profond intérêt pour les subtilités de Bash (/sarcasme), j’ai continué à chercher des solution aux mêmes situations sur  Google et StackOverflow. Pour éviter d’avoir à le refaire moi-même et pour votre plaisir de lecture, les voici. Pour être dangereux en termes d’installation, de CI et de flux de déploiement, nous rencontrerons ce qui suit: azerty azerty Vérifier si un fichier existe Vérifier si un lien symbolique existe Vérifier si une variable d’environnement est définie Basculer une variable d’environnement Demander à l’utilisateur Un dernier conseil, s’il s’agit de plusieurs lignes, essayez d’utiliser quelque chose comme JavaScript ou Python pour écrire votre script. Injecter .env dans votre session/environnement Nous avons des fichiers .env, Docker Compose traite cela avec une utilisation habituelle, mais disons que nous voulons que quelque chose tourne en dehors de Docker (et sans utiliser quelque chose comme dotenv). Voici l’extrait de code pour un shell UNIX","frontmatter":{"title":"Bash - Vérifier les variables d'environnement sont définies ou s'il existe des fichiers/références","subtitle":""},"fields":{"slug":"/bash-justeAssezPourEtreDangereux/"}}},{"node":{"id":"a7b23c0d-9c79-54c7-8132-41d2f4632b4c","timeToRead":1,"excerpt":"Une des choses les plus grandes et les pires avec git est que vous pouvez réécrire l’histoire. Voici une façon sournoise d’abuser de cela, je ne peux pas penser à une raison légitime de le faire. Comme pour tout, merci StackOverflow pour toutes les options que je peux choisir parmi Fixe la date du dernier commit à la date du jour Fixer la date du dernier commit à une date arbitraire Définir la date d’une validation arbitraire sur une date arbitraire ou courante Rebaser avant ledit engagement et arrêter pour modification: git rebase <commit-hash>^ -i Remplace pick par e (edit) sur la ligne avec ce commit (le premier) Quittez l’éditeur (ESC suivi de :wq dans VIM) Non plus: GIT_COMMITTER_DATE=\"$(date)\" git commit --amend --no-edit --date \"$(date)\" GIT_COMMITTER_DATE=\"Mon 20 Aug 2018 20:19:19 BST\" git commit --amend --no-edit --date \"Mon 20 Aug 2018 20:19:19 BST\" Voir ici pour plus d’informations sur le rebase et l’édition dans git: Fractionner un commit git existant. Après l’une de ces 3 options, vous voudrez exécuter:","frontmatter":{"title":"Changer la date d'un commit","subtitle":"Une des choses les plus grandes et les pires avec git est que vous pouvez réécrire l'histoire. Voici une façon sournoise d'abuser de cela, je ne peux pas penser à une raison légitime de le faire."},"fields":{"slug":"/git-changeGitOfCommit/"}}},{"node":{"id":"335e1698-dc7c-51f5-94d1-dff1c8343c42","timeToRead":1,"excerpt":"L’une des principales différences entre git et les autres systèmes de contrôle de version est qu’il permet à l’utilisateur de réécrire l’historique. Pour ce faire, le moyen principal consiste à utiliser git rebase, généralement suivi d’un git push --force pour écraser l’historique du serveur (remote) avec l’historique local. Voici comment diviser les commits existants à l’aide de rebase, reset et commit. Supposons que vous ayez deux fichiers édités dans un commit (A et B) et que vous souhaitiez importer les modifications d’un de ces fichiers (A) dans votre branche actuelle, mais pas celles de l’autre (B). Utiliser git cherry-pick <commit-hash> n’est pas une option, car cela impliquerait les modifications pour A et B. La solution consiste à scinder le commit en 2 et à ne sélectionner que le nouveau commit contenant les modifications pour A. Pour faire ça: lancez git rebase -i <commit-hash>~ (notez le -) ou git rebase -i <hash-of-previous-commit> recherchez le commit que vous voulez scinder dans l’écran d’édition du rebase, changez le pick en e (edit) sauvegardez et quittez (ESC suivi de :wq pour fermer VIM) git reset HEAD~ pour réinitialiser les modifications planifiées (stash) git add [files-to-add] tous les fichiers que nous voulons ajouter au premier commit (ici, ce serait git add A) git commit normalement, avec un message, etc. Exécutez autant de fois que vous le souhaitez: git add [other-files-to-add] git commit git rebase -- continue d’indiquer que la division est terminée et continue la refonte Enfin, nous pouvons git cherry-pick <new-commit-hash> pour intégrer les modifications dans notre branche.","frontmatter":{"title":"Fractionner un commit existant","subtitle":"Une des choses les plus grandes et les pires avec git est que vous pouvez réécrire l'histoire. Voici une façon sournoise d'abuser de cela, je ne peux pas penser à une raison légitime de le faire."},"fields":{"slug":"/git-splitExistingCommit/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/bash-justeAssezPourEtreDangereux/","prev":{"excerpt":"Cet article passe en revue certains modèles pouvant être utilisés pour tester les classes ES6. Les exemples utiliseront l’auto-mocking du module Jest mais devraient être portables à d’autres bibliothèques de mocking de module (par exemple Proxyquire) avec quelques modifications. Dans cet article, nous avons exploré comment définir des modèles Sequelize en utilisant des classes ES6. Un des avantages d’une telle approche est qu’elle permet des tests unitaires faciles, elle permet d’instancier le modèle sans le bagage de toute Sequelize (et/ou une base de données). Alternative avec Object.assign Nous allons tester le modèle suivant (qui est une classe ES6): Au niveau des modules, nous le voulons: mock/stub Sequelize (et la classe de base Model) importer le modèle Dans le test: Instantaner le modèle que nous avons défini (sans crash) Définissez quelques propriétés sur cette instance Exécuter certaines méthodes Affirmer sur le rendement  Alternative avec Object.assign Si nous définissons plus d’une propriété d’instance unique, l’utilisation de Object.assign peut être plus simple à gérer:","timeToRead":2,"frontmatter":{"title":"Mocking des classes ES6 dans les tests unitaires","subtitle":"Cet article passe en revue certains modèles pouvant être utilisés pour tester les classes ES6.","tags":["Sequelize","Node.js","Javascript"],"category":["Node.js"],"date":"2019-05-11T09:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.5037593984962405,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAED/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZUjJmr/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIQESFB/9oACAEBAAEFAsROMjsbr//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8BoX//xAAWEAADAAAAAAAAAAAAAAAAAAACIDL/2gAIAQEABj8CkW//xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhMVGh/9oACAEBAAE/IVpgJCrobEekUovp/9oADAMBAAIAAwAAABDIH//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/EIP/xAAWEQADAAAAAAAAAAAAAAAAAAAQETH/2gAIAQIBAT8QZB//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhoTH/2gAIAQEAAT8QpiZGNGdgQmmlT3Om9j1wyKmP/9k=","sizes":"(max-width: 2000px) 100vw, 2000px","src":"/static/4facbfac04767ff55d17ee1932aa8b00/883ab/books.jpg","srcSet":"/static/4facbfac04767ff55d17ee1932aa8b00/f8f18/books.jpg 930w,\n/static/4facbfac04767ff55d17ee1932aa8b00/0e6ff/books.jpg 1860w,\n/static/4facbfac04767ff55d17ee1932aa8b00/883ab/books.jpg 2000w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/node-sequelize-mocking/"}},"next":{"excerpt":"Minikube est un outil idéal pour configuer localement Kubernetes afin de tester et d’expérimenter vos déploiements. Dans ce guide, je vais essayer de vous aider à le mettre en marche sur votre machine locale, à donner quelques conseils sur où et comment effectuer certaines tâches et à le rendre aussi capable (je suppose quand vous utilisez k8s que vous veulent apprendre et utiliser Helm, etcd, istio, etc.). Installation de minikube Minikube fonctionne avec une machine virtuelle. Pour cela, on peut utiliser diverses options en fonction de vos préférences et de votre système d’exploitation. Ma préférence dans ce cas est Orable VirtualBox. Vous pouvez utiliser brew pour tout installer: Dans ce cas, vous pourriez obtenir une erreur d’installation peu concluante liée à l’installation de virtualbox, en particulier sur Mojave et problablement par la suite. Quoi qu’il en soit, il s’agit problablement d’une nouvelle fonctionnalité de sécurité dans MacOs X qui vous gêne. Allez dans Préférences Système> Sécurité et confidentialité et sur l’écran Général, vous verrez un (ou quelques) messages concernant certains logiciels nécessitant une approbation pour être installés. Vous devez examiner attentivement la liste s’il en existe plusieurs et autoriser l’installation du logiciel dont vous avez besoin - dans ce cas, le logiciel Oracle. Cela fait, vous pourrez relancer la commande ci-dessus et vous devrez alors être prêt pour les étapes suivantes. Exécuter et accéder au cluster Afin d’utiliser de manière optimale les ressources de votre ordinateur local, je suggérerais de l’arrêter quand vous n’en avez plus besoin… Avec VirtualBox au centre, il utilisera la batterie de votre ordinateur portable assez rapidement. Recommencer plus tard vous ramènera là où vous l’avez laissé: Le tableau de bord Kubernetes est également disponible (lorsque minikube est en cours d’exécution): Je vais supposer que vous avez kubectl installé localement et que vous l’utilisez déjà pour certains clusters distants, vous disposez donc de plusieurs contextes. Dans ce cas, vous devez répertorier les contextes et passer à minikube. Vous vous trouvez maintenant dans le contexte de votre cluster k8 local qui s’exécute sur minikube et vous pouvez effectuer toutes les opérations k8 qu’il contient. Ingress Pour exécuter vos déploiements comportant un ingress, vous aurez besoin d’un add-on d’entrée: Assurez-vous que vous configurez l’ingress en fonction de vos hôtes locaux. Cela signifie fondamentalement que tout ce que vous définissez comme hôte dans vos règles d’ingress doit être configuré dans votre fichier /etc/hosts Où [minikube ip] devrait être remplacé par l’ip actuel de minikube. Il fonctionne également avec plusieurs hôtes locaux séparés par des espaces après l’adresse ip de minikube. Voici un raccourci pour le faire en bash Docker registry La réalité de l’utilisation réelle du registre de conteneurs dans l’environnement local est rude. Je vais donc vous fournir une option simple, rapide et simpliste qui facilite le déploiement de votre travail local sur vos k8s locaux, mais vous prive de l’expérience très importante du registre de conteneurs. Registre de conteneurs local Obtenez le contexte de votre docker local pour pointer vers le context minikube:  Dans le contexte minikube, pour démarrer le registre docker local Donc, vous avez maintenant un registre local dans lequel pousser des choses (tant que votre docker est dans le contexte minikube) Vous pouvez maintenant faire: A ce stade, vous pouvez utiliser localhost:5000/<your_tag>: comme image dans votre déploiement et c’est tout. Utilisation du référentiel de conteneur distant Pour utiliser localement le référentiel de conteneur distant, vous devez fournir un moyen d’authentification, qui se base sur les secrets de Kubernetes. Pour la gestion des secrets locaux pour ECR, GCR and Docker registry, je recommande d’utiliser l’addon minikube appelé registry-creds. Je ne le considère pas suffisamment sûr pour être utilisé ailleurs que dans l’environnement local. Helm Helm est un gestionnaire de paquets pour k8s et est souvent utilisé pour la gestion de la configuration d’un déploiement à l’autre. Compte tenu de la grande popularité de l’outil et de son adoption croissante, je voudrais terminer ce guide par une note sur l’ajout de helm à votre environnement Kubernetes local. C’est assez facile à ce stade, il suffit de mettre en place minikube et: Helm utilise un backend appelé Tiller. C’est ce qui est installé/déployé lors de l’exécution de helm init. Une lecture précieuse: https://helm.sh/docs/using_helm/ Maintenant, vous disposez d’un environnement Kubernetes local complet capable d’accepter tous vos déploiements de test avant de décider de les placer dans le cloud.","timeToRead":4,"frontmatter":{"title":"Configuration locale de Kubernetes avec minikube sur MacOS X","subtitle":"","tags":["Kubernetes","DevOps"],"category":["Kubernetes","DevOps"],"date":"2019-05-23T08:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7809439002671417,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFA//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHN5DxbJYf/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIDEBET/9oACAEBAAEFAlaRsOmEbZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAMgEgMf/aAAgBAQAGPwJhpNp//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITFhgf/aAAgBAQABPyHSUvSOU7FgtjtClyf/2gAMAwEAAgADAAAAEGQv/8QAFhEBAQEAAAAAAAAAAAAAAAAAABFB/9oACAEDAQE/EMV//8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Qp//EABoQAQEAAwEBAAAAAAAAAAAAAAEAESExUZH/2gAIAQEAAT8QTFAXqtS5LFXZken2T1hAFInS/9k=","sizes":"(max-width: 2000px) 100vw, 2000px","src":"/static/aac12d8124ce6730c0247f5495bff894/883ab/ship.jpg","srcSet":"/static/aac12d8124ce6730c0247f5495bff894/f8f18/ship.jpg 930w,\n/static/aac12d8124ce6730c0247f5495bff894/0e6ff/ship.jpg 1860w,\n/static/aac12d8124ce6730c0247f5495bff894/883ab/ship.jpg 2000w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/k8s-minikube/"}},"primaryTag":"Bash","primaryCategory":"Bash"}}}