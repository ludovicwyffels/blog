{"componentChunkName":"component---src-templates-blog-tsx","path":"/","webpackCompilationHash":"28b74a5dec589e4586df","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY023PvUrDUBTA8ZuCtoMoOLQ4dWhN14x2kEKXFkGoohQ/QBexOHRycAidKkgHHRq69APRoTjFJYODIA6+gSBYfYMmfYLE/5VT6NALP845NyeHc9UoCHZRQvonCLKKE4ZhAXYURTsYoE9dIy5iCzfUJnEdV+RF4iu6ikFH2EPxazzOcJmg4Rnn5C8ysIEOHqTe5/sT3qXOwYOtRr5/wLAqzpCTDXu4p2ETtyjgGJ/cX+se8jeU9fa4RBt5vWENpjzdkoGPcGg4RQsbOMEFmnBRRwVDHEK/yFXfvr/CoPjvZLKcdByDyzWGeajigzorGy0oOeRJiUtITe/pX1XzDk3buIMltSFR/zTtic3060X+8z8PsEUt8G3LVQAAAABJRU5ErkJggg==","width":400,"height":128,"src":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png","srcSet":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png 1x"}}},"header":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcZUED//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAWEAADAAAAAAAAAAAAAAAAAAAAASD/2gAIAQEAAT8hHP8A/9oADAMBAAIAAwAAABD47//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAAMBAQAAAAAAAAAAAAAAAAABERAh/9oACAEBAAE/EKPlG+FP/9k=","aspectRatio":1.4992503748125936,"src":"/static/9fb9647467dab072b9ebe36e9e52ae95/883ab/blog-cover.jpg","srcSet":"/static/9fb9647467dab072b9ebe36e9e52ae95/32ee9/blog-cover.jpg 500w,\n/static/9fb9647467dab072b9ebe36e9e52ae95/2f7e7/blog-cover.jpg 1000w,\n/static/9fb9647467dab072b9ebe36e9e52ae95/883ab/blog-cover.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"allMarkdownRemark":{"edges":[{"node":{"timeToRead":2,"frontmatter":{"title":"Bien g√©rer ses textes de commit (partie 2)","subtitle":"Mettons en place l'application de la norme \"conventional-changelog\" pour un nouveau projet","date":"2019-08-11T18:00:00.000Z","tags":["Git","Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABVLywQM4t/8QAGRABAQEAAwAAAAAAAAAAAAAAAgEAAxIi/9oACAEBAAEFAjYbGa/OO5x2O//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAABEv/aAAgBAgEBPwFiP//EAB0QAAIBBAMAAAAAAAAAAAAAAAABMgIQERIhQVH/2gAIAQEABj8ClwVbPD6JCG/Lf//EABwQAAMAAgMBAAAAAAAAAAAAAAABESExQVGBkf/aAAgBAQABPyGUSNvqLg0lKYL1eiZVcsToWHs//9oADAMBAAIAAwAAABAzL//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAWEQEBAQAAAAAAAAAAAAAAAAABMRD/2gAIAQIBAT8QFjMP/8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUExUZFh/9oACAEBAAE/EAltBA8O42KxjwXf2Jc+6ZIoPW0uXQptIchpjqk//9k=","aspectRatio":1.5056461731493098,"src":"/static/bb024aed8b63b69834a2bfb23baa20cf/81ef8/nature.jpg","srcSet":"/static/bb024aed8b63b69834a2bfb23baa20cf/f8f18/nature.jpg 930w,\n/static/bb024aed8b63b69834a2bfb23baa20cf/81ef8/nature.jpg 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Nous sommes tous pass√©s par l√†. Qu‚Äôil s‚Äôagisse d‚Äôun calendrier serr√©, de corrections constantes ou simplement de la cr√©ation de messages avec notre propre mod√®le d√©fini; nous avons tous fait de mauvais messages de commit. Heureusement pour nous, la sp√©cification Conventional Commits existe, et avec elle un ensemble d‚Äôoutils puissants pour nous aider. Application d‚Äôune norme Pour faire respecter une norme √† chaque fois que nous nous faisons un commit, nous avons husky et commitling. Husky √©coute les git hooks, et nous l‚Äôutiliserons pour d√©clencher le commitlint lorsque nous tapons un message de commit. Maintenant, installons les paquets : Apr√®s avoir install√© ces paquets, vous devez cr√©er un fichier commitlint.config.js dans le m√™me dossier que votre package.json : Et modifier votre package.json: Tout est pr√™t! Maintenant, vos messages seront linted. Nous les commitons avec commitizen Commitizen est un paquet qui facilite la cr√©ation de messages de commit selon la sp√©cification pr√©c√©dente. Pour ce faire, vous devez l‚Äôinstaller globalement et configurer votre projet. Maintenant, faites un changement, ajoutez-le et lancez git cz. Automatisation Nous avons ajout√© des outils pour assurer et faciliter la validation des messages de commit selon les sp√©cifications conventionnelles de commit. Non seulement nous avons re√ßu des messages standard sur l‚Äôensemble du projet que les humains peuvent lire, mais aussi des machines. Oui, des machines. Le respect de ces normes a permis aux machines de comprendre le motif, et avec cela, de mettre √† jour automatiquement la version de nos paquets et de g√©n√©rer des changelogs. Version bumping et CHANGELOG Pour faire les deux actions, nous n‚Äôavons besoin que d‚Äôun seul paquet, standard-version. Ce paquet le fera: Analyser vos engagements depuis votre derni√®re version (tag) Version bump votre paquet.json G√©n√©rer ou mettre √† jour un fichier CHANGELOG.md G√©n√©rer un message de livraison G√©n√©rer une nouvelle balise Utilisons-la donc : Mettez √† jour votre paquet.json : Et maintenant vous n‚Äôavez plus qu‚Äô√† lancer npm run release. Alternativement, si vous souhaitez simplement g√©n√©rer un fichier changelog, je vous recommande le fichier conventionnel-changelog-cli. Quelle est la prochaine √©tape? Apr√®s avoir gagn√© en lisibilit√© et en automatisation des t√¢ches quotidiennes douloureuses, vous pouvez cr√©er votre propre standard bas√© sur les sp√©cifications conventionnelles de commit. La famille d‚Äôoutils conventionnel-changelog vous permet et vous facilite la cr√©ation de votre propre version si vous le souhaitez. J‚Äôesp√®re que ce message vous a aid√©. S‚Äôil y a quoi que ce soit, partagez de l‚Äôinformation qui pourrait l‚Äôam√©liorer et la rendre meilleure pour les autres!","fields":{"layout":"post","slug":"/git-manage-commit-text-part2/"}}},{"node":{"timeToRead":4,"frontmatter":{"title":"Bien g√©rer ses textes de commit (partie 1)","subtitle":"Que l‚Äôon soit backend, frontend, il y a une chose qui nous rassemble, c‚Äôest notre gestionnaire de source et son utilisation. Dans cet article, je vais vous pr√©senter le conventional-changelog qui vous permettra de produire un historique de super qualit√© !","date":"2019-08-11T08:00:00.000Z","tags":["Git","Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABVLywQM4t/8QAGRABAQEAAwAAAAAAAAAAAAAAAgEAAxIi/9oACAEBAAEFAjYbGa/OO5x2O//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAABEv/aAAgBAgEBPwFiP//EAB0QAAIBBAMAAAAAAAAAAAAAAAABMgIQERIhQVH/2gAIAQEABj8ClwVbPD6JCG/Lf//EABwQAAMAAgMBAAAAAAAAAAAAAAABESExQVGBkf/aAAgBAQABPyGUSNvqLg0lKYL1eiZVcsToWHs//9oADAMBAAIAAwAAABAzL//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAWEQEBAQAAAAAAAAAAAAAAAAABMRD/2gAIAQIBAT8QFjMP/8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUExUZFh/9oACAEBAAE/EAltBA8O42KxjwXf2Jc+6ZIoPW0uXQptIchpjqk//9k=","aspectRatio":1.5056461731493098,"src":"/static/bb024aed8b63b69834a2bfb23baa20cf/81ef8/nature.jpg","srcSet":"/static/bb024aed8b63b69834a2bfb23baa20cf/f8f18/nature.jpg 930w,\n/static/bb024aed8b63b69834a2bfb23baa20cf/81ef8/nature.jpg 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Que l‚Äôon soit backend, frontend, il y a une chose qui nous rassemble, c‚Äôest notre gestionnaire de source et son utilisation. Dans cet article, je vais vous pr√©senter le conventional-changelog qui vous permettra de produire un historique de super qualit√© üôå! Le probl√®me Combien d‚Äôentre vous sont tomb√©s sur des projets avec un historique qui ressemble √† cela: ü§ï Comment s‚Äôy retrouver? Comment exploiter un historique qui ne vous donne quasiment jamais d‚Äôinformation. La solution, c‚Äôest d‚Äôutiliser le Conventional-Changelog (oui, on dirait une pub de t√©l√©-achat üòù). Qu‚Äôest-ce que c‚Äôest le conventional-changelog? C‚Äôest bien de vous vendre une solution, mais il faudrait peut-√™tre expliquer ce que c‚Äôest‚Ä¶ en vrai. Le Conventional-Changelog est une mani√®re d‚Äô√©crire ses commits dans les projets. Il existe plusieurs ‚Äúflavours‚Äù, je vais vous d√©tailler la version Angular. Le format est le suivant: Si ce format est bien appliqu√©, cela peut donner ce type de texte de commit : C‚Äôest un peu plus agr√©able √† lire non ? Je vais vous d√©crire les diff√©rentes parties de cette convention et comment bien les utiliser. Type Le type permet de repr√©senter de mani√®re succincte le type d‚Äôaction que vous avez fait sur le projet : feat: Ajout d‚Äôune fonctionnalit√© fix: Correction perf: Am√©lioration des performances docs: Ajout de documentation style: Linting du code refactor: Modification du code, mutualisation et autres modifs afin d‚Äôam√©liorer le projet test: Ajout de tests unitaires, int√©gration, end-to-end chore: T√¢che m√©nag√®re, comme mettre √† jour les d√©pendances, reconfigurer la CI‚Ä¶ On ne peut mettre qu‚Äôun seul type par commit, donc finis les commits qui contiennent une feature et un fix en m√™me temps‚Ä¶ Scope Ici, pas de liste impos√©e, juste le titre de l‚Äô√©l√©ment sur lequel une modification a √©t√© faite. Nous avons tendance √† d√©finir clairement les scopes du projet √† l‚Äôavance afin que tout le monde commit avec les m√™mes scopes. Pour exemple, sur une application orient√©e ‚Äúe-commerce‚Äù, on pourrait avoir les scopes suivants : homepage search my-account product-details order admin Parfois, ce scope peut √™tre omis‚Ä¶ car il n‚Äôy en a pas forc√©ment ou vous avez touch√© √† l‚Äôapplication de mani√®re globale. Dans ce cas, laissez vide üòÖ Et par contre, comme pour le type, il ne peut y avoir qu‚Äôun seul scope. Donc si vous pensez avoir deux scopes‚Ä¶ faites deux commit diff√©rents Subject Le sujet doit contenir une description courte du changement effectu√© dans le commit. Quelques conseils pour formater le message : Utiliser l‚Äôimp√©ratif Utiliser le pr√©sent Pas de 1er lettre en majuscule Pas de point . √† la fin du sujet Body Le body est la partie ‚Äúprincipale‚Äù du commit. J‚Äôai tendance √† dire qu‚Äôelle doit contenir le ‚ÄúPourquoi‚Äù du commit. Si vous avez fait une modification structurante ou si la m√©thode d‚Äôimpl√©mentation est particuli√®re, √©crivez-le dans le body ! C‚Äôest un point de vue qui est personnel, mais je pense que le body est le meilleur endroit pour accueillir un commentaire‚Ä¶ car un message de commit ne se d√©synchronise jamais du code. Footer Cette derni√®re partie permet de placer les r√©f√©rences vers toutes les issues, User stories & co. On s‚Äôen sert g√©n√©ralement pour lier (Linked to) ou cl√¥turer (Closes) les issues directement depuis git. Autre √©l√©ment qui peut √™tre ajout√© dans ce footer est la notion de Breaking Change. Il suffit d‚Äôajouter BREAKING CHANGE: suivi du d√©tail de ce fameux breaking change. Je suis oblig√© d‚Äô√©crire tout cela √† chaque fois? Non, rassurez-vous, vous n‚Äô√™tes pas oblig√©‚Ä¶ m√™me s‚Äôil est bien de mettre un max d‚Äôinformation dans le message de commit. La convention veut que seule la 1√®re ligne soit obligatoire. Donc, libre √† vous, de ne pas mettre de body et de footer Conclusion Avec cette convention, vous prendrez plaisir √† fouiller dans l‚Äôhistorique de votre projet, trouver la source d‚Äôune modification et surtout savoir ‚ÄúPourquoi cela a √©t√© fait comme cela !‚Äù Et quand l‚Äôon regarde, la diff√©rence entre l‚Äôancienne version : et la nouvelle (certes, sur des projets diff√©rents): Cela est quand m√™me bien plus clair ! R√©f√©rence Git Commit Message Conventions","fields":{"layout":"post","slug":"/git-manage-commit-text-part1/"}}},{"node":{"timeToRead":2,"frontmatter":{"title":"Automatisez les mises √† jour des d√©pendances","subtitle":"Voyons comment automatiser ce processus dans un environnement d'entreprise en supposant que vous ayez un environnement CI/CD et un repo GitHub priv√©.","date":"2019-08-10T14:00:00.000Z","tags":["Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABqyn8s1EcD//EABoQAQACAwEAAAAAAAAAAAAAAAEAAgMREiL/2gAIAQEAAQUCt6Lruc6jUTJU7//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwGn/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECESFBcf/aAAgBAQAGPwJoblu0cFWEvRn/xAAdEAACAgIDAQAAAAAAAAAAAAAAAREhMWFBUYGR/9oACAEBAAE/Iai1LQ5jEVYJ38MVHkrSkQ8d/aKQoP/aAAwDAQACAAMAAAAQbz//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARFh/9oACAEDAQE/EIKx/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERYf/aAAgBAgEBPxCS9f/EABwQAQEBAQACAwAAAAAAAAAAAAERIQAxQVFhgf/aAAgBAQABPxAAqoN+Hsvt1wWQJ9POkMmdE3+hB5KT9nMSBAi5GuDMprM3v//Z","aspectRatio":1.5005861664712778,"src":"/static/8756b203d47a4deaf400dbe6dbdbc9ba/c108b/board-game-challenge.jpg","srcSet":"/static/8756b203d47a4deaf400dbe6dbdbc9ba/f8f18/board-game-challenge.jpg 930w,\n/static/8756b203d47a4deaf400dbe6dbdbc9ba/c108b/board-game-challenge.jpg 1280w","sizes":"(max-width: 1280px) 100vw, 1280px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Une application Node raisonnablement grande aura des centaines de d√©pendances. Les garder tous √† jour est une chose qu‚Äôun d√©veloppeur doit r√©aliser √† un moment ou √† un autre. Soit vous ignorez les mises √† jour des d√©pendances jusqu‚Äô√† ce que vous soyez coinc√© avec un tr√®s ancien ensemble de d√©pendances qui entravent votre progression avec les vuln√©rabilit√©s de s√©curit√© ou vous passez votre pr√©cieux temps de d√©veloppement d‚Äôapplication √† tester manuellement les mises √† jour sur une cadence raisonnable. Voyons comment automatiser ce processus dans un environnement d‚Äôentreprise en supposant que vous ayez un environnement CI/CD et un repo GitHub priv√©. Ingr√©dients Tests unitaires solides pour votre code. Points bonus si vous avez des tests de e2e et des tests snapshot pour les composants de l‚Äôinterface utilisateur. next-update Un paquet npm qui teste si vos d√©pendances peuvent √™tre mises √† jour sans casser les tests. hub CLI Il s‚Äôagit d‚Äôune application en ligne de commande de Git ‚ÄúHub‚Äù qui peut interagir avec votre GitHub repo. hub est exactement similaire √† git CLI et constitue un remplacement imm√©diat, mais dispose des fonctionnalit√©s suppl√©mentaires pour interagir avec GitHub. Pratique pour ouvrir une Pull Request apr√®s l‚Äôop√©ration de mise √† jour. Recette npm install next-update --save-dev\nInstallez next-update en tant que dev-dependency. Configurez un script npm dep:update dans votre section de scripts du fichier package.json npm run dep:update\nEx√©cutez le script. next-update ira de l‚Äôavant et trouvera tous les nouveaux paquets. Les met √† jour en s√©quence et conserve la mise √† jour si vos tests r√©ussissent. T√©l√©chargez et installez le hub cli Configurez hub Demander au bot d‚Äôouvrir une Pull Request Raccordez ce script dans votre environnement CI/CD pour qu‚Äôil s‚Äôex√©cute quotidiennement","fields":{"layout":"post","slug":"/node-automate-dependency-updates/"}}},{"node":{"timeToRead":3,"frontmatter":{"title":"Prise en main de PM2, le gestionnaire de processus Node.js","subtitle":"PM2, ou Process Manager 2 est un gestionnaire de processus de production incroyablement polyvalent, √©crit en Node.js.","date":"2019-08-01T21:00:00.000Z","tags":["PM2","Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7sbJEUL/AP/EABgQAQEAAwAAAAAAAAAAAAAAAAEAEBIh/9oACAEBAAEFAltmOmf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAIDEy/9oACAEBAAY/AoZX/8QAGRABAAIDAAAAAAAAAAAAAAAAAQARICEx/9oACAEBAAE/IUHpid7xtiVh/9oADAMBAAIAAwAAABAUD//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAAIDAAAAAAAAAAAAAAABEQBBIFHh/9oACAEBAAE/EFQSFpvAquOmid+YIS3Tw//Z","aspectRatio":1.7777777777777777,"src":"/static/73813d7b6a5ab8956ab1d3105c143941/c108b/pm2.jpg","srcSet":"/static/73813d7b6a5ab8956ab1d3105c143941/f8f18/pm2.jpg 930w,\n/static/73813d7b6a5ab8956ab1d3105c143941/c108b/pm2.jpg 1280w","sizes":"(max-width: 1280px) 100vw, 1280px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Utilisations de PM2 PM2 a beaucoup d‚Äôutilisations, jetons un coup d‚Äôoeil √† quelques-unes d‚Äôentre elles: Red√©marrage apr√®s un crash: PM2 nous permet de maintenir les processus en cours d‚Äôex√©cution Suivi et gestion des processus √† distance: un portail web vous permet de garder un oeil sur les precessus distants et de les g√©rer. Il ne se contente pas d‚Äôex√©cuter des applications Node: PM2 n‚Äôest pas limit√© aux seuls processus Node.js, c‚Äôest vrai, vous pouvez m√™me l‚Äôutiliser pour garder votre serveur Minecraft en ligne. PM2 peut m√©moriser tous vos processus et les red√©marrer apr√®s un red√©marrage du syst√®me. Et bien plus encore. Pour commencer La premi√®re chose que nous devons faire est d‚Äôinstaller PM2 globalement sur votre machine : Commandes de base Venons-en aux principe de base de son utilisation. Pour d√©marrer un processus sous PM2, il suffit de lancer pm2 start <app>. App √©tant le nom du fihier que vous ex√©cutez. PM2 produira quelque chose comme ceci Faites attention √† ce qu‚Äôil dis sous id. Si vous oubliez, lancez pm2 list. Si vous voulez ajouter un nom au processus lorsque vous le lancez, vous pouvez utiliser le param√®tre --name (pm2 start app.js --name my-api). Votre application fonctionne maintenant sous PM2, si elle plante, PM2 la red√©marrera. Red√©marrage en cas de modification de fichier Une autre fonctionnalit√© impressionnante que PM2 a est de red√©marrer quand un fichier dans le r√©pertoire de travail change. Pour que PM2 regarde notre r√©pertoire et red√©mmarre les changements de fichier, incluez --watch lorsque vous d√©marrez votre application. Persistance jusqu‚Äôau red√©marrage PM2 nous permet √©galement de d√©marrer nos processus lorsque notre serveur (re)d√©marre. Commencez tout ce que vous voulez avoir en cours d‚Äôex√©cution tout le temps √† travers pm2 start et puis ex√©cutez pm2 save. Maintenant, quand notre syst√®me red√©marre, PM2 d√©marrera tous les processus que nous avions en cours d‚Äôex√©cution lorsque nous avons lanc√© pm2 save. PM2 fait beaucoup de choses, je vais vous laisser d√©couvrir le reste par vous m√™me d‚Äôautres fonctions Le mode cluster Commandes Description pm2 start app.js -i 0 D√©marre un maximum de processus avec LB en fonction des CPU disponibles. Listen Commandes Description pm2 list Afficher l‚Äô√©tat de tous les processus pm2 jlist Impression de la liste des processus en JSON brut pm2 prettylist Impression de la liste des processus en JSON embelli pm2 describe 0 Afficher toutes les informations concernant un sp√©cifique pm2 monit Surveiller tous les processus Logs Commandes Description pm2 logs [--raw] Afficher tous les journaux de processus en streaming pm2 flush Vider tous les fichiers logs pm2 reloadLogs Recharger tous les logs Actions Commandes Description pm2 stop all Arr√™ter tous les processus pm2 restart all Red√©marrer tous les processus pm2 reload all Rechargement des temps d‚Äôarr√™t 0s (pour les applications NETWORKED) pm2 stop 0 Arr√™t d‚Äôun id de processus sp√©cifique pm2 restart 0 Red√©marrer un id de processus sp√©cifique pm2 delete 0 Supprimer le processus de la liste pm2 delete all Supprimer tous les processus de la liste PM2 fait beaucoup de choses, dont la plupart sortent du cadre de cette br√®ve introduction. A l‚Äôavenir, nous pourrions couvrir le mode cluster de PM2, la gestion des processus √† distance et plus encore. Merci de votre lecture !","fields":{"layout":"post","slug":"/node-pm2/"}}},{"node":{"timeToRead":11,"frontmatter":{"title":"Loopback 4 - Configuration de la base de donn√©es","subtitle":"Cet article va d√©crire quelques fa√ßons de configurer une application LoopBack 4 par rapport √† une base de donn√©es √† travers plusieurs environnements de d√©veloppement (dev, test et production).","date":"2019-06-29T21:00:00.000Z","tags":["LoopBack","Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAd2qFGs6KLKpA6D/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADERAS/9oACAEBAAEFAmYKBaNltZY+S8UYvf/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABcRAQADAAAAAAAAAAAAAAAAAAIBESD/2gAIAQIBAT8Bgmsf/8QAIBAAAgEBCQAAAAAAAAAAAAAAAREAAhASICExQVFhcf/aAAgBAQAGPwJmIg0+2MLTeZPu8IBxg//EABsQAAICAwEAAAAAAAAAAAAAAAERACEQIDGx/9oACAEBAAE/IWZQhjIPFTxZdwoB1CpF5SyGi0//2gAMAwEAAgADAAAAEGfvAP/EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPxBW4//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBHh/9oACAECAQE/EGaXkb//xAAeEAEBAAEEAwEAAAAAAAAAAAABESEAMUFhECBxwf/aAAgBAQABPxBSMi50HycxA+/j4mbfQaZtJz1qYZEiAUiAeB2k71ltDTzCen//2Q==","aspectRatio":1,"src":"/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg","srcSet":"/static/9611cacec962506545385f22b26d913d/f8f18/loopback.jpg 930w,\n/static/9611cacec962506545385f22b26d913d/0e6ff/loopback.jpg 1860w,\n/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Introduction Presque toutes les applications Web ont besoin de conserver des donn√©es sous une forme ou une autre. LoopBack a toujours abstrait le moteur de base de donn√©es de l‚Äôapplication en nous fournissant plusieurs connecteurs √† utiliser, tels que : MySQL, Postgres et In-memory. LoopBack 4 utilise les m√™mes biblioth√®ques sous-jacentes que LoopBack 3 pour passer la configuration aux moteurs. Cependant, les structures du projet sont l√©g√®rement diff√©rentes, comme indiqu√© ci-dessous. Configuration de LoopBack 3 Dans LoopBack 3, vous d√©finiriez un ensemble d‚Äôobjets JSON √† l‚Äôint√©rieur d‚Äôun fichier datasources.json stock√© dans le dossier serveur, ce qui permettrait √† l‚Äôapplication de r√©cup√©rer la configuration. Le fichier ressemblerait √† ceci : Ce fichier d√©finit une nouvelle source de donn√©es appel√©e ‚Äúdb‚Äù, qui est configur√©e pour utiliser le connecteur de base de donn√©es en m√©moire. Dans la plupart des applications, c‚Äôest une excellente source de donn√©es par d√©faut pour les mod√®les, car elle √©limine le besoin de configurer un serveur de base de donn√©es lors du premier d√©marrage avec un prototype. Vous pouvez simplement configurer les mod√®les pour utiliser la source de donn√©es ‚Äúdb‚Äù et continuer avec le code. Le fichier model-config.json, dans le m√™me dossier, relierait un mod√®le √† une source de donn√©es et ressemblerait √† ceci : Une fois que vous avez la base de votre application en place et en cours d‚Äôex√©cution par rapport √† la configuration de la base de donn√©es en m√©moire, vous pouvez vous concentrer sur la configuration d‚Äôun serveur de base de donn√©es, tel que MySQL ou Postgres, installer le bon connecteur et simplement modifier la configuration datasources.json comme suit : C‚Äôest excellent pour le d√©veloppement local. Mais, lorsque vous travaillez au sein d‚Äôune √©quipe plus importante ou avec plusieurs environnements, un seul fichier de configuration JSON ne va pas le couper. LoopBack 3 a r√©solu la configuration sp√©cifique √† l‚Äôenvironnement en nous permettant de cr√©er des fichiers de sources de donn√©es sp√©cifiques √† l‚Äôenvironnement. Le nom du fichier de source de donn√©es sp√©cifique √† l‚Äôenvironnement devait √™tre dans une certaine structure : datasources.<environment>.js. Un projet avec 3 environnements aurait les fichiers suivants : datasources.json (une configuration de serveur de base de donn√©es locale) datasources.test.js (une configuration de serveur de base de donn√©es de test) datasources.production.js (une configuration de serveur de base de donn√©es de production) La version JavaScript du fichier de configuration nous a donn√© une flexibilit√© suppl√©mentaire, car nous avons pu d√©terminer la configuration √† l‚Äôaide de code. Le fichier de configuration le plus courant utilise les variables d‚Äôenvironnement syst√®me. Un exemple de fichier de configuration d‚Äôune source de donn√©es de production serait le suivant : C‚Äôest g√©nial, car cela √©limine le besoin de stocker les r√©f√©rences de production dans notre code. Nous pourrions livrer ces fichiers de configuration et configurer la configuration sur le serveur, en toute s√©curit√©. Par d√©faut, le framework utiliserait la variable d‚Äôenvironnement syst√®me NODE_ENV pour choisir le fichier source √† utiliser. Un serveur de production aurait les variables d‚Äôenvironnement suivantes : NODE_ENV=production DB_HOST=aws-rds-mysql-host.example.com DB_PORT=3306 DB_USER=super-secret-user DB_PASSWORD=super-secret-password DBDATABASE=appdatabase Configuration LoopBack 4 LoopBack 4 ne lit plus automatiquement les fichiers de configuration des sources de donn√©es. Au lieu de cela, le framework nous laisse d√©cider comment nous voulons configurer notre application. Pour l‚Äôinstant, il ne semble pas qu‚Äôil existe de meilleures pratiques document√©es pour la mise en place d‚Äôun tel syst√®me. Une approche est sugg√©r√©e ci-dessous. D√©pendance Injection Avant de nous plonger dans la configuration de la base de donn√©es, nous devons comprendre l‚Äôun des concepts cl√©s de LoopBack 4 : Injection de d√©pendance. Essentiellement, l‚Äôapplication peut enregistrer des valeurs sur une liste de cl√©s uniques. Ces valeurs peuvent contenir des variables normales ou des d√©finitions de classes, que l‚Äôapplication peut ensuite utiliser pour g√©rer la cr√©ation de ces objets pour nous, en reprenant les d√©pendances requises. Par exemple, on peut enregistrer une valeur,‚Äòbar‚Äô sur une cl√© ‚Äòfoo‚Äô. Maintenant l‚Äôapplication sait que la cl√© ‚Äòfoo‚Äô, contient la valeur ‚Äòbar‚Äô. Nous pouvons demander cette valeur √† partir de l‚Äôapplication n‚Äôimporte o√π dans notre code. √Ä titre d‚Äôexemple : En plus de lier une valeur √† une cl√©, nous pouvons lier une classe √† une cl√© et laisser l‚Äôapplication calculer r√©cursivement ses d√©pendances lors de l‚Äôinstanciation de l‚Äôobjet sur demande. Quand nous demandons une instance de la classe Foo, comme suit: Le conteneur d‚Äôapplication verra que la classe Foo d√©pend de la valeur de la barre. Il le recherchera dans le conteneur de d√©pendances, le trouvera (s‚Äôil est li√©) et l‚Äôinjectera ensuite dans la classe. D‚Äôo√π l‚Äôinjection de d√©pendance. Cr√©er un nouveau projet On peut utiliser la CLI pour cr√©er un nouveau projet en appelant la commande suivante : LoopBack 4 ajoute un dossier datasources au projet. Initialement, on supposerait que ce dossier est configur√© pour √™tre lu de la m√™me mani√®re que les fichiers JSON des sources de donn√©es LoopBack 3. Cependant, c‚Äôest juste le dossier par d√©faut utilis√© par le CLI pour y d√©poser les nouveaux fichiers. Ajout d‚Äôune source de donn√©es √† l‚Äôaide de l‚Äôinterface CLI Utilisez le CLI pour cr√©er une nouvelle source de donn√©es en ex√©cutant la commande suivante : La premi√®re chose que vous remarquerez est que le fichier db.datasource.json est exactement le m√™me que le fichier LoopBack 3 datasources.json. Dans l‚Äôassistant CLI, j‚Äôai choisi le connecteur en m√©moire, qui est l‚Äôun des nombreux connecteurs disponibles dans LoopBack 3 et LoopBack 4. Le nouvel ajout √† la famille de fichiers de source de donn√©es LoopBack est le fichier datasource.ts. La classe √©tend un type juggler.DataSource, qui est le m√™me type que celui utilis√© dans LoopBack 3 (sauf que c‚Äôest la version de d√©finition TypeScript). Il n√©cessite la m√™me structure de configuration JSON que LoopBack 3. Dans cette version, nous devons passer la configuration √† la super m√©thode du constructeur. Le fichier importe la configuration par d√©faut du fichier db.datasource.json et l‚Äôinclut comme valeur par d√©faut dans le param√®tre dsConfig du constructeur. Cela signifie que nous n‚Äôaurons jamais besoin de passer quoi que ce soit dans le constructeur de la classe DbDataSource lors de l‚Äôinstanciation d‚Äôune instance de l‚Äôobjet, √† moins de l‚Äô√©craser‚Ä¶ peut-√™tre pour un environnement diff√©rent (nous y reviendrons). L‚Äôautre d√©corateur d‚Äôinjection peu familier permet au framework d‚Äôinjecter la valeur du param√®tre depuis le conteneur d‚Äôinjection de d√©pendance (s‚Äôil est li√©). Dans cette optique, il existe de nombreuses fa√ßons d‚Äôinstancier cette nouvelle classe DataSource : Nous avons maintenant une instance de notre dbDataSource. Mais, comment l‚Äôutilise-t-on r√©ellement ? Comment notre nouvelle application conna√Æt-elle notre source de donn√©es ? De la m√™me mani√®re que nous pouvons enregistrer (ou lier) des valeurs (ou classes) contre les applications Dependency Container, nous pouvons lier l‚Äôinstance de la source de donn√©es √† une cl√© du conteneur. Dans notre fichier application.ts, nous pouvons utiliser la fonction de liaison des applications dans le constructeur pour lier notre instance √† l‚Äôapplication : En outre, LoopBack 4 a une fonction sp√©ciale appel√©e source de donn√©es : Il existe une derni√®re m√©thode pour lier notre source de donn√©es √† l‚Äôapplication: L‚Äôextrait de code ci-dessus lie d‚Äôabord la configuration √† la cl√© de d√©pendance ‚Äô\ndatasources.config.db. Cette cl√© de d√©pendance est r√©f√©renc√©e dans le constructeur de la classe DbDataSource via le d√©corateur inject. En liant la cl√© datasources.db √† la d√©finition de classe ‚ÄúDbDataSource‚Äù, le conteneur de d√©pendances va rechercher toutes ses d√©pendances et les instancier pour nous. Maintenant que le conteneur de d√©pendances de l‚Äôapplication conna√Æt notre source de donn√©es, nous pouvons la lier √† un r√©f√©rentiel et un mod√®le. Note : vous devez d‚Äôabord g√©n√©rer un mod√®le avant de g√©n√©rer un r√©f√©rentiel. Pour ce faire, utilisez la commande mod√®le lb4 : Apr√®s avoir cr√©√© un mod√®le, relions-le √† un nouveau r√©f√©rentiel. Utilisez la commande lb4 repository : Une fois que vous avez utilis√© le mod√®le lb4 et la commande lb4 repository, vous devriez vous retrouver avec un r√©f√©rentiel li√© √† un mod√®le qui injecte la classe DbDataSource : Notez que le constructeur PersonRepository utilise √† nouveau le d√©corateur inject mais cette fois-ci il fait r√©f√©rence √† la cl√© datasources.db que nous avons d√©finie pr√©c√©demment. Le r√©f√©rentiel est responsable de la connexion du mod√®le √† la source de donn√©es et fournit les fonctions CRUD (Create, Read, Update and Delete), gr√¢ce √† la classe DefaultCrudRepository dont nous h√©ritons. De la m√™me mani√®re que nous avons li√© la source de donn√©es √† l‚Äôapplication, nous devons lier le r√©f√©rentiel √† l‚Äôapplication : Une fois enregistr√©, nous pouvons utiliser la commande contr√¥leur lb4 pour cr√©er un nouveau contr√¥leur REST pour nous, qui utilise notre nouveau mod√®le de configuration, source de donn√©es et r√©f√©rentiel : Vous pouvez enregistrer le contr√¥leur contre l‚Äôapplication de la m√™me mani√®re que nous avons la source de donn√©es et le r√©f√©rentiel. En plus d‚Äôutiliser les fonctions de r√©f√©rentiel et de contr√¥leur pour lier nos classes √† notre application, LoopBack les lie automatiquement pour nous. Ceci peut √™tre configur√© dans le constructeur de classe d‚Äôapplication : Ceci indique √† notre application de regarder √† l‚Äôint√©rieur du dossier Contollers pour tous nos contr√¥leurs et appelle automatiquement this.controller pour nous. Vous pouvez √©galement configurer la valeur du r√©f√©rentiel bootOptions pour faire de m√™me avec les r√©f√©rentiels. Nous n‚Äôanalyserons pas ici l‚Äôensemble du fichier du contr√¥leur pour gagner de la place. Les sections importantes seront soulign√©es : Le d√©corateur du r√©f√©rentiel s‚Äôenroule autour du d√©corateur d‚Äôinjection. C‚Äôest la m√™me chose que de faire ce qui suit : Nous pouvons maintenant utiliser le r√©f√©rentiel pour acc√©der √† nos donn√©es de mod√®le dans notre source de donn√©es configur√©e. Conclusion Cet article compare les diff√©rences entre la configuration d‚Äôune source de donn√©es de base de donn√©es et une application LoopBack 3 et LoopBack 4. En plus de comprendre comment configurer une source de donn√©es, nous avons examin√© comment configurer la configuration en fonction de divers environnements en permettant aux donn√©es de configuration d‚Äô√™tre d√©finies par les variables d‚Äôenvironnement syst√®me, auxquelles nous acc√©dons par process.env.ENV_VARIABLE.","fields":{"layout":"post","slug":"/node-loopback-database/"}}},{"node":{"timeToRead":7,"frontmatter":{"title":"Premiers pas avec LoopBack 4","subtitle":"LoopBack 4 est un framework d'API open-source. La derni√®re version a adopt√© les derni√®res fonctionnalit√©s de ES2016/2017/2018, supporte TypeScript et int√®gre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d'autres.","date":"2019-06-29T08:00:00.000Z","tags":["LoopBack","Node.js"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAd2qFGs6KLKpA6D/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADERAS/9oACAEBAAEFAmYKBaNltZY+S8UYvf/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABcRAQADAAAAAAAAAAAAAAAAAAIBESD/2gAIAQIBAT8Bgmsf/8QAIBAAAgEBCQAAAAAAAAAAAAAAAREAAhASICExQVFhcf/aAAgBAQAGPwJmIg0+2MLTeZPu8IBxg//EABsQAAICAwEAAAAAAAAAAAAAAAERACEQIDGx/9oACAEBAAE/IWZQhjIPFTxZdwoB1CpF5SyGi0//2gAMAwEAAgADAAAAEGfvAP/EABYRAQEBAAAAAAAAAAAAAAAAAAERIP/aAAgBAwEBPxBW4//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBHh/9oACAECAQE/EGaXkb//xAAeEAEBAAEEAwEAAAAAAAAAAAABESEAMUFhECBxwf/aAAgBAQABPxBSMi50HycxA+/j4mbfQaZtJz1qYZEiAUiAeB2k71ltDTzCen//2Q==","aspectRatio":1,"src":"/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg","srcSet":"/static/9611cacec962506545385f22b26d913d/f8f18/loopback.jpg 930w,\n/static/9611cacec962506545385f22b26d913d/0e6ff/loopback.jpg 1860w,\n/static/9611cacec962506545385f22b26d913d/883ab/loopback.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"LoopBack 4 est un framework d‚ÄôAPI open-source pour Node.js. La derni√®re version a adopt√© les derni√®res fonctionnalit√©s de ES2016/2017/2018, supporte TypeScript et int√®gre de nouveaux standards tels que OpenAPI Spec et GraphQL, parmi d‚Äôautres. Cet article a pour but de guider les d√©butants √† travers la documentation et d‚Äôexpliquer les points cruciaux n√©cessaires pour commencer √† construire un projet d‚ÄôAPI LoopBack 4 maintenable. Installation Assurez-vous d‚Äôavoir Node.js version 8+ install√© sur votre machine. Le monorepo LoopBack inclut un package CLI, qui nous aidera dans l‚Äô√©chafaudage de notre application LoopBack 4. Pour l‚Äôinstaller, ex√©cutez la commande suivante sur votre terminal : Cr√©er un nouveau projet Une fois que l‚Äôoutil LoopBack 4 CLI a √©t√© install√© en global sur notre machine locale, nous pouvons √©chafauder notre application en utilisant la commande suivante : Le terminal pr√©sentera les demandes d‚Äôentr√©e suivantes, que j‚Äôai remplies ci-dessous et qui formeront la base de notre exemple d‚ÄôAPI pour l‚Äôavenir. Apr√®s avoir parcouru l‚Äôassistant CLI ci-dessus, il cr√©era un tas de r√©pertoires et de fichiers boilerplate ainsi que lancera npm install √† notre place. Nous pouvons alors naviguer dans notre r√©pertoire nouvellement cr√©√© et d√©marrer l‚Äôapplication. Si tout s‚Äôest bien d√©roul√©, vous devriez voir le r√©sultat suivant : Le projet expose un simple endpoint GET /ping. Ce qui n‚Äôest pas clair dans la sortie du terminal, ou dans la documentation de d√©marrage, c‚Äôest que l‚Äôapplication LoopBack 4 expose √©galement un endpoint qui rendra la documentation OpenAPI Spec. Pour y acc√©der, il vous suffit d‚Äôouvrir votre navigateur et d‚Äôaller √† l‚Äôurl suivante : http://localhost:3000/swagger-ui. LoopBack 4 OpenAPI Cette fonctionnalit√© permet aux d√©veloppeurs d‚ÄôAPI de documenter facilement leurs services Web au fur et √† mesure que le code est √©crit et de tester les endpoints d‚Äôune mani√®re conviviale. Exploration de l‚Äôexpression standard Le LoopBack CLI cr√©e beaucoup de fichiers et de dossiers pour nous. R√©duisons le bruit et concentrons-nous sur les √©l√©ments dont nous avons besoin pour mettre en place et faire fonctionner un nouveau endpoint. LoopBack 4 Structure du projet Un fichier ping.controller.ts initial est cr√©√© pour nous. C‚Äôest la convention de nommage par d√©faut que l‚Äôapplication LoopBack applique par configuration, qui peut √™tre modifi√©e dans le fichier application.ts et qui sera explor√©e dans de futurs articles. Apr√®s avoir ouvert le fichier ping.controller.ts, nous pouvons voir que le code utilise des d√©corateurs TypeScript pour fournir des m√©tadonn√©es HTTP √† la fonction ping() TypeScript dans la classe PingController. Ce d√©corateur permet √† l‚Äôapplication LoopBack de savoir que toute requ√™te HTTP GET doit invoquer la fonction ping(). La fonction ping() renvoie un objet JSON simple. L‚Äôapplication LoopBack s‚Äôoccupe de la s√©rialisation automatique des donn√©es de r√©ponse, qui est dans ce cas JSON. Cr√©ation d‚Äôun nouveau Endpoint\nUn nouveau point final peut √™tre cr√©√© en √©crivant une nouvelle fonction d√©cor√©e sur le PingController dans le fichier ping.controller.ts en se r√©f√©rant √† la fonction ping() existante. LoopBack nous permet √©galement de cr√©er facilement de nouveaux contr√¥leurs en utilisant le CLI : Afin d‚Äôutiliser le contr√¥leur REST avec l‚Äôoption de fonctions CRUD, nous devons d‚Äôabord avoir un r√©f√©rentiel que nous examinerons dans les prochains articles. Si nous ex√©cutons notre serveur avec npm, d√©marrez et rafra√Æchissez notre navigateur OpenAPI, remarquez qu‚Äôil n‚Äôy a pas encore de mention d‚Äôun PaymentController. C‚Äôest parce que nous n‚Äôavons pas encore mapp√© de fonctions aux chemins HTTP pour l‚Äôapplication LoopBack √† documenter en utilisant les sp√©cifications OpenAPI. Une fonction appel√©e paye accepte un seul param√®tre paiement de type any et retourne un Object. Nous utilisons deux d√©corateurs : Ce qui dit √† LoopBack de mapper la fonction pay() √† une m√©thode HTTP POST sur les requ√™tes entrantes /payments et qui indique √† LoopBack de mapper le corps de requ√™te HTTP POST au param√®tre de paiement de la fonction pay(). LoopBack analysera automatiquement le corps de requ√™te HTTP JSON en fonction du type requis, ce qui est le cas dans ce cas. En r√©ex√©cutant le serveur (npm start) et en rafra√Æchissant le navigateur OpenAPI Spec, le PaymentController sera pr√©sent avec un endpoint POST /payments. PaymentController - POST /payments Le navigateur OpenAPI Spec affiche les param√®tres disponibles que nous pouvons utiliser pour interagir avec l‚ÄôAPI, qui est juste un corps de requ√™te HTTP pour le moment. Nous pouvons tester ce endpoint en appuyant sur le bouton ‚ÄúTry it out‚Äù en haut √† droite. Test POST /payments La valeur d‚Äôexemple a √©t√© initialis√©e avec un objet JSON vide. Ce n‚Äôest pas tr√®s utile, car cela ne communique pas les valeurs attendues par le endpoint. Gr√¢ce √† des normes REST simples, nous pouvons √©tablir que nous pouvons probablement utiliser ce endpoint pour effectuer un paiement, mais quelles sont les propri√©t√©s exactes que nous pouvons transmettre ici? Valeur? Devise? Montant? Param√®tres du document √† l‚Äôaide des d√©finitions de mod√®le Dans LoopBack 3.x, tout √©tait pilot√© par un mod√®le, qui √©tait un simple fichier de configuration JSON d√©crivant les propri√©t√©s du mod√®le et leurs types. Les fichiers de d√©finition de mod√®le permettaient √©galement aux d√©veloppeurs de sp√©cifier si le mod√®le √©tait persistant ou non et de mapper les propri√©t√©s JSON sur des colonnes sp√©cifiques aux bases de donn√©es (si n√©cessaire). Le fichier permettait √©galement de configurer des validations, des relations, des acls (Access Control Lists) et des m√©thodes √† distance. LoopBack 4 a pour but de d√©coupler beaucoup de ces √©l√©ments afin de permettre une plus grande flexibilit√©. Nous pouvons toutefois r√©utiliser une grande partie de la structure syntaxique des m√©tadonn√©es dans LoopBack 4, en cons√©quence. Nous utilisons la classe Model ci-dessus pour d√©clarer que la classe PaymentRequest n‚Äôest pas persistante, car elle n‚Äôest pas conforme √† l‚Äôinterface Persistable (qui se trouve dans le paquet LoopBack Repository). La classe Entity, utilis√©e dans les articles ult√©rieurs, impl√©mente l‚Äôinterface Persistable et inclut une fonction qui est utilis√©e pour d√©finir quelle propri√©t√© d√©termine son caract√®re unique, c‚Äôest-√†-dire qu‚Äôelle a un identifiant unique et peut √™tre stock√©e/persist√©e dans une source de donn√©es (Data Source). La classe PaymentRequest est utilis√©e pour mod√©liser les donn√©es de notre module POST /payments HTTP Request. Le d√©corateur @model() peut √™tre utilis√© pour inclure des m√©tadonn√©es suppl√©mentaires pour le mod√®le. Dans ce cas, il est juste utilis√© pour faire savoir √† LoopBack qu‚Äôil s‚Äôagit d‚Äôun mod√®le et qu‚Äôil doit √™tre utilis√© pour rendre la documentation dans la sp√©cification OpenAPI. Le d√©corateur @property est utilis√© pour fournir des m√©tadonn√©es suppl√©mentaires aux propri√©t√©s individuelles de notre mod√®le. Ces m√©tadonn√©es permettent d‚Äôafficher les propri√©t√©s dans les fichiers de d√©finition de mod√®le LoopBack 3 et leur but principal est de permettre aux sp√©cifications OpenAPI de documenter facilement les propri√©t√©s ainsi que les propri√©t√©s de mapper aux noms de colonnes sp√©cifiques √† la base de donn√©es. Nous pouvons utiliser cette classe de mod√®le comme type de param√®tre dans la fonction PaymentController#pay : Avec une classe TypeScript sp√©cifique utilis√©e comme type de param√®tre, LoopBack peut maintenant fournir des d√©tails suppl√©mentaires √† la sp√©cification OpenAPI et notre navigateur rend maintenant ce qui suit (apr√®s avoir red√©marr√© le serveur et actualis√© la page): POST /payments Documentation Request Body Nos d√©veloppeurs frontaux peuvent maintenant facilement lire la documentation interactive et commencer √† int√©grer leurs applications avec un minimum d‚Äôeffort. L‚Äôex√©cution de cette op√©ration apr√®s avoir appuy√© sur le bouton ‚ÄúTry it out‚Äù et modifi√© certains des param√®tres permet d‚Äôobtenir un code de r√©ponse HTTP 200 avec le corps de r√©ponse JSON suivant: 200 Success Nous avons chang√© la propri√©t√© de statut √† ‚Äúsucc√®s‚Äù dans la fonction pay() plus t√¥t, ce qui est vu dans la sortie JSON ci-dessus. Conclusion Cet article a introduit LoopBack 4 en √©chafaudant une API de paiement simple par l‚Äôinterm√©diaire du CLI. Nous avons examin√© √† quel point il est facile de documenter et de tester les endpoints de l‚ÄôAPI √† l‚Äôaide des sp√©cifications OpenAPI int√©gr√©es en utilisant les contr√¥leurs LoopBack 4 et les fonctions TypeScript d√©cor√©es. Enfin, nous avons explor√© l‚Äô√©volution des fichiers de d√©finition de mod√®le LoopBack 2/3 en d√©tail. LoopBack 4 est toujours en cours de d√©veloppement, avec de nombreuses nouvelles fonctionnalit√©s construites par l‚Äôimpressionnante communaut√© open-source. Dans les articles suivants, nous les explorerons tous plus en d√©tail au fur et √† mesure que nous construirons notre API de paiement simple.","fields":{"layout":"post","slug":"/node-loopback/"}}},{"node":{"timeToRead":6,"frontmatter":{"title":"Vim est vuln√©rable - Mise √† jour de Vim sur macOS","subtitle":"Mettez √† jour Vim avec la derni√®re version en quelques minutes.","date":"2019-06-23T19:00:00.000Z","tags":["Vim","Mac"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABnPJRfYRJ3eAH/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEEBMh/9oACAEBAAEFAr+d1Wj3LA4kTSYuqAIoUYcf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgEEAwAAAAAAAAAAAAAAAAEhAhEigRASUf/aAAgBAQAGPwLGndUCqv2a0jKC7Zio9JZdrn//xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhMXEQQWGRof/aAAgBAQABPyHF3pxvUElc2AUQ1SO9Eu7XLPvxqV1b8TNfXZ1Koo6f/9oADAMBAAIAAwAAABCDLzz/xAAWEQEBAQAAAAAAAAAAAAAAAAABESD/2gAIAQMBAT8QVSLj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAREgIf/aAAgBAgEBPxANmn//xAAfEAEBAAIBBAMAAAAAAAAAAAABEQAhMUFRcaEQ4fD/2gAIAQEAAT8QTY2F4eBtwaGwenXlylUwS6h95VQu9P3rN0jXLMAV+uQPeSBaA2V3nVwAAAcAQPj/2Q==","aspectRatio":1,"src":"/static/368261693a41f4548bf3cc82019ebe1a/fb184/vim.jpg","srcSet":"/static/368261693a41f4548bf3cc82019ebe1a/f8f18/vim.jpg 930w,\n/static/368261693a41f4548bf3cc82019ebe1a/fb184/vim.jpg 1800w","sizes":"(max-width: 1800px) 100vw, 1800px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Si vous travaillez dans le terminal, vous utilisez probablement Vim fr√©quemment. Beaucoup de gens ont une relation d‚Äôamour/haine avec Vim, mais personnellement c‚Äôest mon √©diteur de ligne de commande pr√©f√©r√©, surtout quand je suis sur une machine Linux, et je l‚Äôutilise aussi fr√©quemment sur mon Mac, aussi. R√©cemment, une vuln√©rabilit√© a √©t√© identifi√©e √† Vim. La vuln√©rabilit√© concerne l‚Äôutilisation malveillante de la fonction modelines de Vim. Cette vuln√©rabilit√© affecte toutes les versions de Vim ant√©rieures √† la version 8.1.1365, ce qui signifie qu‚Äôelle affecte aussi votre Mac, si vous utilisez la version fournie avec macOS 10.14.5, qui est 8.0.1283. Au moment d‚Äô√©crire ces lignes, la version que nous installons est la 8.1.1573, ce qui permettra de corriger la vuln√©rabilit√©. Nous allons discuter comment mettre √† jour Vim √† la derni√®re version pour √©viter ce probl√®me et aussi couvrir bri√®vement ce que signifie cette vuln√©rabilit√©. Parlons d‚Äôabord des mauvaises choses. Que sont les modelines et pourquoi devrais-je m‚Äôen soucier? Sans vous ennuyer avec les d√©tails pr√©cis, nous pouvons dire que les modelines sont un moyent de configurer les pr√©r√©glages dans Vim en ajoutant des commandes en haut des fichier qui d√©finissent ces pr√©r√©glages lors de l‚Äôex√©cution du fichier. Alors qu‚Äôest-ce que cela signifie? En termes de vuln√©rabilit√©, cela signifie que bien que les modelines aient des cas d‚Äôutilisation l√©gitimes, si vous avez une version vuln√©rable de Vim, il est possible d‚Äôabuser de cette fonctionnalit√© et d‚Äô√©chapper √† la sandbox d‚Äôex√©cution de Vim, ce qui permet d‚Äôex√©cuter du code arbitraire de mani√®re non s√©curis√©e. Comment fonctionne cette vuln√©rabilit√©? Imaginez un sc√©nario dans lequel un acteur malveillant a charg√© un script contenant des modelines dans GitHub et a r√©ussi √† valider le fichier dans un r√©f√©rentiel que vous utilisez. L‚Äôattaquant a ajout√© quelques lignes de commandes modeline en haut d‚Äôun script cens√© √™tre un script Bash standard. Vous d√©cidez d‚Äôouvrir le fichier dans Vim pour lire le code avant de l‚Äôex√©cuter (toujours une bonne id√©e‚Ä¶ en g√©n√©ral). C‚Äôest tout ce dont nous avons besoin; le code malveillant s‚Äôex√©cute car tout ce que Vim doit faire est de lire le fichier et les modelines sont ex√©cut√©es, c‚Äôest ainsi que les modelines sont suppos√©es fonctionner. Malheureusement pour vous, votre version de Vim est obsol√®te et vous avez √©t√© infect√© car ce code malveillant peut maintenant √™tre ex√©cut√© en dehors de Vim. Ou peut-√™tre pas, parce que vous avez lu cet article en premier, puis vous avez mis √† jour Vim. Liste de pr√©-installation Il convient de discuter de certaines mises en garde avant de poursuivre. Chaque fois que vous apportez des modifications √† macOS en utilisant un terminal, et en particulier en ex√©cutant des commandes utilisant sudo, vous devez faire attention car il est facile de casser des choses. Premi√®rement, nous ne pouvons pas supprimer la version de Vim install√©e avec macOS. Au lieu de cela, nous allons installer la derni√®re version et nous assurer que c‚Äôest celle utilis√©e lorsque vous acc√©dez au terminal. La raison pour laquelle nous ne pouvons pas supprimer la version de Vim fournie avec macOS est due √† la configuration des autorisations dans macOS. Apple a configur√© en toute s√©curit√© les autorisations de sorte que l‚Äôutilisateur ne puisse plus modifier (ni m√™me casser les composants) du syst√®me principal, y compris Vim. De plus, nous ne souhaitons pas vraiment supprimer les logiciels de base afin de ne pas causer de conflits. Nous apportons un changement qui peut facilement √™tre annul√© si quelque chose se passait mal ou devait √™tre chang√© √† l‚Äôavenir. Deuxi√®mement, nous allons ex√©cuter quelques commandes en utilisant sudo. Cela signifie que vous allez ex√©cuter ces commandes comme si vous √©tiez l‚Äôutilisateur root. Cela pourrait poser probl√®me si vous ne lisez pas et ne suivez pas les instructions √† la lettre. Cela signifie √©galement que vous devez avoir un acc√®s administrateur dans macOS et que vous devrez fournir votre mot de passe lors de l‚Äôex√©cution de la commande. Tu as √©t√© pr√©venu. Mais ne vous inqui√©tez pas, ce que nous faisons est assez simple, et utiliser sudo n‚Äôest pas mauvais, c‚Äôest juste que vous voulez vous rappeler qu‚Äôun grand pouvoir implique de grandes responsabilit√©s, et que sudo a d√©finitivement un grand pouvoir. Un grand pouvoir implique de grandes responsabilit√©s. Oncle Ben Cela dit, passons √† autre chose et commen√ßons √† mettre √† jour Vim. Compiler Vim sur macOS Pour commencer, ouvrons l‚Äôapplication Terminal. Vous pouvez rechercher cela en utilisant Spotlight (Cmd + Space) ou ouvrir votre dossier Applications, cliquez sur Utilitaires, puis sur Terminal. Tout d‚Äôabord, nous devons r√©cup√©rer la derni√®re version de Vim dans le d√©p√¥t officiel GitHub, puis nous allons changer de r√©pertoire dans le r√©pertoire vim qui vient d‚Äô√™tre cr√©√©. Nous venons de t√©l√©charger le code source de Vim, ce qui signifie que nous devrons le compiler avant de pouvoir l‚Äôinstaller. Pour ce faire, tapez simplement make dans le m√™me r√©pertoire. Vous allez voir un mur de texte en cours de cr√©ation lors de la compilation de l‚Äôapplication. Cela prendra probablement quelques minutes, en fonction de la vitesse de votre Mac. Une fois termin√©, vous serez renvoy√© √† l‚Äôinvite de commande. Installer le dernier Vim sur macOS Maintenant que nous avons compil√© Vim, il est temps de terminer l‚Äôinstallation. Pour ex√©cuter la commande d‚Äôinstallation, vous devrez utiliser sudo. C‚Äôest une consid√©ration importante car cela signifie que nous installons dans un r√©pertoire syst√®me et, comme je l‚Äôai mentionn√© ci-dessus, nous souhaitons faire attention, veillez √† ex√©cuter correctement la commande suivante. Ex√©cutez ce qui suit dans le m√™me dossier vim que nous utilisions. Votre mot de passe vous sera demand√©, indiquez-le et la commande sera ex√©cut√©e. Encore une fois, vous verrez un mur de texte semblable √† celui que vous avez vu lors de la compilation de Vim. Une fois ce processus termin√©, Vim sera install√© et vous reviendrez √† l‚Äôinvite de commande, mais nous ne l‚Äôavons pas encore termin√©e. Comme je l‚Äôai mentionn√© plus t√¥t, nous installons une installation suppl√©mentaire de Vim. Nous voulons √™tre certains que lorsque nous ex√©cutons vim √† partir du terminal, nous obtenons vraiment la bonne version. Lisez la suite pour voir comment configurer ceci correctement. Configurer le bon Vim Lorsque nous avons install√© Vim, l‚Äôapplication binaire ex√©cutable a √©t√© plac√©e dans /usr/local/bin/vim. Toutefois, l‚Äôinstallation initiale de MacOS se trouve toujours dans /usr/bin/vim. Cela ne posera aucun probl√®me lorsque nous utiliserons vim depuis le terminal, mais cela posera des probl√®mes si nous ex√©cutons vi, ce qui est tr√®s courant pour les utilisateurs de longue date de Vim, car Vi est l‚Äôapplication sur laquelle Vim est bas√©. Sur macOS, la commande vi est un lien symbolique vers /usr/bin/vim et cela n‚Äôa pas chang√© apr√®s notre installation. Vous remarquerez que la version affich√©e sur l‚Äô√©cran d‚Äôaccueil de Vim est diff√©rente si vous ex√©cutez vim vs. vi. Cela pourrait causer des probl√®mes plus tard. Voyons ce qui se passe. Que se passe t-il ici? Le probl√®me est notre PATH - il sait toujours que le lien symbolique vi existe et lit le r√©pertoire /usr/bin lorsque notre profil est charg√©. Cependant, par d√©faut, /usr/local/bin est lu en premier, puis /usr/bin, ce qui signifie que nous devons simplement fournir un lien symbolique vers le chemin de l‚Äôapplication que nous voulons ex√©cuter lorsque nous ex√©cutons vi. Faisons-le maintenant. Cr√©ez un lien symbolique √† l‚Äôaide de la commande suivante, puis red√©marrez votre terminal. C‚Äôest tout! Une fois que vous aurez red√©marr√© votre terminal, que vous utilisiez Vi ou Vim, vous obtiendrez la m√™me installation mise √† jour de Vim. Conclusion J‚Äôesp√®re que cela a √©t√© une exp√©rience √©ducative, mais simple, mettant √† jour l‚Äô√©diteur de texte en ligne de commande pr√©f√©r√© de tout le monde. Merci d‚Äôavoir lu!","fields":{"layout":"post","slug":"/vim-modelines-vulnerable/"}}},{"node":{"timeToRead":8,"frontmatter":{"title":"Strat√©gie de d√©ploiement de Kubernetes","subtitle":"Dans Kubernetes, il y a plusieurs fa√ßons de publier une application, il est n√©cessaire de choisir la bonne strat√©gie pour rendre votre infrastructure fiable pendant la mise √† jour d'une application.","date":"2019-05-25T08:00:00.000Z","tags":["Kubernetes","DevOps"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABzC2jBYj/xAAaEAACAgMAAAAAAAAAAAAAAAABAgARITFC/9oACAEBAAEFAu8hQtzZANss/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABkQAAMAAwAAAAAAAAAAAAAAAAABERAxQf/aAAgBAQAGPwJXREcEs//EABgQAQEBAQEAAAAAAAAAAAAAAAERADFh/9oACAEBAAE/IRsrGWEVe4jVD66plnHI7Z2ZqM6Xf//aAAwDAQACAAMAAAAQwP8A/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERMf/aAAgBAwEBPxDZU//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QxIg//8QAHhABAAICAgMBAAAAAAAAAAAAAQAhEUExYXGBkaH/2gAIAQEAAT8QZGFr56O45sQgzWiXtrCEP6wYQCWcsZ1Hgda+xT8AxY17n//Z","aspectRatio":1.33422281521014,"src":"/static/cc32bd959fba19866af4a1302ca23593/883ab/interchange.jpg","srcSet":"/static/cc32bd959fba19866af4a1302ca23593/f8f18/interchange.jpg 930w,\n/static/cc32bd959fba19866af4a1302ca23593/0e6ff/interchange.jpg 1860w,\n/static/cc32bd959fba19866af4a1302ca23593/883ab/interchange.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Dans Kubernetes, il existe plusieurs fa√ßons de publier une application. Il est donc n√©cessaire de choisir la bonne strat√©gie pour rendre votre infrastructure fiable lors de la mise √† jour d‚Äôune application. Le choix de la proc√©dure de d√©ploiement appropri√©e d√©pend des besoins. Nous avons √©num√©r√© ci-dessous certaines des strat√©gies possibles √† adopter: Recreate RollingUpdate Blue/Green Canary A/B testing Vous pouvez exp√©rimenter chacune de ces strat√©gies avec Minikube, les manifestes et les √©tapes √† suivre sont expliqu√©s dans ce github Examinons chaque strat√©gie et voyons quel type d‚Äôapplication vous conviendrez le mieux.  Recreate - id√©al pour l‚Äôenvironnement de d√©veloppement Un d√©ploiement d√©fini avec une strat√©gie de type recreate mettra fin √† toutes les instances en cours d‚Äôex√©cution, puis les recr√©era avec la version la plus r√©cente.  Vous trouverez un exemple complet et les √©tapes de d√©ploiement √† l‚Äôadresse https://github.com/ludovicwyffels/k8s-deployment-demo/tree/master/recreate Avantage √âtat d‚Äôapplication enti√®rement renouvel√© Inconv√©nients Temps d‚Äôarr√™t qui d√©pend √† la fois de la dur√©e d‚Äôarr√™t et du d√©marrage de l‚Äôapplication  RollingUpdate - d√©ploiement lent Ce d√©ploiement met √† jour les pods de fa√ßon progressive. Un ReplicaSet secondaire est cr√©√© avec la nouvelle version de l‚Äôapplication, puis le nombre de r√©pliques de l‚Äôancienne version est r√©duit et la nouvelle version est augment√©e jusqu‚Äô√† ce que le nombre correct de r√©pliques soit atteint.  Vous trouverez un exemple complet et les √©tapes de d√©ploiement √† l‚Äôadresse https://github.com/ludovicwyffels/k8s-deployment-demo/tree/master/ramped Lors de la configuration avec la mise √† l‚Äô √©chelle automatique du pod horizontal, il peut √™tre pratique d‚Äôutiliser une valeur en pourcentage au lieu d‚Äôun nombre pour maxSurge et maxUnavailable . maxSurge permet d‚Äôindiquez combien de Pod il peut cr√©er en plus du nombre de r√©pliqua actuellement configurer maxUnavailable permet d‚Äôindiquer combien de Pod peuvent √™tre ‚Äúnon disponible‚Äù pendant la mise √† jour, toujours en fonction du nombre de r√©pliqua configur√© Si vous d√©clenchez un d√©ploiement alors qu‚Äôun d√©ploiement existant est en cours, le d√©ploiement mettra le d√©ploiement en pause et passera √† une nouvelle version en rempla√ßant le d√©ploiement. Avantages la version est lentement publi√©e sur toutes les instances pratique pour les applications avec √©tat pouvant g√©rer le r√©√©quilibrage des donn√©es Inconv√©nients le d√©ploiement/la restauration peut prendre du temps la prise en charge de plusieurs API est difficile aucun contr√¥le sur le trafic  Blue/Green - mieux √©viter les probl√®mes de versioning de l‚ÄôAPI Un d√©ploiement blue/green diff√®re d‚Äôun d√©ploiement parce que la version ‚Äúgreen‚Äù de l‚Äôapplication est d√©ploy√©e en parall√®le de la version ‚Äúblue‚Äù. Apr√®s avoir v√©rifi√© que la nouvelle version r√©ponde aux exigences, nous mettons √† jour l‚Äôobjet Kubernetes Service qui joue le r√¥le d‚Äô√©quilibreur de charge pour envoyer du trafic vers la nouvelle version en rempla√ßant l‚Äô√©tiquette de version dans le champ selector  Vous trouverez un exemple complet et les √©tapes de d√©ploiement √† l‚Äôadresse https://github.com/ludovicwyffels/k8s-deployment-demo/tree/master/blue-green Avantages d√©ploiement instantan√© √©viter le probl√®me de versioning, changer l‚Äô√©tat du cluster en une fois Inconv√©nients n√©cessite le double des ressources le bon test de toute la plate-forme doit √™tre effectu√© avant la mise en production la gestion des applications avec √©tat peut √™tre difficile  Canary - laissez le consommateur faire le test Le d√©ploiement Canary consiste √† router un sous-ensemble d‚Äôutilisateurs vers une nouvelle fonctionnalit√©. Dans Kubernetes, un d√©ploiement canary peut √™tre effectu√© en utilisant deux d√©ploiements avec des √©tiquettes de pods communes. Une r√©plique de la nouvelle version est publi√©e √† c√¥t√© de l‚Äôancienne version. Ensuite, apr√®s un certain temps et si aucune erreur n‚Äôest d√©tect√©e, augmentez le nombre de r√©pliques de la nouvelle version et supprimez l‚Äôancien d√©ploiement. L‚Äôutilisation de cette technique ReplicaSet n√©cessite de faire tourner autant de pod que n√©cessaire pour obtenir le bon pourcentage de trafic. Cela dit, si vous voulez envoyer 1% du trafic vers la version B, vous devez avoir un pod fonctionnant avec la version B et 99 pods fonctionnant avec la version A. Cela peut √™tre assez peu pratique √† g√©rer donc si vous recherchez une meilleure r√©partition du trafic, regarder les √©quilibreurs de charge tels que HAProxy ou les mailles de service comme Linkerd, qui offrent un meilleur contr√¥le du trafic.  Dans l‚Äôexemple suivant, nous utilisons deux ReplicaSets c√¥te √† c√¥te, la version A avec trois r√©pliques (75% du trafic), la version B avec un r√©pliqua (25% du trafic). Manifeste de d√©ploiement tronqu√© version A: Manifeste de d√©ploiement tronqu√© version B, notez que ous ne d√©marrons qu‚Äôun seul r√©pliqua de l‚Äôapplication: Vous trouverez un exemple complet et les √©tapes de d√©ploiement √† l‚Äôadresse https://github.com/ludovicwyffels/k8s-deployment-demo/tree/master/canary Avantages version publi√©e pour un sous-ensemble d‚Äôutilisateurs pratique pour la surveillance du taux d‚Äôerreur et des performances rollback rapide Inconv√©nients d√©ploiement lent la r√©partition du trafic ajust√©e peut √™tre co√ªteuse (99% A / 1% B = 99 pod A, 1 pod B) La proc√©dure utilis√©e ci-dessus est native de Kubernetes, nous ajustons le nombre de r√©pliques g√©r√©es par un ReplicaSet pour distribuer le trafic entre les versions. Si vous n‚Äô√™tes pas s√ªr de l‚Äôimpact que la sortie d‚Äôune nouvelle fonctionnalit√© pourrait avoir sur la stabilit√© de la plate-forme, une strat√©gie de sortie canari est sugg√©r√©e.  A/B testing - id√©al pour testes les fonctionnalit√©s sur un sous-ensemble d‚Äôutilisateurs Le test A/B est en fait une technique permettant de prendre des d√©cisions d‚Äôaffaires bas√©es sur des statistiques, plut√¥t qu‚Äôune strat√©gie de d√©ploiement. Cependant, il est apparent√© et peut √™tre mis en oeuvre √† l‚Äôaide d‚Äôun d√©ploiement canari, c‚Äôest pourquoi nous en parlerons bri√®vement ici. En plus de r√©partir le trafic entre les versions en fonction du poids, vous pouvez cibler pr√©cis√©ment un groupe donn√© d‚Äôutilisateurs en fonction de quelques param√®tres (cookie, user agent, etc.). Cette technique est largement utilis√©e pour tester la conversion d‚Äôune fonctionnalit√© donn√©e et ne d√©ployer que la version qui convient le plus. Istio, comme les autres maillages de service, fournis un moyen plus fin de subdiviser les instances de service avec un routage dynamique des requ√™tes bas√© sur des poids et/ou des en-t√™tes HTTP.  Vous trouverez ci-dessous un exemple d‚Äôinstallation de r√®gles √† l‚Äôaide d‚ÄôIstio. Vous trouverez un exemple complet et les √©tapes de d√©ploiement √† l‚Äôadresse https://github.com/ludovicwyffels/k8s-deployment-demo/tree/master/ab-testing D‚Äôautres outils comme Linkerd, Traefik, NGINX, HAProxy, vous permettent √©galement de le faire. Avantages n√©cessite un √©quilibreur de charge intelligent plusieurs versions en parall√®le un contr√¥le total sur la r√©partition du trafic Inconv√©nients les erreurs difficiles √† d√©panner pour une session donn√©e, le tra√ßage distribu√© deviennent obligatoires pas simple, vous devez configurer des outils suppl√©mentaires  En r√©sum√© Il y a diff√©rentes fa√ßons de d√©ployer une application, lors de la mise en production dans un environnement de d√©veloppement/staging, un d√©ploiement big bang ou progressif est g√©n√©ralement un bon choix. Lorsqu‚Äôil s‚Äôagit de production, un d√©ploiement progressif ou en blue/green est g√©n√©ralement un bon choix, mais un test appropri√© de la nouvelle plate-forme est n√©cessaire. Si vous n‚Äô√™tes pas s√ªr de la stabilit√© de la plate-forme et de l‚Äôimpact que pourrait avoir la sortie d‚Äôune nouvelle version de logiciel, alors une version canari devrait √™tre la bonne solution. Ce faisant, vous laissez le consommateur tester l‚Äôapplication et son int√©gration √† la plate-forme. Enfin, si votre entreprise a besoin de tester une nouvelle fonctionnalit√© parmi un groupe sp√©cifique d‚Äôutilisateurs, par exemple, tous les utilisateurs acc√©dant √† l‚Äôapplication √† l‚Äôaide d‚Äôun t√©l√©phone mobile sont envoy√©s √† la version A, tous les utilisateurs acc√©dant via un ordinateur passent √† la version B. Vous pouvez alors utiliser la technique de test A/B qui en utilisant un r√©seau de services Kubernetes ou une configuration serveur personnalis√©e vous permet de d√©terminer o√π un utilisateur doit √™tre dirig√© en fonction de certains param√®tres.","fields":{"layout":"post","slug":"/k8s-deployement-strategies/"}}},{"node":{"timeToRead":4,"frontmatter":{"title":"Configuration locale de Kubernetes avec minikube sur MacOS X","subtitle":"","date":"2019-05-23T08:00:00.000Z","tags":["Kubernetes","DevOps"],"draft":false,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFA//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHN5DxbJYf/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIDEBET/9oACAEBAAEFAlaRsOmEbZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAMgEgMf/aAAgBAQAGPwJhpNp//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITFhgf/aAAgBAQABPyHSUvSOU7FgtjtClyf/2gAMAwEAAgADAAAAEGQv/8QAFhEBAQEAAAAAAAAAAAAAAAAAABFB/9oACAEDAQE/EMV//8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Qp//EABoQAQEAAwEBAAAAAAAAAAAAAAEAESExUZH/2gAIAQEAAT8QTFAXqtS5LFXZken2T1hAFInS/9k=","aspectRatio":1.7809439002671417,"src":"/static/aac12d8124ce6730c0247f5495bff894/883ab/ship.jpg","srcSet":"/static/aac12d8124ce6730c0247f5495bff894/f8f18/ship.jpg 930w,\n/static/aac12d8124ce6730c0247f5495bff894/0e6ff/ship.jpg 1860w,\n/static/aac12d8124ce6730c0247f5495bff894/883ab/ship.jpg 2000w","sizes":"(max-width: 2000px) 100vw, 2000px"}}},"author":{"id":"ludo","bio":"D√©veloppeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"excerpt":"Minikube est un outil id√©al pour configuer localement Kubernetes afin de tester et d‚Äôexp√©rimenter vos d√©ploiements. Dans ce guide, je vais essayer de vous aider √† le mettre en marche sur votre machine locale, √† donner quelques conseils sur o√π et comment effectuer certaines t√¢ches et √† le rendre aussi capable (je suppose quand vous utilisez k8s que vous veulent apprendre et utiliser Helm, etcd, istio, etc.). Installation de minikube Minikube fonctionne avec une machine virtuelle. Pour cela, on peut utiliser diverses options en fonction de vos pr√©f√©rences et de votre syst√®me d‚Äôexploitation. Ma pr√©f√©rence dans ce cas est Orable VirtualBox. Vous pouvez utiliser brew pour tout installer: Dans ce cas, vous pourriez obtenir une erreur d‚Äôinstallation peu concluante li√©e √† l‚Äôinstallation de virtualbox, en particulier sur Mojave et problablement par la suite. Quoi qu‚Äôil en soit, il s‚Äôagit problablement d‚Äôune nouvelle fonctionnalit√© de s√©curit√© dans MacOs X qui vous g√™ne. Allez dans Pr√©f√©rences Syst√®me> S√©curit√© et confidentialit√© et sur l‚Äô√©cran G√©n√©ral, vous verrez un (ou quelques) messages concernant certains logiciels n√©cessitant une approbation pour √™tre install√©s. Vous devez examiner attentivement la liste s‚Äôil en existe plusieurs et autoriser l‚Äôinstallation du logiciel dont vous avez besoin - dans ce cas, le logiciel Oracle. Cela fait, vous pourrez relancer la commande ci-dessus et vous devrez alors √™tre pr√™t pour les √©tapes suivantes. Ex√©cuter et acc√©der au cluster Afin d‚Äôutiliser de mani√®re optimale les ressources de votre ordinateur local, je sugg√©rerais de l‚Äôarr√™ter quand vous n‚Äôen avez plus besoin‚Ä¶ Avec VirtualBox au centre, il utilisera la batterie de votre ordinateur portable assez rapidement. Recommencer plus tard vous ram√®nera l√† o√π vous l‚Äôavez laiss√©: Le tableau de bord Kubernetes est √©galement disponible (lorsque minikube est en cours d‚Äôex√©cution): Je vais supposer que vous avez kubectl install√© localement et que vous l‚Äôutilisez d√©j√† pour certains clusters distants, vous disposez donc de plusieurs contextes. Dans ce cas, vous devez r√©pertorier les contextes et passer √† minikube. Vous vous trouvez maintenant dans le contexte de votre cluster k8 local qui s‚Äôex√©cute sur minikube et vous pouvez effectuer toutes les op√©rations k8 qu‚Äôil contient. Ingress Pour ex√©cuter vos d√©ploiements comportant un ingress, vous aurez besoin d‚Äôun add-on d‚Äôentr√©e: Assurez-vous que vous configurez l‚Äôingress en fonction de vos h√¥tes locaux. Cela signifie fondamentalement que tout ce que vous d√©finissez comme h√¥te dans vos r√®gles d‚Äôingress doit √™tre configur√© dans votre fichier /etc/hosts O√π [minikube ip] devrait √™tre remplac√© par l‚Äôip actuel de minikube. Il fonctionne √©galement avec plusieurs h√¥tes locaux s√©par√©s par des espaces apr√®s l‚Äôadresse ip de minikube. Voici un raccourci pour le faire en bash Docker registry La r√©alit√© de l‚Äôutilisation r√©elle du registre de conteneurs dans l‚Äôenvironnement local est rude. Je vais donc vous fournir une option simple, rapide et simpliste qui facilite le d√©ploiement de votre travail local sur vos k8s locaux, mais vous prive de l‚Äôexp√©rience tr√®s importante du registre de conteneurs. Registre de conteneurs local Obtenez le contexte de votre docker local pour pointer vers le context minikube:  Dans le contexte minikube, pour d√©marrer le registre docker local Donc, vous avez maintenant un registre local dans lequel pousser des choses (tant que votre docker est dans le contexte minikube) Vous pouvez maintenant faire: A ce stade, vous pouvez utiliser localhost:5000/<your_tag>: comme image dans votre d√©ploiement et c‚Äôest tout. Utilisation du r√©f√©rentiel de conteneur distant Pour utiliser localement le r√©f√©rentiel de conteneur distant, vous devez fournir un moyen d‚Äôauthentification, qui se base sur les secrets de Kubernetes. Pour la gestion des secrets locaux pour ECR, GCR and Docker registry, je recommande d‚Äôutiliser l‚Äôaddon minikube appel√© registry-creds. Je ne le consid√®re pas suffisamment s√ªr pour √™tre utilis√© ailleurs que dans l‚Äôenvironnement local. Helm Helm est un gestionnaire de paquets pour k8s et est souvent utilis√© pour la gestion de la configuration d‚Äôun d√©ploiement √† l‚Äôautre. Compte tenu de la grande popularit√© de l‚Äôoutil et de son adoption croissante, je voudrais terminer ce guide par une note sur l‚Äôajout de helm √† votre environnement Kubernetes local. C‚Äôest assez facile √† ce stade, il suffit de mettre en place minikube et: Helm utilise un backend appel√© Tiller. C‚Äôest ce qui est install√©/d√©ploy√© lors de l‚Äôex√©cution de helm init. Une lecture pr√©cieuse: https://helm.sh/docs/using_helm/ Maintenant, vous disposez d‚Äôun environnement Kubernetes local complet capable d‚Äôaccepter tous vos d√©ploiements de test avant de d√©cider de les placer dans le cloud.","fields":{"layout":"post","slug":"/k8s-minikube/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"limit":9,"skip":0,"numPages":5,"currentPage":1}}}