{"componentChunkName":"component---src-templates-post-tsx","path":"/openvpn-google/","webpackCompilationHash":"ba1a271305926245155b","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY023PvUrDUBTA8ZuCtoMoOLQ4dWhN14x2kEKXFkGoohQ/QBexOHRycAidKkgHHRq69APRoTjFJYODIA6+gSBYfYMmfYLE/5VT6NALP845NyeHc9UoCHZRQvonCLKKE4ZhAXYURTsYoE9dIy5iCzfUJnEdV+RF4iu6ikFH2EPxazzOcJmg4Rnn5C8ysIEOHqTe5/sT3qXOwYOtRr5/wLAqzpCTDXu4p2ETtyjgGJ/cX+se8jeU9fa4RBt5vWENpjzdkoGPcGg4RQsbOMEFmnBRRwVDHEK/yFXfvr/CoPjvZLKcdByDyzWGeajigzorGy0oOeRJiUtITe/pX1XzDk3buIMltSFR/zTtic3060X+8z8PsEUt8G3LVQAAAABJRU5ErkJggg==","width":400,"height":128,"src":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png","srcSet":"/static/2b5eaa0de166a8b5faebad4955c2200c/647de/ghost-logo.png 1x"}}},"markdownRemark":{"html":"<p>J’ai récemment commencé à utiliser OpenVPN et à profiter des différentes options qu’il propose, notamment le masquage du trafic VPN sous TCP:443 (autrement appelé HTTPS). Personnellement, j’aime utiliser GCE pour héberger mes VPN, car je profite de la puissance et de la personnalisation que cela procure.</p>\n<p>Cependant, il n’y avait absolument aucun tutoriel sur la configuration d’OpenVPN sur GCE. Il existe 10 étapes dans ce didacticiel, mais chaque étape peut exécuter plusieurs lignes de code.</p>\n<p>Si vous essayez simplement d’ajouter plus de clients, passer aux étapes 4, 9 et 10.</p>\n<h2>Table des matières</h2>\n<p>[[toc]]</p>\n<h2>1. Création de l’instance</h2>\n<p>Nous voulons utiliser une instance <code>n1-standard-1</code> pour sa durabilité et son coût. Dirigez-vous vers le moteur de calcul et cliquez sur “CREATE INSTANCE”.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 450px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 139.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsSAAALEgHS3X78AAACjUlEQVQ4y41Uh3KjMBDV///cZeZcEhfsuFJtBAihyj1JPkJsp7zBO2vBtrfaJZvNZrVaLZdLSqkxRkqplJIeXdfhxHr0Iwx/SFmWRVFcPWBfegS9rms4cl+P4G3dA7/EWkPpNUliKDhCVK01DCDhIs/z8/kMdyGU0jajMr7IhruPiZDqQtvi2jStbLmsG8F5JzoHRG6apvYQwp25orQVyoZqiBA6p/pS60ulKXOSMY7EK49gDwUShTDGhspD2vbGgjXWaGu1J+k/N4CP4iP1/t8NqIugqsPhAK+h1A9KRyQPPN3RTtq2RZ92u12SJO/v76Bnv9+fPKDjHLKoVFYqyP4zCOfcFcaYUhqNQfwgAeQWdCSu/XNvjIAIQssCBfdfY9zqoWwCr43s16mlTB2Pe/gCBTsPKHuPNE0f3TljpJVVZpPqkpkiz1DBECdkHm7oc2N8AOOisZ00uOJRtAmRERCvH23AAnjdbre4M8QNg3KWSn80cCDsETgPMwMvBJ1AaSgVShzHaDv4v2PoKxBcD6QBs+PxCBdo+zCGd9w+AndbRFG0WCxms9l6vQ71oGz4ClclZHgHZAdDIoWoKoyum54QNtwTQHh8F7lu+GQevb29TqdTbJUsyzBAoRNPO3TXZ3M4pS8vf2bz+WQy+euBzNEqEPGDMX5tyy4e2BiQ2EoD4T8Yj+fulyR/zDPiIL1xh4Zqx46e9xmrb7t1PGHdIe2wfahHUCDxCr0IuzXQeRtJ1naRW91rbO/X+WsgKWzvW88g9SeMjLnK0iTPEriO4xMGq/810Cpb1Lao7LU2VdtD5tRtnItbPRLbp2w0ZF6pJ5sER22nWae5MJ0wvDNOkXgsF3hlhDTcP+ahc/8AbrFWxxhIqn8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/bc1d8c0fe43fbdbd290421761c57cb77/8ffb1/1.webp 293w,\n/static/bc1d8c0fe43fbdbd290421761c57cb77/2809e/1.webp 450w\"\n          sizes=\"(max-width: 450px) 100vw, 450px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/bc1d8c0fe43fbdbd290421761c57cb77/f93ee/1.png 293w,\n/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png 450w\"\n          sizes=\"(max-width: 450px) 100vw, 450px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png\"\n          alt=\"1\"\n          title=\"1\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Configurez-le avec les options affichées, mais n’appuyez pas encore sur “Créer”</p>\n<p>Si vous ne voyez pas l’image, nous utilisons une instance <code>n1-standard-1</code> (1 vCPU, 3,75 Go de mémoire) avec Ubuntu 16.04 LTS installé (vous pouvez choisir un espace de stockage, mais 10 Go suffisent). Puisque notre VPN utilisera TCP: 443, nous devons autoriser le trafic HTTPS maintenant ou plus tard. Vous pouvez donc également le faire immédiatement.</p>\n<p>Appuyez sur le bouton “Gestion, sécurité, disques, réseau, …” pour ouvrir les options avancées. Cliquez sur l’onglet Réseau et cliquez sur le bouton d’édition en regard de l’interface réseau sélectionnée.</p>\n<p>Cliquez sur le menu déroulant “Adresse IP externe” et sélectionnez “Créer une adresse IP”. Entrez un nom, puis appuyez sur “Réserver”. Cette opération associera une adresse IP statique à votre instance, ce qui est probablement ce que vous voulez, sauf si vous souhaitez régénérer les fichiers de configuration de quelque temps. En ce qui concerne les frais, Google ne facture pas les adresses IP statiques pendant leur utilisation. La machine <code>n1-standard-1</code> ne devrait pas vous coûter plus de 30 $ par mois. Certes, cela coûte un peu plus cher que la plupart des services VPN, mais la plupart des services VPN ne vous donnent pas un contrôle total :)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 467px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 121.84154175588866%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1UlEQVQ4y5VUy47TMBT1zwE7FgiEWIOQALFkPWyQGDTLEa8VX8DHdAWVyqR5x06TJnEcv+JyOq7YMXGPnKsq9fU9957jkMufzYvr6vXX6s03+uoLfX5dhayXn+nb74y8+8GefCqfXpXProrHl/mD9+n9i4V17yJ9+CF79DEnwziVrN3teT8qIa3Uc8iatBsnTeQ0rX//urn5o7U6uNmFLWu0NYZYa7uua9vWOWeM0SYI0zQppYiUklLKGNvv9zjoEAxsJlrrKIrW63VxizRNd7vdPM94v1wZm/q+B/NhGBA55+Bil+CPIOM4RtttFG03m00cx03TGmPdEkDtmIzKtCqLIisRijxLk7ZtjpO7E0KII21wEOowCDeIuR9txyGjCx0YivBRNp3ouJLKcTFrEzxtEIjjbZomjFEYRisJt4T2jIfVdVGUjNWwSl3XFaX/5vk/nHrGGRAtyzJYpaoqiAy1kHx35RNtJOMY+ASZkM3r7P9e7hlbkZYkSZ7n0OA8e4K6rwkgGUQWG8aGkz3x4EqgPpLhU0S8CbEnKnmp4tVqhVjeAvnnmIRzXCZEbz3PPKQ48T140UEYcQ7D6WJgYGgbCuMH3p73MUDbGBgGiG49ixAg8S/mDk08LO0x+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/73eb40d4f0bb7c23d2790b3c426d1575/8ffb1/2.webp 293w,\n/static/73eb40d4f0bb7c23d2790b3c426d1575/d57f5/2.webp 467w\"\n          sizes=\"(max-width: 467px) 100vw, 467px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/73eb40d4f0bb7c23d2790b3c426d1575/f93ee/2.png 293w,\n/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png 467w\"\n          sizes=\"(max-width: 467px) 100vw, 467px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png\"\n          alt=\"2\"\n          title=\"2\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Vos interfaces réseau doivent ressembler à l’image. <strong>Veillez à activer le transfert IP</strong>, car cela ne peut plus être modifié après la création de l’instance.</p>\n<p>En règle générale, vous souhaiterez probablement garder votre adresse IP externe secrète. Cela ne me dérange pas de rendre celui-ci public, car cette instance n’existera pas lorsque vous lirez ce tutoriel, et l’adresse IP appartiendra probablement à quelqu’un d’autre.</p>\n<p>Appuyez sur “Terminé” et “Créer”. Une fois l’instance prête (un bouton “SSH” noir apparaîtra), cliquez ou double-cliquez sur le bonton “SSH” pour ouvrir une fenêtre SSH. Le reste de la configuration se fera sur cette machine, que nous appellerons le “server”.</p>\n<h2>2. Installation OpenVPN et EasyRSA</h2>\n<p>OpenVPN est (évidemment) le serveur VPN que nous utilisons, et EasyRSA est un paquet qui nous permettra de configurer une autorité de certification interne à utiliser.</p>\n<p>Bien que ce ne soit généralement pas le cas, pour cette configuration, il est souvent nécessaire de lancer une mise à jour d’apt pour pouvoir installer un ou les deux packages. Les deux d’entre eux sont dans les dépôts par défaut d’Ubuntu.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> openvpn easy-rsa</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Temps de configurer.</p>\n<h2>3. Mise en place du CA</h2>\n<p>Comme OpenVPN utilise TLS/SSL, il a besoin de certificats pour chiffrer le trafic. Pour cela, nous devrons émettre nos propres certificats de confiance, ce que nous pouvons faire à l’aide de la CA que nous sommes sur le point de configurer.</p>\n<p>Commençons par copier le <code>easy-rsa</code> de modèles du paquet <code>easy-rsa</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">make-cadir ~/openvpn-ca\n<span class=\"token builtin class-name\">cd</span> ~/openvpn-ca</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Il y a des valeurs que nous pouvons vouloir éditer, alors allons-y et <code>nano vars</code>. Si vous voulez utiliser vim, continuez, mais puisque j’essaie de garder mes tutoriels aussi simples que possible, j’utilise nano.</p>\n<blockquote>\n<p>À partir de ce moment, s’il y a une partie d’une commande qui dépend d’une valeur que vous choisissez, elle sera en gras. Tout le code qui n’est pas généré par un utilisateur sera en italique.</p>\n</blockquote>\n<p>Faites défiler vers le bas du fichier (ce n’est pas trop long) et vous devriez trouver ce qui suit:</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\nexport KEY_COUNTRY=\"<b>US</b>\"\nexport KEY_PROVINCE=\"<b>CA</b>\"\nexport KEY_CITY=\"<b>SanFrancisco</b>\"\nexport KEY_ORG=\"<b>Fort-Funston</b>\"\nexport KEY_EMAIL=\"<b>me@myhost.mydomain</b>\"\nexport KEY_OU=\"<b>MyOrganizationalUnit</b>\"\n</pre>\n</div>\n<p>Éditez autant d’entre eux (ou aucun d’eux) que vous le souhaitez. Juste en dessous de ces valeurs devrait être <code>export KEY_NAME=\"EasyRSA\"</code>. Pour simplifier notre configuration, nous allons modifier cette ligne comme suit:</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\nexport KEY_NAME=\"<b>server</b>\"\n</pre>\n</div>\n<p>Enregistrez et fermez le fichier (ctrl + x, y, entrez). Les variables que nous venons de modifier seront utilisées pour le processus de signature de notre autorité de certification. Toujours dans le <code>openvpn-ca</code>, exécutez la commande suivante:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> vars</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Si vous avez bien fait, le re <code>NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/<b>username</b>/openvpn-ca/keys</code>. C’est ce que nous voulons. Pour assurer un environnement de travail propre, nous allons lancer <code>./clean-all</code>.</p>\n<p>Maintenant, construisons le CA</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">./build-ca</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Toutes les variables que nous avons déjà définies doivent se renseigner elles-mêmes. Il suffit donc d’y accéder en appuyant plusieurs fois sur Entrée. À la fin, vous aurez une autorité de certification prête à commencer à signer.</p>\n<p>Nous avons également besoin d’un certificat de serveur et d’une clé de cryptage pour garantir la sécurité de notre trafic.</p>\n<p>Créons notre certificat de serveur et notre clé.</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\n./build-key-server <b>server</b>\n</pre>\n</div>\n<p>Passer à nouveau les invites de commande. Nous n’entrerons pas un mot de passe, cette fois. Les deux dernières invites vous obligent à entrer <code>y</code> pour signer le certificat. Assurez-vous de ne pas les ignorer!</p>\n<p>Comme indiqué précédemment, nous avons également besoin d’une clé de chiffrement. Pour les besoins de ce didacticiel, nous allons générer une clé Diffie-Hellman, qui a tendance à être plutôt forte. Bien sûr, une grande [force] entraîne une grande [inefficacité]. Par conséquent, quelle que soit votre système, la commande suivante prendra probablement quelques minutes.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">./build-dh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Nous renforcerons cela avec une signature HMAC, afin de nous assurer que la vérification de l’intégrité TLS est plus sûre.</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\nopenvpn --genkey --secret keys/<b>tiv</b>.key\n</pre>\n</div>\n<h2>4. Générer un certificat client</h2>\n<p>Naturellement, si vous allez utiliser une autorité de certification, votre client doit également disposer d’un certificat. Bien que vous puissiez le faire sur votre ordinateur client et que le serveur le signe, nous essayons de garder les choses simples et hébergées sur un seul ordinateur.</p>\n<blockquote>\n<p>Si vous avez plusieurs clients, vous pouvez suivre cette étape plusieurs fois. Assurez-vous simplement de rendre vos noms de client uniques.</p>\n</blockquote>\n<p>Assurez-vous que vous êtes dans le <code>openvpn-ca</code> et que votre fichier vars est synchronisé.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> ~/openvpn-ca\n<span class=\"token builtin class-name\">source</span> vars</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Maintenant, nous allons construire une clé client en tant que telle:</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\n./build-key <b>client</b>\n</pre>\n</div>\n<p>Une fois de plus, tout doit être pré-rempli. Passez donc tous les éléments, sauf les deux dernières invites, qui vous demanderont de signer en entrant <code>y</code>.</p>\n<h2>5. Configurer le serveur OpenVPN</h2>\n<p>OpenVPN s’installe sous le répertoire <code>/etc/openvpn</code>. Pour que tout fonctionne, nous devons déplacer certains fichiers dans ce dossier.</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\ncd ~/openvpn-ca/keys\nsudo cp ca.crt server.crt server.key <b>tiv</b>.key dh2048.pem /etc/openvpn\n</pre>\n</div>\n<p>Par défaut, OpenVPN est fourni avec un exemple de configuration. Par souci de simplicité, nous simplifierons la décompression dans notre dossier de configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | sudo tee /etc/openvpn/server.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Ensuite, nous allons éditer le fichier de configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/openvpn/server.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>La première étape consiste à trouver la directive <code>tls-auth</code>. Il y aura un point-virgule (<code>;</code>) à côté de la directive, que nous supprimerons. En dessous, nous ajouterons une ligne.</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\ntls-auth <b>tiv</b>.key 0 # This file is secret\nkey-direction 0\n</pre>\n</div>\n<p>Nous devons également chiffrer notre serveur, éditons donc les directives de chiffrement juste en dessous de cette section. Plus précisément, nous décommentons la ligne AES-128-CBC et ajouterons une directive <code>auth</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">cipher AES-128-CBC\nauth SHA256</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Ensuite, les paramètres d’utilisateur et de groupe:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">user nobody\ngroup nogroup</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Facultativement, nous pourrions opter pour l’envoi de tout le trafic via le VPN. Pour cela, recherchez la directive <code>redirect-gateway</code> et décommentez-la.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">push &quot;redirect-gateway def1 bypass-dhcp&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Juste en dessous, il devrait y avoir quelques lignes d’<code>dhcp-option</code>. Décommentez ceux-là aussi.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">push &quot;dhcp-option DNS 208.67.222.222&quot;\npush &quot;dhcp-option DNS 208.67.220.220&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Optionnellement, nous pouvons vouloir changer le port et le protocole sur lesquels OpenVPN fonctionne. La valeur par défaut est UDP: 1194, mais si votre réseau bloque les connexions VPN, ce sera probablement l’une des victimes. Le déguisement serait d’utiliser TCP: 443, qui est le port HTTPS.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">port 443\n\nproto tcp\n;proto udp</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Si vous n’avez pas utilisé «serveur» comme nom de serveur, vos fichiers <code>crt</code> ont un nom différent. Mettez-les à jour en conséquence.</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\ncert <b>server</b>.crt\nkey <b>server</b>.key\n</pre>\n</div>\n<p>Enregistrez et fermez le fichier.</p>\n<h2>6. Préparer Ubuntu</h2>\n<p>Bien que nous ayons déjà configuré le transfert IP, etc., nous devons apporter quelques modifications pour activer ces options.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/sysctl.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Recherchez la ligne suivante et supprimez le # (caractère de commentaire).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">net.ipv4.ip_forward=1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Sauver et fermer. Pour mettre à jour les paramètres de session, exécutez:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> sysctl -p</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Ensuite, nous devons trouver et mettre à jour nos règles de pare-feu (UFW) pour masquer les clients. La première étape consiste à trouver l’interface sur laquelle nous fonctionnons:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">ip route | grep default</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>L’interface que nous voulons est celle qui contient le mot “dev”. Dans notre cas, cela ressemble à ceci:</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\ndefault via 10.138.0.1 dev <b>ens4</b>\n</pre>\n</div>\n<p>Donc, notre interface est <code>ens4</code>. Avec cela, nous mettrons à jour nos règles de pare-feu:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/ufw/before.rules</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Au-dessus, là où il est indiqué <code>Don't delete these required lines...</code> ajoutez le code suivant:</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\n# OPENVPN\n# NAT Table\n*nat\n:POSTROUTING ACCEPT [0:0] \n# OpenVPN client traffic\n-A POSTROUTING -s 10.8.0.0/8 -o <b>ens4</b> -j MASQUERADE\nCOMMIT\n# OPENVPN\n</pre>\n</div>\n<p>Sauver et fermer. Ensuite, nous devons transférer les paquets.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/default/ufw</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Recherchez la directive <code>DEFAULT_FORWARD_POLICY</code> et remplacez-la de <code>\"DROP\"</code> par <code>\"ACCEPT\"</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Sauver et fermer.</p>\n<h2>7. Lancer OpenVPN</h2>\n<p>Pour démarrer le serveur, exécutez ce qui suit:</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\nsudo systemctl start openvpn@<b>server</b>\n</pre>\n</div>\n<p>Pour vérifier qu’il a bien démarré, lancez:</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\nsudo systemctl status openvpn@<b>server</b>\n</pre>\n</div>\n<p>Si tout se passe bien, vous devriez voir une sortie incluant <code>Active: active (running)</code>. Vous devrez peut-être <code>q</code> sur <code>q</code> pour quitter le panneau d’informations. Si cela vous convient, liez le service à la séquence de démarrage.</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\nsudo systemctl enable openvpn@<b>server</b>\n</pre>\n</div>\n<h2>8. Configuration d’une structure de configuration client</h2>\n<p>Pour faciliter la configuration des configurations client, nous allons d’abord créer une structure. Pour commencer, créez un dossier de configuration pour stocker les fichiers de configuration du client.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p ~/clients/files</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Les clés du client seront dans ces configurations, alors verrouillons les permissions sur le répertoire <code>files</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> <span class=\"token number\">700</span> ~/clients/files</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Copiez l’exemple de configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/clients/base.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Éditons le fichier:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">nano</span> ~/clients/base.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Trouvez la directive <code>remote</code>. Remplacez <code>my-server-1</code> par l’adresse IP externe publique attribuée à votre instance GCE. Si vous avez choisi un port autre que 1194, mettez-le à jour en conséquence.</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\nremote <b>35.197.111.236 443</b>\n</pre>\n</div>\n<p>Mettez également à jour votre protocole.</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\nproto <b>tcp</b>\n</pre>\n</div>\n<p>Décommentez l’utilisateur et le groupe:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">user nobody\ngroup nogroup</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Trouvez les directives <code>ca</code>, <code>cert</code> et <code>key</code>, commentez-les, car nos configurations les incluront automatiquement.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># ca ca.crt\n# cert client.crt\n# key client.key</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Utilisez les mêmes paramètres de chiffrement et d’authentification que précédemment:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">cipher AES-128-CBC\nauth SHA256</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Quelque part, nous devrons ajouter la <code>key-direction</code>. Assurez-vous d’utiliser 1, comme c’est le cas pour le client. 0 était pour le serveur.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">key-direction 1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Si votre configuration client actuelle est (ou sera) utilisée sur un périphérique Linux, ajoutez les éléments suivants:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">script-security 2\nup /etc/openvpn/update-resolv-conf\ndown /etc/openvpn/update-resolv-conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Notez que si vous les incluez dans un environnement non-Linux (Android et macOS inclus dans un non-Linux), vos clients peuvent se comporter de manière étrange.</p>\n<p>Sauver et fermer. Ensuite, nous devons écrire un script pour générer nos configs client rapidement et facilement.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">nano</span> ~/clients/gen_config.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>A l’intérieur, collez ce code:</p>\n<pre class=\"language-text code\">\n#!/bin/bash\n\n# First argument: Client identifier\n\nKEY_DIR=~/openvpn-ca/keys\nOUTPUT_DIR=~/clients/files\nBASE_CONFIG=~/clients/base.conf\n\ncat ${BASE_CONFIG} \\\n    <(echo -e '&lt;ca&gt;') \\\n    ${KEY_DIR}/ca.crt \\\n    <(echo -e '&lt;/ca&gt;\\n&lt;cert&gt;') \\\n    ${KEY_DIR}/${1}.crt \\\n    <(echo -e '&lt;/cert&gt;\\n&lt;key&gt;') \\\n    ${KEY_DIR}/${1}.key \\\n    <(echo -e '&lt;/key&gt;\\n&lt;tls-auth&gt;') \\\n    ${KEY_DIR}/<b>tiv</b>.key \\\n    <(echo -e '&lt;/tls-auth&gt;') \\\n    > ${OUTPUT_DIR}/${1}.ovpn\n</pre>\n<p><a href=\"./02/gen_config.sh\" download>gen_config.sh</a></p>\n<p>Le <code>{1}</code> fait ici référence au premier argument, qui sera notre nom de client. Assurez-vous de mettre à jour <strong>tiv</strong>.key fonction du nom de votre clé HMAC.</p>\n<p>Autoriser l’exécution de ce script:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> <span class=\"token number\">700</span> ~/clients/gen_config.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>9. Générer des configurations client</h2>\n<p>Le pas que vous attendiez tous est enfin arrivé. Nous allons générer nos configurations client.</p>\n<div class=\"language-bash extra-class\">\n<pre class=\"language-bash code\">\ncd ~/clients\n./gen_config.sh <b>client</b>\n</pre>\n</div>\n<p>Vérifiez que cela a fonctionné en exécutant:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">ls</span> ~/clients/files</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Si tel est le cas, il devrait maintenant y avoir un fichier <code><b>client</b>.ovpn</code> dans ce répertoire. Nous devons télécharger ce fichier et le transférer sur nos appareils. Pour ce faire, cliquez sur l’icône représentant une roue en haut à droite de la session SSH, puis sélectionnez «Télécharger le fichier».</p>\n<p>Le chemin pleinement qualifié devrait ressembler à ceci:</p>\n<div class=\"language-text extra-class\">\n<pre class=\"language-text code\">\n/home/<b>username</b>/clients/files/<b>client</b>.ovpn\n</pre>\n</div>\n<h2>10. Installation sur les clients</h2>\n<p>Pour Windows, téléchargez l’application client <a href=\"https://openvpn.net/index.php/open-source/downloads.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">OpenVPN</a>. Une fois installé, déplacez votre fichier <code><b>client</b>.ovpn</code> vers <code>C:\\Program Files\\OpenVPN\\config</code>. Pour ouvrir OpenVPN, vous devez exécuter l’application en tant qu’administrateur. Une fois à l’intérieur, vous devriez voir et pouvoir vous connecter à votre VPN.</p>\n<p>Pour macOS, la plupart des gens suggèrent d’utiliser <a href=\"https://tunnelblick.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Tunnelblick</a> bien que tout autre client OpenVPN (même s’il soit sans danger) soit probablement bon aussi. Une fois installé, vous devriez pouvoir faire glisser n’importe .ovpn fichier <code>.ovpn</code> sur l’icône Tunnelblick de la barre de menus pour installer la configuration. Utilisez la barre de menus pour vous connecter ensuite au VPN. Si vous êtes interrogé sur le plugin <code>down-root.so</code>, prenez une décision! Je l’ai sauté parce que je suis capable de reconnecter ma connexion, mais c’est à vous de décider.</p>\n<p>Sous Linux, installez le paquet <code>openvpn</code> en utilisant votre gestionnaire de paquets. Les utilisateurs de CentOS devront d’abord installer <code>epel-release</code> utilisant <code>yum</code>. Une fois installé, lancez <code>ls /etc/openvpn</code>. Si la sortie <strong>ne</strong> présente <strong>pas</strong> de fichier <code>update-resolve-conf</code>, vous devez modifier votre fichier <code>.ovpn</code> et supprimer les lignes suivantes (si vous les avez ajoutées):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">script-security 2\nup /etc/openvpn/update-resolv-conf\ndown /etc/openvpn/update-resolv-conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Si vous n’avez jamais ajouté ces lignes mais trouvé un fichier <code>update-resolv-conf</code>, ajoutez-les! Les utilisateurs de CentOS devront modifier le <code>group</code> dans le fichier <code>.ovpn</code> de <code>nogroup</code> à <code>nobody</code> pour se conformer aux normes du système d’exploitation.</p>\n<p>Pour vous connecter, lancez <code>sudo openvpn — config client .ovpn</code>.</p>\n<p>Pour iOS, installez l’application <a href=\"https://itunes.apple.com/us/app/id590379981\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">OpenVPN Connect</a>. Ensuite, ouvrez iTunes sur votre ordinateur et accédez à iPhone> Applications. Faites défiler jusqu’à la section «Partage de fichiers» et sélectionnez “OpenVPN”. Faites glisser votre fichier <code>.ovpn</code> dans le panneau “OpenVPN Documents”. Ouvrir l’application sur votre téléphone devrait maintenant afficher un message indiquant qu’un nouveau profil est prêt à être importé. Une fois importé, vous devriez pouvoir vous connecter au VPN.</p>\n<p>Pour Android, installez l’application <a href=\"https://play.google.com/store/apps/details?id=net.openvpn.openvpn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">OpenVPN Connect</a>. Ensuite, transférez votre fichier <code>.ovpn</code> n’importe où / de toute façon sur votre appareil (je viens d’utiliser Google Drive, mais cela peut ne pas être recommandé). Dans l’application, ouvrez le menu et cliquez sur “Importer”. Accédez à votre fichier <code>.ovpn</code> , cliquez dessus, puis appuyez sur “IMPORT” en haut à droite. Une fois terminé, vous devriez pouvoir vous connecter au VPN.</p>\n<h2>Test du VPN</h2>\n<p>Le moyen le plus simple de tester votre VPN serait de Google “quelle est mon adresse IP” avant et après la connexion. Votre adresse IP doit passer à l’adresse IP publique externe de votre instance GCE une fois que vous êtes connecté au VPN, puis à l’adresse IP de votre réseau une fois déconnectée du VPN.</p>\n<p>Si tout s’est bien passé, c’est tout! Votre nouveau VPN est prêt à être utilisé.</p>\n<h2>Crédits</h2>\n<p>Cet article est basé en grande partie sur <a href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ce didacticiel de la communauté DigitalOcean</a>. Bien que la configuration elle-même soit assez similaire, j’ai pensé écrire un article séparé, car il existe quelques éléments clés différents dans GCE et il est assez facile de se tromper si vous le faites pour la première fois (je parle par expérience).</p>\n<style lang=\"scss\">\n.content pre.code, \n.content pre[class*=\"language-\"].code {\n  /* font-size: 10pt; */\n  font-size: 0.85em;\n  font-family: source-code-pro, Menlo, Monaco, Consolas, \"Courier New\", monospace;\n  color: #fff;\n\n  b {\n    color: yellow;\n    /* text-decoration:underline; */\n    /* background-color: green; */\n  }\n}\n</style>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"J’ai récemment commencé à utiliser OpenVPN et à profiter des différentes options qu’il propose, notamment le masquage du trafic VPN sous TCP:443 (autrement appelé HTTPS). Personnellement, j’aime utiliser GCE pour héberger mes VPN, car je profite de la puissance et de la personnalisation que cela procure."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cependant, il n’y avait absolument aucun tutoriel sur la configuration d’OpenVPN sur GCE. Il existe 10 étapes dans ce didacticiel, mais chaque étape peut exécuter plusieurs lignes de code."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous essayez simplement d’ajouter plus de clients, passer aux étapes 4, 9 et 10."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Table des matières"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"[[toc]]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"1. Création de l’instance"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous voulons utiliser une instance "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"n1-standard-1"}]},{"type":"text","value":" pour sa durabilité et son coût. Dirigez-vous vers le moteur de calcul et cliquez sur “CREATE INSTANCE”."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 450px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 139.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsSAAALEgHS3X78AAACjUlEQVQ4y41Uh3KjMBDV///cZeZcEhfsuFJtBAihyj1JPkJsp7zBO2vBtrfaJZvNZrVaLZdLSqkxRkqplJIeXdfhxHr0Iwx/SFmWRVFcPWBfegS9rms4cl+P4G3dA7/EWkPpNUliKDhCVK01DCDhIs/z8/kMdyGU0jajMr7IhruPiZDqQtvi2jStbLmsG8F5JzoHRG6apvYQwp25orQVyoZqiBA6p/pS60ulKXOSMY7EK49gDwUShTDGhspD2vbGgjXWaGu1J+k/N4CP4iP1/t8NqIugqsPhAK+h1A9KRyQPPN3RTtq2RZ92u12SJO/v76Bnv9+fPKDjHLKoVFYqyP4zCOfcFcaYUhqNQfwgAeQWdCSu/XNvjIAIQssCBfdfY9zqoWwCr43s16mlTB2Pe/gCBTsPKHuPNE0f3TljpJVVZpPqkpkiz1DBECdkHm7oc2N8AOOisZ00uOJRtAmRERCvH23AAnjdbre4M8QNg3KWSn80cCDsETgPMwMvBJ1AaSgVShzHaDv4v2PoKxBcD6QBs+PxCBdo+zCGd9w+AndbRFG0WCxms9l6vQ71oGz4ClclZHgHZAdDIoWoKoyum54QNtwTQHh8F7lu+GQevb29TqdTbJUsyzBAoRNPO3TXZ3M4pS8vf2bz+WQy+euBzNEqEPGDMX5tyy4e2BiQ2EoD4T8Yj+fulyR/zDPiIL1xh4Zqx46e9xmrb7t1PGHdIe2wfahHUCDxCr0IuzXQeRtJ1naRW91rbO/X+WsgKWzvW88g9SeMjLnK0iTPEriO4xMGq/810Cpb1Lao7LU2VdtD5tRtnItbPRLbp2w0ZF6pJ5sER22nWae5MJ0wvDNOkXgsF3hlhDTcP+ahc/8AbrFWxxhIqn8AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/bc1d8c0fe43fbdbd290421761c57cb77/8ffb1/1.webp 293w","/static/bc1d8c0fe43fbdbd290421761c57cb77/2809e/1.webp 450w"],"sizes":["(max-width:","450px)","100vw,","450px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/bc1d8c0fe43fbdbd290421761c57cb77/f93ee/1.png 293w","/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png 450w"],"sizes":["(max-width:","450px)","100vw,","450px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/bc1d8c0fe43fbdbd290421761c57cb77/13283/1.png","alt":"1","title":"1"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Configurez-le avec les options affichées, mais n’appuyez pas encore sur “Créer”"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous ne voyez pas l’image, nous utilisons une instance "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"n1-standard-1"}]},{"type":"text","value":" (1 vCPU, 3,75 Go de mémoire) avec Ubuntu 16.04 LTS installé (vous pouvez choisir un espace de stockage, mais 10 Go suffisent). Puisque notre VPN utilisera TCP: 443, nous devons autoriser le trafic HTTPS maintenant ou plus tard. Vous pouvez donc également le faire immédiatement."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Appuyez sur le bouton “Gestion, sécurité, disques, réseau, …” pour ouvrir les options avancées. Cliquez sur l’onglet Réseau et cliquez sur le bouton d’édition en regard de l’interface réseau sélectionnée."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cliquez sur le menu déroulant “Adresse IP externe” et sélectionnez “Créer une adresse IP”. Entrez un nom, puis appuyez sur “Réserver”. Cette opération associera une adresse IP statique à votre instance, ce qui est probablement ce que vous voulez, sauf si vous souhaitez régénérer les fichiers de configuration de quelque temps. En ce qui concerne les frais, Google ne facture pas les adresses IP statiques pendant leur utilisation. La machine "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"n1-standard-1"}]},{"type":"text","value":" ne devrait pas vous coûter plus de 30 $ par mois. Certes, cela coûte un peu plus cher que la plupart des services VPN, mais la plupart des services VPN ne vous donnent pas un contrôle total :)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 467px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 121.84154175588866%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1UlEQVQ4y5VUy47TMBT1zwE7FgiEWIOQALFkPWyQGDTLEa8VX8DHdAWVyqR5x06TJnEcv+JyOq7YMXGPnKsq9fU9957jkMufzYvr6vXX6s03+uoLfX5dhayXn+nb74y8+8GefCqfXpXProrHl/mD9+n9i4V17yJ9+CF79DEnwziVrN3teT8qIa3Uc8iatBsnTeQ0rX//urn5o7U6uNmFLWu0NYZYa7uua9vWOWeM0SYI0zQppYiUklLKGNvv9zjoEAxsJlrrKIrW63VxizRNd7vdPM94v1wZm/q+B/NhGBA55+Bil+CPIOM4RtttFG03m00cx03TGmPdEkDtmIzKtCqLIisRijxLk7ZtjpO7E0KII21wEOowCDeIuR9txyGjCx0YivBRNp3ouJLKcTFrEzxtEIjjbZomjFEYRisJt4T2jIfVdVGUjNWwSl3XFaX/5vk/nHrGGRAtyzJYpaoqiAy1kHx35RNtJOMY+ASZkM3r7P9e7hlbkZYkSZ7n0OA8e4K6rwkgGUQWG8aGkz3x4EqgPpLhU0S8CbEnKnmp4tVqhVjeAvnnmIRzXCZEbz3PPKQ48T140UEYcQ7D6WJgYGgbCuMH3p73MUDbGBgGiG49ixAg8S/mDk08LO0x+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/73eb40d4f0bb7c23d2790b3c426d1575/8ffb1/2.webp 293w","/static/73eb40d4f0bb7c23d2790b3c426d1575/d57f5/2.webp 467w"],"sizes":["(max-width:","467px)","100vw,","467px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/73eb40d4f0bb7c23d2790b3c426d1575/f93ee/2.png 293w","/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png 467w"],"sizes":["(max-width:","467px)","100vw,","467px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/73eb40d4f0bb7c23d2790b3c426d1575/70a92/2.png","alt":"2","title":"2"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vos interfaces réseau doivent ressembler à l’image. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Veillez à activer le transfert IP"}]},{"type":"text","value":", car cela ne peut plus être modifié après la création de l’instance."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"En règle générale, vous souhaiterez probablement garder votre adresse IP externe secrète. Cela ne me dérange pas de rendre celui-ci public, car cette instance n’existera pas lorsque vous lirez ce tutoriel, et l’adresse IP appartiendra probablement à quelqu’un d’autre."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Appuyez sur “Terminé” et “Créer”. Une fois l’instance prête (un bouton “SSH” noir apparaîtra), cliquez ou double-cliquez sur le bonton “SSH” pour ouvrir une fenêtre SSH. Le reste de la configuration se fera sur cette machine, que nous appellerons le “server”."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"2. Installation OpenVPN et EasyRSA"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"OpenVPN est (évidemment) le serveur VPN que nous utilisons, et EasyRSA est un paquet qui nous permettra de configurer une autorité de certification interne à utiliser."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bien que ce ne soit généralement pas le cas, pour cette configuration, il est souvent nécessaire de lancer une mise à jour d’apt pour pouvoir installer un ou les deux packages. Les deux d’entre eux sont dans les dépôts par défaut d’Ubuntu."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"apt-get"}]},{"type":"text","value":" update\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"apt-get"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" openvpn easy-rsa"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Temps de configurer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"3. Mise en place du CA"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Comme OpenVPN utilise TLS/SSL, il a besoin de certificats pour chiffrer le trafic. Pour cela, nous devrons émettre nos propres certificats de confiance, ce que nous pouvons faire à l’aide de la CA que nous sommes sur le point de configurer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Commençons par copier le "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"easy-rsa"}]},{"type":"text","value":" de modèles du paquet "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"easy-rsa"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"make-cadir ~/openvpn-ca\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"cd"}]},{"type":"text","value":" ~/openvpn-ca"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il y a des valeurs que nous pouvons vouloir éditer, alors allons-y et "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nano vars"}]},{"type":"text","value":". Si vous voulez utiliser vim, continuez, mais puisque j’essaie de garder mes tutoriels aussi simples que possible, j’utilise nano."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"À partir de ce moment, s’il y a une partie d’une commande qui dépend d’une valeur que vous choisissez, elle sera en gras. Tout le code qui n’est pas généré par un utilisateur sera en italique."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Faites défiler vers le bas du fichier (ce n’est pas trop long) et vous devriez trouver ce qui suit:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"export KEY_COUNTRY=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"US"}]},{"type":"text","value":"\"\nexport KEY_PROVINCE=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"CA"}]},{"type":"text","value":"\"\nexport KEY_CITY=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"SanFrancisco"}]},{"type":"text","value":"\"\nexport KEY_ORG=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"Fort-Funston"}]},{"type":"text","value":"\"\nexport KEY_EMAIL=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"me@myhost.mydomain"}]},{"type":"text","value":"\"\nexport KEY_OU=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"MyOrganizationalUnit"}]},{"type":"text","value":"\"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Éditez autant d’entre eux (ou aucun d’eux) que vous le souhaitez. Juste en dessous de ces valeurs devrait être "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"export KEY_NAME=\"EasyRSA\""}]},{"type":"text","value":". Pour simplifier notre configuration, nous allons modifier cette ligne comme suit:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"export KEY_NAME=\""},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":"\"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Enregistrez et fermez le fichier (ctrl + x, y, entrez). Les variables que nous venons de modifier seront utilisées pour le processus de signature de notre autorité de certification. Toujours dans le "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"openvpn-ca"}]},{"type":"text","value":", exécutez la commande suivante:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"source"}]},{"type":"text","value":" vars"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous avez bien fait, le re "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"username"}]},{"type":"text","value":"/openvpn-ca/keys"}]},{"type":"text","value":". C’est ce que nous voulons. Pour assurer un environnement de travail propre, nous allons lancer "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"./clean-all"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Maintenant, construisons le CA"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"./build-ca"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Toutes les variables que nous avons déjà définies doivent se renseigner elles-mêmes. Il suffit donc d’y accéder en appuyant plusieurs fois sur Entrée. À la fin, vous aurez une autorité de certification prête à commencer à signer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous avons également besoin d’un certificat de serveur et d’une clé de cryptage pour garantir la sécurité de notre trafic."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Créons notre certificat de serveur et notre clé."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"./build-key-server "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Passer à nouveau les invites de commande. Nous n’entrerons pas un mot de passe, cette fois. Les deux dernières invites vous obligent à entrer "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"y"}]},{"type":"text","value":" pour signer le certificat. Assurez-vous de ne pas les ignorer!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Comme indiqué précédemment, nous avons également besoin d’une clé de chiffrement. Pour les besoins de ce didacticiel, nous allons générer une clé Diffie-Hellman, qui a tendance à être plutôt forte. Bien sûr, une grande [force] entraîne une grande [inefficacité]. Par conséquent, quelle que soit votre système, la commande suivante prendra probablement quelques minutes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"./build-dh"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous renforcerons cela avec une signature HMAC, afin de nous assurer que la vérification de l’intégrité TLS est plus sûre."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"openvpn --genkey --secret keys/"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"tiv"}]},{"type":"text","value":".key\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"4. Générer un certificat client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Naturellement, si vous allez utiliser une autorité de certification, votre client doit également disposer d’un certificat. Bien que vous puissiez le faire sur votre ordinateur client et que le serveur le signe, nous essayons de garder les choses simples et hébergées sur un seul ordinateur."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous avez plusieurs clients, vous pouvez suivre cette étape plusieurs fois. Assurez-vous simplement de rendre vos noms de client uniques."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Assurez-vous que vous êtes dans le "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"openvpn-ca"}]},{"type":"text","value":" et que votre fichier vars est synchronisé."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"cd"}]},{"type":"text","value":" ~/openvpn-ca\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"source"}]},{"type":"text","value":" vars"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Maintenant, nous allons construire une clé client en tant que telle:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"./build-key "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Une fois de plus, tout doit être pré-rempli. Passez donc tous les éléments, sauf les deux dernières invites, qui vous demanderont de signer en entrant "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"y"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"5. Configurer le serveur OpenVPN"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"OpenVPN s’installe sous le répertoire "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"/etc/openvpn"}]},{"type":"text","value":". Pour que tout fonctionne, nous devons déplacer certains fichiers dans ce dossier."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"cd ~/openvpn-ca/keys\nsudo cp ca.crt server.crt server.key "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"tiv"}]},{"type":"text","value":".key dh2048.pem /etc/openvpn\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Par défaut, OpenVPN est fourni avec un exemple de configuration. Par souci de simplicité, nous simplifierons la décompression dans notre dossier de configuration."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | sudo tee /etc/openvpn/server.conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ensuite, nous allons éditer le fichier de configuration:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" /etc/openvpn/server.conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La première étape consiste à trouver la directive "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"tls-auth"}]},{"type":"text","value":". Il y aura un point-virgule ("},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":";"}]},{"type":"text","value":") à côté de la directive, que nous supprimerons. En dessous, nous ajouterons une ligne."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"tls-auth "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"tiv"}]},{"type":"text","value":".key 0 # This file is secret\nkey-direction 0\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nous devons également chiffrer notre serveur, éditons donc les directives de chiffrement juste en dessous de cette section. Plus précisément, nous décommentons la ligne AES-128-CBC et ajouterons une directive "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"cipher AES-128-CBC\nauth SHA256"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ensuite, les paramètres d’utilisateur et de groupe:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"user nobody\ngroup nogroup"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Facultativement, nous pourrions opter pour l’envoi de tout le trafic via le VPN. Pour cela, recherchez la directive "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"redirect-gateway"}]},{"type":"text","value":" et décommentez-la."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"push \"redirect-gateway def1 bypass-dhcp\""}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Juste en dessous, il devrait y avoir quelques lignes d’"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dhcp-option"}]},{"type":"text","value":". Décommentez ceux-là aussi."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"push \"dhcp-option DNS 208.67.222.222\"\npush \"dhcp-option DNS 208.67.220.220\""}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Optionnellement, nous pouvons vouloir changer le port et le protocole sur lesquels OpenVPN fonctionne. La valeur par défaut est UDP: 1194, mais si votre réseau bloque les connexions VPN, ce sera probablement l’une des victimes. Le déguisement serait d’utiliser TCP: 443, qui est le port HTTPS."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"port 443\n\nproto tcp\n;proto udp"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous n’avez pas utilisé «serveur» comme nom de serveur, vos fichiers "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"crt"}]},{"type":"text","value":" ont un nom différent. Mettez-les à jour en conséquence."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"cert "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":".crt\nkey "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":".key\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Enregistrez et fermez le fichier."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"6. Préparer Ubuntu"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bien que nous ayons déjà configuré le transfert IP, etc., nous devons apporter quelques modifications pour activer ces options."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" /etc/sysctl.conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Recherchez la ligne suivante et supprimez le # (caractère de commentaire)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"net.ipv4.ip_forward=1"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sauver et fermer. Pour mettre à jour les paramètres de session, exécutez:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" sysctl -p"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ensuite, nous devons trouver et mettre à jour nos règles de pare-feu (UFW) pour masquer les clients. La première étape consiste à trouver l’interface sur laquelle nous fonctionnons:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ip route | grep default"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L’interface que nous voulons est celle qui contient le mot “dev”. Dans notre cas, cela ressemble à ceci:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"default via 10.138.0.1 dev "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"ens4"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Donc, notre interface est "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ens4"}]},{"type":"text","value":". Avec cela, nous mettrons à jour nos règles de pare-feu:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" /etc/ufw/before.rules"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Au-dessus, là où il est indiqué "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Don't delete these required lines..."}]},{"type":"text","value":" ajoutez le code suivant:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"# OPENVPN\n# NAT Table\n*nat\n:POSTROUTING ACCEPT [0:0] \n# OpenVPN client traffic\n-A POSTROUTING -s 10.8.0.0/8 -o "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"ens4"}]},{"type":"text","value":" -j MASQUERADE\nCOMMIT\n# OPENVPN\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sauver et fermer. Ensuite, nous devons transférer les paquets."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" /etc/default/ufw"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Recherchez la directive "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"DEFAULT_FORWARD_POLICY"}]},{"type":"text","value":" et remplacez-la de "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"\"DROP\""}]},{"type":"text","value":" par "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"\"ACCEPT\""}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DEFAULT_FORWARD_POLICY=\"ACCEPT\""}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sauver et fermer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"7. Lancer OpenVPN"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour démarrer le serveur, exécutez ce qui suit:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"sudo systemctl start openvpn@"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour vérifier qu’il a bien démarré, lancez:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"sudo systemctl status openvpn@"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si tout se passe bien, vous devriez voir une sortie incluant "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Active: active (running)"}]},{"type":"text","value":". Vous devrez peut-être "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"q"}]},{"type":"text","value":" sur "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"q"}]},{"type":"text","value":" pour quitter le panneau d’informations. Si cela vous convient, liez le service à la séquence de démarrage."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"sudo systemctl enable openvpn@"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"8. Configuration d’une structure de configuration client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour faciliter la configuration des configurations client, nous allons d’abord créer une structure. Pour commencer, créez un dossier de configuration pour stocker les fichiers de configuration du client."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"mkdir"}]},{"type":"text","value":" -p ~/clients/files"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Les clés du client seront dans ces configurations, alors verrouillons les permissions sur le répertoire "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"files"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"chmod"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"700"}]},{"type":"text","value":" ~/clients/files"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Copiez l’exemple de configuration."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"cp"}]},{"type":"text","value":" /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/clients/base.conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Éditons le fichier:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" ~/clients/base.conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trouvez la directive "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"remote"}]},{"type":"text","value":". Remplacez "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"my-server-1"}]},{"type":"text","value":" par l’adresse IP externe publique attribuée à votre instance GCE. Si vous avez choisi un port autre que 1194, mettez-le à jour en conséquence."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"remote "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"35.197.111.236 443"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mettez également à jour votre protocole."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"proto "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"tcp"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Décommentez l’utilisateur et le groupe:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"user nobody\ngroup nogroup"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trouvez les directives "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ca"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"cert"}]},{"type":"text","value":" et "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"key"}]},{"type":"text","value":", commentez-les, car nos configurations les incluront automatiquement."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# ca ca.crt\n# cert client.crt\n# key client.key"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Utilisez les mêmes paramètres de chiffrement et d’authentification que précédemment:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"cipher AES-128-CBC\nauth SHA256"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Quelque part, nous devrons ajouter la "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"key-direction"}]},{"type":"text","value":". Assurez-vous d’utiliser 1, comme c’est le cas pour le client. 0 était pour le serveur."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"key-direction 1"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si votre configuration client actuelle est (ou sera) utilisée sur un périphérique Linux, ajoutez les éléments suivants:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"script-security 2\nup /etc/openvpn/update-resolv-conf\ndown /etc/openvpn/update-resolv-conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notez que si vous les incluez dans un environnement non-Linux (Android et macOS inclus dans un non-Linux), vos clients peuvent se comporter de manière étrange."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sauver et fermer. Ensuite, nous devons écrire un script pour générer nos configs client rapidement et facilement."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nano"}]},{"type":"text","value":" ~/clients/gen_config.sh"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A l’intérieur, collez ce code:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"#!/bin/bash\n\n# First argument: Client identifier\n\nKEY_DIR=~/openvpn-ca/keys\nOUTPUT_DIR=~/clients/files\nBASE_CONFIG=~/clients/base.conf\n\ncat ${BASE_CONFIG} \\\n    <(echo -e '<ca>') \\\n    ${KEY_DIR}/ca.crt \\\n    <(echo -e '</ca>\\n<cert>') \\\n    ${KEY_DIR}/${1}.crt \\\n    <(echo -e '</cert>\\n<key>') \\\n    ${KEY_DIR}/${1}.key \\\n    <(echo -e '</key>\\n<tls-auth>') \\\n    ${KEY_DIR}/"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"tiv"}]},{"type":"text","value":".key \\\n    <(echo -e '</tls-auth>') \\\n    > ${OUTPUT_DIR}/${1}.ovpn\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"./02/gen_config.sh","download":true},"children":[{"type":"text","value":"gen_config.sh"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"{1}"}]},{"type":"text","value":" fait ici référence au premier argument, qui sera notre nom de client. Assurez-vous de mettre à jour "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"tiv"}]},{"type":"text","value":".key fonction du nom de votre clé HMAC."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Autoriser l’exécution de ce script:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"chmod"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"700"}]},{"type":"text","value":" ~/clients/gen_config.sh"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"9. Générer des configurations client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le pas que vous attendiez tous est enfin arrivé. Nous allons générer nos configurations client."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-bash","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-bash","code"]},"children":[{"type":"text","value":"cd ~/clients\n./gen_config.sh "},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vérifiez que cela a fonctionné en exécutant:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ls"}]},{"type":"text","value":" ~/clients/files"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si tel est le cas, il devrait maintenant y avoir un fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":".ovpn"}]},{"type":"text","value":" dans ce répertoire. Nous devons télécharger ce fichier et le transférer sur nos appareils. Pour ce faire, cliquez sur l’icône représentant une roue en haut à droite de la session SSH, puis sélectionnez «Télécharger le fichier»."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le chemin pleinement qualifié devrait ressembler à ceci:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["language-text","extra-class"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["language-text","code"]},"children":[{"type":"text","value":"/home/"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"username"}]},{"type":"text","value":"/clients/files/"},{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":".ovpn\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"10. Installation sur les clients"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour Windows, téléchargez l’application client "},{"type":"element","tagName":"a","properties":{"href":"https://openvpn.net/index.php/open-source/downloads.html","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"OpenVPN"}]},{"type":"text","value":". Une fois installé, déplacez votre fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"element","tagName":"b","properties":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":".ovpn"}]},{"type":"text","value":" vers "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"C:\\Program Files\\OpenVPN\\config"}]},{"type":"text","value":". Pour ouvrir OpenVPN, vous devez exécuter l’application en tant qu’administrateur. Une fois à l’intérieur, vous devriez voir et pouvoir vous connecter à votre VPN."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour macOS, la plupart des gens suggèrent d’utiliser "},{"type":"element","tagName":"a","properties":{"href":"https://tunnelblick.net/","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"Tunnelblick"}]},{"type":"text","value":" bien que tout autre client OpenVPN (même s’il soit sans danger) soit probablement bon aussi. Une fois installé, vous devriez pouvoir faire glisser n’importe .ovpn fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" sur l’icône Tunnelblick de la barre de menus pour installer la configuration. Utilisez la barre de menus pour vous connecter ensuite au VPN. Si vous êtes interrogé sur le plugin "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"down-root.so"}]},{"type":"text","value":", prenez une décision! Je l’ai sauté parce que je suis capable de reconnecter ma connexion, mais c’est à vous de décider."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sous Linux, installez le paquet "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"openvpn"}]},{"type":"text","value":" en utilisant votre gestionnaire de paquets. Les utilisateurs de CentOS devront d’abord installer "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"epel-release"}]},{"type":"text","value":" utilisant "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"yum"}]},{"type":"text","value":". Une fois installé, lancez "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ls /etc/openvpn"}]},{"type":"text","value":". Si la sortie "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ne"}]},{"type":"text","value":" présente "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"pas"}]},{"type":"text","value":" de fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"update-resolve-conf"}]},{"type":"text","value":", vous devez modifier votre fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" et supprimer les lignes suivantes (si vous les avez ajoutées):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"script-security 2\nup /etc/openvpn/update-resolv-conf\ndown /etc/openvpn/update-resolv-conf"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si vous n’avez jamais ajouté ces lignes mais trouvé un fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"update-resolv-conf"}]},{"type":"text","value":", ajoutez-les! Les utilisateurs de CentOS devront modifier le "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"group"}]},{"type":"text","value":" dans le fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" de "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nogroup"}]},{"type":"text","value":" à "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nobody"}]},{"type":"text","value":" pour se conformer aux normes du système d’exploitation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour vous connecter, lancez "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sudo openvpn — config client .ovpn"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour iOS, installez l’application "},{"type":"element","tagName":"a","properties":{"href":"https://itunes.apple.com/us/app/id590379981","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"OpenVPN Connect"}]},{"type":"text","value":". Ensuite, ouvrez iTunes sur votre ordinateur et accédez à iPhone> Applications. Faites défiler jusqu’à la section «Partage de fichiers» et sélectionnez “OpenVPN”. Faites glisser votre fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" dans le panneau “OpenVPN Documents”. Ouvrir l’application sur votre téléphone devrait maintenant afficher un message indiquant qu’un nouveau profil est prêt à être importé. Une fois importé, vous devriez pouvoir vous connecter au VPN."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pour Android, installez l’application "},{"type":"element","tagName":"a","properties":{"href":"https://play.google.com/store/apps/details?id=net.openvpn.openvpn","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"OpenVPN Connect"}]},{"type":"text","value":". Ensuite, transférez votre fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" n’importe où / de toute façon sur votre appareil (je viens d’utiliser Google Drive, mais cela peut ne pas être recommandé). Dans l’application, ouvrez le menu et cliquez sur “Importer”. Accédez à votre fichier "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".ovpn"}]},{"type":"text","value":" , cliquez dessus, puis appuyez sur “IMPORT” en haut à droite. Une fois terminé, vous devriez pouvoir vous connecter au VPN."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Test du VPN"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le moyen le plus simple de tester votre VPN serait de Google “quelle est mon adresse IP” avant et après la connexion. Votre adresse IP doit passer à l’adresse IP publique externe de votre instance GCE une fois que vous êtes connecté au VPN, puis à l’adresse IP de votre réseau une fois déconnectée du VPN."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si tout s’est bien passé, c’est tout! Votre nouveau VPN est prêt à être utilisé."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Crédits"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cet article est basé en grande partie sur "},{"type":"element","tagName":"a","properties":{"href":"https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04","target":"_blank","rel":["nofollow","noopener","noreferrer"]},"children":[{"type":"text","value":"ce didacticiel de la communauté DigitalOcean"}]},{"type":"text","value":". Bien que la configuration elle-même soit assez similaire, j’ai pensé écrire un article séparé, car il existe quelques éléments clés différents dans GCE et il est assez facile de se tromper si vous le faites pour la première fois (je parle par expérience)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"lang":"scss"},"children":[{"type":"text","value":"\n.content pre.code, \n.content pre[class*=\"language-\"].code {\n  /* font-size: 10pt; */\n  font-size: 0.85em;\n  font-family: source-code-pro, Menlo, Monaco, Consolas, \"Courier New\", monospace;\n  color: #fff;\n\n  b {\n    color: yellow;\n    /* text-decoration:underline; */\n    /* background-color: green; */\n  }\n}\n"}]}],"data":{"quirksMode":false}},"excerpt":"J’ai récemment commencé à utiliser OpenVPN et à profiter des différentes options qu’il propose, notamment le masquage du trafic VPN sous TCP:443 (autrement appelé HTTPS). Personnellement, j’aime utiliser GCE pour héberger mes VPN, car je profite de la puissance et de la personnalisation que cela procure. Cependant, il n’y avait absolument aucun tutoriel sur la configuration d’OpenVPN sur GCE. Il existe 10 étapes dans ce didacticiel, mais chaque étape peut exécuter plusieurs lignes de code. Si vous essayez simplement d’ajouter plus de clients, passer aux étapes 4, 9 et 10. Table des matières [toc] 1. Création de l’instance Nous voulons utiliser une instance n1-standard-1 pour sa durabilité et son coût. Dirigez-vous vers le moteur de calcul et cliquez sur “CREATE INSTANCE”.  Configurez-le avec les options affichées, mais n’appuyez pas encore sur “Créer” Si vous ne voyez pas l’image, nous utilisons une instance n1-standard-1 (1 vCPU, 3,75 Go de mémoire) avec Ubuntu 16.04 LTS installé (vous pouvez choisir un espace de stockage, mais 10 Go suffisent). Puisque notre VPN utilisera TCP: 443, nous devons autoriser le trafic HTTPS maintenant ou plus tard. Vous pouvez donc également le faire immédiatement. Appuyez sur le bouton “Gestion, sécurité, disques, réseau, …” pour ouvrir les options avancées. Cliquez sur l’onglet Réseau et cliquez sur le bouton d’édition en regard de l’interface réseau sélectionnée. Cliquez sur le menu déroulant “Adresse IP externe” et sélectionnez “Créer une adresse IP”. Entrez un nom, puis appuyez sur “Réserver”. Cette opération associera une adresse IP statique à votre instance, ce qui est probablement ce que vous voulez, sauf si vous souhaitez régénérer les fichiers de configuration de quelque temps. En ce qui concerne les frais, Google ne facture pas les adresses IP statiques pendant leur utilisation. La machine n1-standard-1 ne devrait pas vous coûter plus de 30 $ par mois. Certes, cela coûte un peu plus cher que la plupart des services VPN, mais la plupart des services VPN ne vous donnent pas un contrôle total :)  Vos interfaces réseau doivent ressembler à l’image. Veillez à activer le transfert IP, car cela ne peut plus être modifié après la création de l’instance. En règle générale, vous souhaiterez probablement garder votre adresse IP externe secrète. Cela ne me dérange pas de rendre celui-ci public, car cette instance n’existera pas lorsque vous lirez ce tutoriel, et l’adresse IP appartiendra probablement à quelqu’un d’autre. Appuyez sur “Terminé” et “Créer”. Une fois l’instance prête (un bouton “SSH” noir apparaîtra), cliquez ou double-cliquez sur le bonton “SSH” pour ouvrir une fenêtre SSH. Le reste de la configuration se fera sur cette machine, que nous appellerons le “server”. 2. Installation OpenVPN et EasyRSA OpenVPN est (évidemment) le serveur VPN que nous utilisons, et EasyRSA est un paquet qui nous permettra de configurer une autorité de certification interne à utiliser. Bien que ce ne soit généralement pas le cas, pour cette configuration, il est souvent nécessaire de lancer une mise à jour d’apt pour pouvoir installer un ou les deux packages. Les deux d’entre eux sont dans les dépôts par défaut d’Ubuntu. Temps de configurer. 3. Mise en place du CA Comme OpenVPN utilise TLS/SSL, il a besoin de certificats pour chiffrer le trafic. Pour cela, nous devrons émettre nos propres certificats de confiance, ce que nous pouvons faire à l’aide de la CA que nous sommes sur le point de configurer. Commençons par copier le easy-rsa de modèles du paquet easy-rsa. Il y a des valeurs que nous pouvons vouloir éditer, alors allons-y et nano vars. Si vous voulez utiliser vim, continuez, mais puisque j’essaie de garder mes tutoriels aussi simples que possible, j’utilise nano. À partir de ce moment, s’il y a une partie d’une commande qui dépend d’une valeur que vous choisissez, elle sera en gras. Tout le code qui n’est pas généré par un utilisateur sera en italique. Faites défiler vers le bas du fichier (ce n’est pas trop long) et vous devriez trouver ce qui suit: Éditez autant d’entre eux (ou aucun d’eux) que vous le souhaitez. Juste en dessous de ces valeurs devrait être export KEY_NAME=\"EasyRSA\". Pour simplifier notre configuration, nous allons modifier cette ligne comme suit: Enregistrez et fermez le fichier (ctrl + x, y, entrez). Les variables que nous venons de modifier seront utilisées pour le processus de signature de notre autorité de certification. Toujours dans le openvpn-ca, exécutez la commande suivante: Si vous avez bien fait, le re NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/username/openvpn-ca/keys. C’est ce que nous voulons. Pour assurer un environnement de travail propre, nous allons lancer ./clean-all. Maintenant, construisons le CA Toutes les variables que nous avons déjà définies doivent se renseigner elles-mêmes. Il suffit donc d’y accéder en appuyant plusieurs fois sur Entrée. À la fin, vous aurez une autorité de certification prête à commencer à signer. Nous avons également besoin d’un certificat de serveur et d’une clé de cryptage pour garantir la sécurité de notre trafic. Créons notre certificat de serveur et notre clé. Passer à nouveau les invites de commande. Nous n’entrerons pas un mot de passe, cette fois. Les deux dernières invites vous obligent à entrer y pour signer le certificat. Assurez-vous de ne pas les ignorer! Comme indiqué précédemment, nous avons également besoin d’une clé de chiffrement. Pour les besoins de ce didacticiel, nous allons générer une clé Diffie-Hellman, qui a tendance à être plutôt forte. Bien sûr, une grande force entraîne une grande inefficacité. Par conséquent, quelle que soit votre système, la commande suivante prendra probablement quelques minutes. Nous renforcerons cela avec une signature HMAC, afin de nous assurer que la vérification de l’intégrité TLS est plus sûre. 4. Générer un certificat client Naturellement, si vous allez utiliser une autorité de certification, votre client doit également disposer d’un certificat. Bien que vous puissiez le faire sur votre ordinateur client et que le serveur le signe, nous essayons de garder les choses simples et hébergées sur un seul ordinateur. Si vous avez plusieurs clients, vous pouvez suivre cette étape plusieurs fois. Assurez-vous simplement de rendre vos noms de client uniques. Assurez-vous que vous êtes dans le openvpn-ca et que votre fichier vars est synchronisé. Maintenant, nous allons construire une clé client en tant que telle: Une fois de plus, tout doit être pré-rempli. Passez donc tous les éléments, sauf les deux dernières invites, qui vous demanderont de signer en entrant y. 5. Configurer le serveur OpenVPN OpenVPN s’installe sous le répertoire /etc/openvpn. Pour que tout fonctionne, nous devons déplacer certains fichiers dans ce dossier. Par défaut, OpenVPN est fourni avec un exemple de configuration. Par souci de simplicité, nous simplifierons la décompression dans notre dossier de configuration. Ensuite, nous allons éditer le fichier de configuration: La première étape consiste à trouver la directive tls-auth. Il y aura un point-virgule (;) à côté de la directive, que nous supprimerons. En dessous, nous ajouterons une ligne. Nous devons également chiffrer notre serveur, éditons donc les directives de chiffrement juste en dessous de cette section. Plus précisément, nous décommentons la ligne AES-128-CBC et ajouterons une directive auth. Ensuite, les paramètres d’utilisateur et de groupe: Facultativement, nous pourrions opter pour l’envoi de tout le trafic via le VPN. Pour cela, recherchez la directive redirect-gateway et décommentez-la. Juste en dessous, il devrait y avoir quelques lignes d’dhcp-option. Décommentez ceux-là aussi. Optionnellement, nous pouvons vouloir changer le port et le protocole sur lesquels OpenVPN fonctionne. La valeur par défaut est UDP: 1194, mais si votre réseau bloque les connexions VPN, ce sera probablement l’une des victimes. Le déguisement serait d’utiliser TCP: 443, qui est le port HTTPS. Si vous n’avez pas utilisé «serveur» comme nom de serveur, vos fichiers crt ont un nom différent. Mettez-les à jour en conséquence. Enregistrez et fermez le fichier. 6. Préparer Ubuntu Bien que nous ayons déjà configuré le transfert IP, etc., nous devons apporter quelques modifications pour activer ces options. Recherchez la ligne suivante et supprimez le # (caractère de commentaire). Sauver et fermer. Pour mettre à jour les paramètres de session, exécutez: Ensuite, nous devons trouver et mettre à jour nos règles de pare-feu (UFW) pour masquer les clients. La première étape consiste à trouver l’interface sur laquelle nous fonctionnons: L’interface que nous voulons est celle qui contient le mot “dev”. Dans notre cas, cela ressemble à ceci: Donc, notre interface est ens4. Avec cela, nous mettrons à jour nos règles de pare-feu: Au-dessus, là où il est indiqué Don't delete these required lines... ajoutez le code suivant: Sauver et fermer. Ensuite, nous devons transférer les paquets. Recherchez la directive DEFAULT_FORWARD_POLICY et remplacez-la de \"DROP\" par \"ACCEPT\". Sauver et fermer. 7. Lancer OpenVPN Pour démarrer le serveur, exécutez ce qui suit: Pour vérifier qu’il a bien démarré, lancez: Si tout se passe bien, vous devriez voir une sortie incluant Active: active (running). Vous devrez peut-être q sur q pour quitter le panneau d’informations. Si cela vous convient, liez le service à la séquence de démarrage. 8. Configuration d’une structure de configuration client Pour faciliter la configuration des configurations client, nous allons d’abord créer une structure. Pour commencer, créez un dossier de configuration pour stocker les fichiers de configuration du client. Les clés du client seront dans ces configurations, alors verrouillons les permissions sur le répertoire files. Copiez l’exemple de configuration. Éditons le fichier: Trouvez la directive remote. Remplacez my-server-1 par l’adresse IP externe publique attribuée à votre instance GCE. Si vous avez choisi un port autre que 1194, mettez-le à jour en conséquence. Mettez également à jour votre protocole. Décommentez l’utilisateur et le groupe: Trouvez les directives ca, cert et key, commentez-les, car nos configurations les incluront automatiquement. Utilisez les mêmes paramètres de chiffrement et d’authentification que précédemment: Quelque part, nous devrons ajouter la key-direction. Assurez-vous d’utiliser 1, comme c’est le cas pour le client. 0 était pour le serveur. Si votre configuration client actuelle est (ou sera) utilisée sur un périphérique Linux, ajoutez les éléments suivants: Notez que si vous les incluez dans un environnement non-Linux (Android et macOS inclus dans un non-Linux), vos clients peuvent se comporter de manière étrange. Sauver et fermer. Ensuite, nous devons écrire un script pour générer nos configs client rapidement et facilement. A l’intérieur, collez ce code: gen_config.sh Le {1} fait ici référence au premier argument, qui sera notre nom de client. Assurez-vous de mettre à jour tiv.key fonction du nom de votre clé HMAC. Autoriser l’exécution de ce script: 9. Générer des configurations client Le pas que vous attendiez tous est enfin arrivé. Nous allons générer nos configurations client. Vérifiez que cela a fonctionné en exécutant: Si tel est le cas, il devrait maintenant y avoir un fichier client.ovpn dans ce répertoire. Nous devons télécharger ce fichier et le transférer sur nos appareils. Pour ce faire, cliquez sur l’icône représentant une roue en haut à droite de la session SSH, puis sélectionnez «Télécharger le fichier». Le chemin pleinement qualifié devrait ressembler à ceci: 10. Installation sur les clients Pour Windows, téléchargez l’application client OpenVPN. Une fois installé, déplacez votre fichier client.ovpn vers C:\\Program Files\\OpenVPN\\config. Pour ouvrir OpenVPN, vous devez exécuter l’application en tant qu’administrateur. Une fois à l’intérieur, vous devriez voir et pouvoir vous connecter à votre VPN. Pour macOS, la plupart des gens suggèrent d’utiliser Tunnelblick bien que tout autre client OpenVPN (même s’il soit sans danger) soit probablement bon aussi. Une fois installé, vous devriez pouvoir faire glisser n’importe .ovpn fichier .ovpn sur l’icône Tunnelblick de la barre de menus pour installer la configuration. Utilisez la barre de menus pour vous connecter ensuite au VPN. Si vous êtes interrogé sur le plugin down-root.so, prenez une décision! Je l’ai sauté parce que je suis capable de reconnecter ma connexion, mais c’est à vous de décider. Sous Linux, installez le paquet openvpn en utilisant votre gestionnaire de paquets. Les utilisateurs de CentOS devront d’abord installer epel-release utilisant yum. Une fois installé, lancez ls /etc/openvpn. Si la sortie ne présente pas de fichier update-resolve-conf, vous devez modifier votre fichier .ovpn et supprimer les lignes suivantes (si vous les avez ajoutées): Si vous n’avez jamais ajouté ces lignes mais trouvé un fichier update-resolv-conf, ajoutez-les! Les utilisateurs de CentOS devront modifier le group dans le fichier .ovpn de nogroup à nobody pour se conformer aux normes du système d’exploitation. Pour vous connecter, lancez sudo openvpn — config client .ovpn. Pour iOS, installez l’application OpenVPN Connect. Ensuite, ouvrez iTunes sur votre ordinateur et accédez à iPhone> Applications. Faites défiler jusqu’à la section «Partage de fichiers» et sélectionnez “OpenVPN”. Faites glisser votre fichier .ovpn dans le panneau “OpenVPN Documents”. Ouvrir l’application sur votre téléphone devrait maintenant afficher un message indiquant qu’un nouveau profil est prêt à être importé. Une fois importé, vous devriez pouvoir vous connecter au VPN. Pour Android, installez l’application OpenVPN Connect. Ensuite, transférez votre fichier .ovpn n’importe où / de toute façon sur votre appareil (je viens d’utiliser Google Drive, mais cela peut ne pas être recommandé). Dans l’application, ouvrez le menu et cliquez sur “Importer”. Accédez à votre fichier .ovpn , cliquez dessus, puis appuyez sur “IMPORT” en haut à droite. Une fois terminé, vous devriez pouvoir vous connecter au VPN. Test du VPN Le moyen le plus simple de tester votre VPN serait de Google “quelle est mon adresse IP” avant et après la connexion. Votre adresse IP doit passer à l’adresse IP publique externe de votre instance GCE une fois que vous êtes connecté au VPN, puis à l’adresse IP de votre réseau une fois déconnectée du VPN. Si tout s’est bien passé, c’est tout! Votre nouveau VPN est prêt à être utilisé. Crédits Cet article est basé en grande partie sur ce didacticiel de la communauté DigitalOcean. Bien que la configuration elle-même soit assez similaire, j’ai pensé écrire un article séparé, car il existe quelques éléments clés différents dans GCE et il est assez facile de se tromper si vous le faites pour la première fois (je parle par expérience).","timeToRead":14,"frontmatter":{"title":"Configuration d'un serveur OpenVPN sur Google Compute Engine","subtitle":"","userDate":"14 April 2019","date":"2019-04-14T08:00:00.000Z","tags":["Google Cloud","OpenVPN","VPN"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHtZYUFyf/EABkQAAIDAQAAAAAAAAAAAAAAAAECABESIP/aAAgBAQABBQLRss023H//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIRICEiMv/aAAgBAQAGPwJdTDJOKf/EABoQAAICAwAAAAAAAAAAAAAAAAABESEgMUH/2gAIAQEAAT8hqJULbAuzrD//2gAMAwEAAgADAAAAEPz/AP/EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQMBAT8QUTll/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAgEBPxAEe2l//8QAHBABAQACAgMAAAAAAAAAAAAAAREAISAxQVFh/9oACAEBAAE/EBhvcvvVw0sN8wxo2hndH6a4f//Z","aspectRatio":1.7763157894736843,"src":"/static/3bf8405e70096f9e75e8c849f54b0d1f/de998/openvpn.jpg","srcSet":"/static/3bf8405e70096f9e75e8c849f54b0d1f/de998/openvpn.jpg 810w","sizes":"(max-width: 810px) 100vw, 810px"}}},"author":{"id":"ludo","name":"Wyffels Ludovic","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQ4y2MwsXf5T03MMGogGBvbOYNpUwdXOIbJwdgwNQQNhCk0snX6r2thC8Y6QGxg7QCWA/FBcrgMxepCkAZrV6//EYmpYBydkvHfMzjiv5mj2//whJT/Nm7ecEMJGgjykp6V/f+AqLj/O/Ye+L8diA8dO/m/pbv/v72n3/+tu/f9D45N/K9naYcSFESFoRXQlSCX2rh7g/kgr1u5epIWhiAMCi/3wLD/fVNn/u+fNgtMT5g+6//kmXOB/Jn/PYLCwWrINnDijDlAPBvKJ8NAZC+DIgCkGYRBbJAYSV5GjpTte/b/PwiMkLj0nP8xqVn/Dxw9AY6kwOh40iIFlmzCgUkmKjnjvx0wdu08fMFskJi1mxfxyQY9YetAEzJyQic5YaNnPeTgIDnrjZaHJGMACtTMXoVAJ6sAAAAASUVORK5CYII=","width":400,"height":400,"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png","srcSet":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png 1x"}}]}}}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"id":"f418fcf4-799d-58ac-bba1-51c998bf2ed1","timeToRead":14,"excerpt":"J’ai récemment commencé à utiliser OpenVPN et à profiter des différentes options qu’il propose, notamment le masquage du trafic VPN sous TCP:443 (autrement appelé HTTPS). Personnellement, j’aime utiliser GCE pour héberger mes VPN, car je profite de la puissance et de la personnalisation que cela procure. Cependant, il n’y avait absolument aucun tutoriel sur la configuration d’OpenVPN sur GCE. Il existe 10 étapes dans ce didacticiel, mais chaque étape peut exécuter plusieurs lignes de code. Si vous essayez simplement d’ajouter plus de clients, passer aux étapes 4, 9 et 10. Table des matières [toc] 1. Création de l’instance Nous voulons utiliser une instance n1-standard-1 pour sa durabilité et son coût. Dirigez-vous vers le moteur de calcul et cliquez sur “CREATE INSTANCE”.  Configurez-le avec les options affichées, mais n’appuyez pas encore sur “Créer” Si vous ne voyez pas l’image, nous utilisons une instance n1-standard-1 (1 vCPU, 3,75 Go de mémoire) avec Ubuntu 16.04 LTS installé (vous pouvez choisir un espace de stockage, mais 10 Go suffisent). Puisque notre VPN utilisera TCP: 443, nous devons autoriser le trafic HTTPS maintenant ou plus tard. Vous pouvez donc également le faire immédiatement. Appuyez sur le bouton “Gestion, sécurité, disques, réseau, …” pour ouvrir les options avancées. Cliquez sur l’onglet Réseau et cliquez sur le bouton d’édition en regard de l’interface réseau sélectionnée. Cliquez sur le menu déroulant “Adresse IP externe” et sélectionnez “Créer une adresse IP”. Entrez un nom, puis appuyez sur “Réserver”. Cette opération associera une adresse IP statique à votre instance, ce qui est probablement ce que vous voulez, sauf si vous souhaitez régénérer les fichiers de configuration de quelque temps. En ce qui concerne les frais, Google ne facture pas les adresses IP statiques pendant leur utilisation. La machine n1-standard-1 ne devrait pas vous coûter plus de 30 $ par mois. Certes, cela coûte un peu plus cher que la plupart des services VPN, mais la plupart des services VPN ne vous donnent pas un contrôle total :)  Vos interfaces réseau doivent ressembler à l’image. Veillez à activer le transfert IP, car cela ne peut plus être modifié après la création de l’instance. En règle générale, vous souhaiterez probablement garder votre adresse IP externe secrète. Cela ne me dérange pas de rendre celui-ci public, car cette instance n’existera pas lorsque vous lirez ce tutoriel, et l’adresse IP appartiendra probablement à quelqu’un d’autre. Appuyez sur “Terminé” et “Créer”. Une fois l’instance prête (un bouton “SSH” noir apparaîtra), cliquez ou double-cliquez sur le bonton “SSH” pour ouvrir une fenêtre SSH. Le reste de la configuration se fera sur cette machine, que nous appellerons le “server”. 2. Installation OpenVPN et EasyRSA OpenVPN est (évidemment) le serveur VPN que nous utilisons, et EasyRSA est un paquet qui nous permettra de configurer une autorité de certification interne à utiliser. Bien que ce ne soit généralement pas le cas, pour cette configuration, il est souvent nécessaire de lancer une mise à jour d’apt pour pouvoir installer un ou les deux packages. Les deux d’entre eux sont dans les dépôts par défaut d’Ubuntu. Temps de configurer. 3. Mise en place du CA Comme OpenVPN utilise TLS/SSL, il a besoin de certificats pour chiffrer le trafic. Pour cela, nous devrons émettre nos propres certificats de confiance, ce que nous pouvons faire à l’aide de la CA que nous sommes sur le point de configurer. Commençons par copier le easy-rsa de modèles du paquet easy-rsa. Il y a des valeurs que nous pouvons vouloir éditer, alors allons-y et nano vars. Si vous voulez utiliser vim, continuez, mais puisque j’essaie de garder mes tutoriels aussi simples que possible, j’utilise nano. À partir de ce moment, s’il y a une partie d’une commande qui dépend d’une valeur que vous choisissez, elle sera en gras. Tout le code qui n’est pas généré par un utilisateur sera en italique. Faites défiler vers le bas du fichier (ce n’est pas trop long) et vous devriez trouver ce qui suit: Éditez autant d’entre eux (ou aucun d’eux) que vous le souhaitez. Juste en dessous de ces valeurs devrait être export KEY_NAME=\"EasyRSA\". Pour simplifier notre configuration, nous allons modifier cette ligne comme suit: Enregistrez et fermez le fichier (ctrl + x, y, entrez). Les variables que nous venons de modifier seront utilisées pour le processus de signature de notre autorité de certification. Toujours dans le openvpn-ca, exécutez la commande suivante: Si vous avez bien fait, le re NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/username/openvpn-ca/keys. C’est ce que nous voulons. Pour assurer un environnement de travail propre, nous allons lancer ./clean-all. Maintenant, construisons le CA Toutes les variables que nous avons déjà définies doivent se renseigner elles-mêmes. Il suffit donc d’y accéder en appuyant plusieurs fois sur Entrée. À la fin, vous aurez une autorité de certification prête à commencer à signer. Nous avons également besoin d’un certificat de serveur et d’une clé de cryptage pour garantir la sécurité de notre trafic. Créons notre certificat de serveur et notre clé. Passer à nouveau les invites de commande. Nous n’entrerons pas un mot de passe, cette fois. Les deux dernières invites vous obligent à entrer y pour signer le certificat. Assurez-vous de ne pas les ignorer! Comme indiqué précédemment, nous avons également besoin d’une clé de chiffrement. Pour les besoins de ce didacticiel, nous allons générer une clé Diffie-Hellman, qui a tendance à être plutôt forte. Bien sûr, une grande force entraîne une grande inefficacité. Par conséquent, quelle que soit votre système, la commande suivante prendra probablement quelques minutes. Nous renforcerons cela avec une signature HMAC, afin de nous assurer que la vérification de l’intégrité TLS est plus sûre. 4. Générer un certificat client Naturellement, si vous allez utiliser une autorité de certification, votre client doit également disposer d’un certificat. Bien que vous puissiez le faire sur votre ordinateur client et que le serveur le signe, nous essayons de garder les choses simples et hébergées sur un seul ordinateur. Si vous avez plusieurs clients, vous pouvez suivre cette étape plusieurs fois. Assurez-vous simplement de rendre vos noms de client uniques. Assurez-vous que vous êtes dans le openvpn-ca et que votre fichier vars est synchronisé. Maintenant, nous allons construire une clé client en tant que telle: Une fois de plus, tout doit être pré-rempli. Passez donc tous les éléments, sauf les deux dernières invites, qui vous demanderont de signer en entrant y. 5. Configurer le serveur OpenVPN OpenVPN s’installe sous le répertoire /etc/openvpn. Pour que tout fonctionne, nous devons déplacer certains fichiers dans ce dossier. Par défaut, OpenVPN est fourni avec un exemple de configuration. Par souci de simplicité, nous simplifierons la décompression dans notre dossier de configuration. Ensuite, nous allons éditer le fichier de configuration: La première étape consiste à trouver la directive tls-auth. Il y aura un point-virgule (;) à côté de la directive, que nous supprimerons. En dessous, nous ajouterons une ligne. Nous devons également chiffrer notre serveur, éditons donc les directives de chiffrement juste en dessous de cette section. Plus précisément, nous décommentons la ligne AES-128-CBC et ajouterons une directive auth. Ensuite, les paramètres d’utilisateur et de groupe: Facultativement, nous pourrions opter pour l’envoi de tout le trafic via le VPN. Pour cela, recherchez la directive redirect-gateway et décommentez-la. Juste en dessous, il devrait y avoir quelques lignes d’dhcp-option. Décommentez ceux-là aussi. Optionnellement, nous pouvons vouloir changer le port et le protocole sur lesquels OpenVPN fonctionne. La valeur par défaut est UDP: 1194, mais si votre réseau bloque les connexions VPN, ce sera probablement l’une des victimes. Le déguisement serait d’utiliser TCP: 443, qui est le port HTTPS. Si vous n’avez pas utilisé «serveur» comme nom de serveur, vos fichiers crt ont un nom différent. Mettez-les à jour en conséquence. Enregistrez et fermez le fichier. 6. Préparer Ubuntu Bien que nous ayons déjà configuré le transfert IP, etc., nous devons apporter quelques modifications pour activer ces options. Recherchez la ligne suivante et supprimez le # (caractère de commentaire). Sauver et fermer. Pour mettre à jour les paramètres de session, exécutez: Ensuite, nous devons trouver et mettre à jour nos règles de pare-feu (UFW) pour masquer les clients. La première étape consiste à trouver l’interface sur laquelle nous fonctionnons: L’interface que nous voulons est celle qui contient le mot “dev”. Dans notre cas, cela ressemble à ceci: Donc, notre interface est ens4. Avec cela, nous mettrons à jour nos règles de pare-feu: Au-dessus, là où il est indiqué Don't delete these required lines... ajoutez le code suivant: Sauver et fermer. Ensuite, nous devons transférer les paquets. Recherchez la directive DEFAULT_FORWARD_POLICY et remplacez-la de \"DROP\" par \"ACCEPT\". Sauver et fermer. 7. Lancer OpenVPN Pour démarrer le serveur, exécutez ce qui suit: Pour vérifier qu’il a bien démarré, lancez: Si tout se passe bien, vous devriez voir une sortie incluant Active: active (running). Vous devrez peut-être q sur q pour quitter le panneau d’informations. Si cela vous convient, liez le service à la séquence de démarrage. 8. Configuration d’une structure de configuration client Pour faciliter la configuration des configurations client, nous allons d’abord créer une structure. Pour commencer, créez un dossier de configuration pour stocker les fichiers de configuration du client. Les clés du client seront dans ces configurations, alors verrouillons les permissions sur le répertoire files. Copiez l’exemple de configuration. Éditons le fichier: Trouvez la directive remote. Remplacez my-server-1 par l’adresse IP externe publique attribuée à votre instance GCE. Si vous avez choisi un port autre que 1194, mettez-le à jour en conséquence. Mettez également à jour votre protocole. Décommentez l’utilisateur et le groupe: Trouvez les directives ca, cert et key, commentez-les, car nos configurations les incluront automatiquement. Utilisez les mêmes paramètres de chiffrement et d’authentification que précédemment: Quelque part, nous devrons ajouter la key-direction. Assurez-vous d’utiliser 1, comme c’est le cas pour le client. 0 était pour le serveur. Si votre configuration client actuelle est (ou sera) utilisée sur un périphérique Linux, ajoutez les éléments suivants: Notez que si vous les incluez dans un environnement non-Linux (Android et macOS inclus dans un non-Linux), vos clients peuvent se comporter de manière étrange. Sauver et fermer. Ensuite, nous devons écrire un script pour générer nos configs client rapidement et facilement. A l’intérieur, collez ce code: gen_config.sh Le {1} fait ici référence au premier argument, qui sera notre nom de client. Assurez-vous de mettre à jour tiv.key fonction du nom de votre clé HMAC. Autoriser l’exécution de ce script: 9. Générer des configurations client Le pas que vous attendiez tous est enfin arrivé. Nous allons générer nos configurations client. Vérifiez que cela a fonctionné en exécutant: Si tel est le cas, il devrait maintenant y avoir un fichier client.ovpn dans ce répertoire. Nous devons télécharger ce fichier et le transférer sur nos appareils. Pour ce faire, cliquez sur l’icône représentant une roue en haut à droite de la session SSH, puis sélectionnez «Télécharger le fichier». Le chemin pleinement qualifié devrait ressembler à ceci: 10. Installation sur les clients Pour Windows, téléchargez l’application client OpenVPN. Une fois installé, déplacez votre fichier client.ovpn vers C:\\Program Files\\OpenVPN\\config. Pour ouvrir OpenVPN, vous devez exécuter l’application en tant qu’administrateur. Une fois à l’intérieur, vous devriez voir et pouvoir vous connecter à votre VPN. Pour macOS, la plupart des gens suggèrent d’utiliser Tunnelblick bien que tout autre client OpenVPN (même s’il soit sans danger) soit probablement bon aussi. Une fois installé, vous devriez pouvoir faire glisser n’importe .ovpn fichier .ovpn sur l’icône Tunnelblick de la barre de menus pour installer la configuration. Utilisez la barre de menus pour vous connecter ensuite au VPN. Si vous êtes interrogé sur le plugin down-root.so, prenez une décision! Je l’ai sauté parce que je suis capable de reconnecter ma connexion, mais c’est à vous de décider. Sous Linux, installez le paquet openvpn en utilisant votre gestionnaire de paquets. Les utilisateurs de CentOS devront d’abord installer epel-release utilisant yum. Une fois installé, lancez ls /etc/openvpn. Si la sortie ne présente pas de fichier update-resolve-conf, vous devez modifier votre fichier .ovpn et supprimer les lignes suivantes (si vous les avez ajoutées): Si vous n’avez jamais ajouté ces lignes mais trouvé un fichier update-resolv-conf, ajoutez-les! Les utilisateurs de CentOS devront modifier le group dans le fichier .ovpn de nogroup à nobody pour se conformer aux normes du système d’exploitation. Pour vous connecter, lancez sudo openvpn — config client .ovpn. Pour iOS, installez l’application OpenVPN Connect. Ensuite, ouvrez iTunes sur votre ordinateur et accédez à iPhone> Applications. Faites défiler jusqu’à la section «Partage de fichiers» et sélectionnez “OpenVPN”. Faites glisser votre fichier .ovpn dans le panneau “OpenVPN Documents”. Ouvrir l’application sur votre téléphone devrait maintenant afficher un message indiquant qu’un nouveau profil est prêt à être importé. Une fois importé, vous devriez pouvoir vous connecter au VPN. Pour Android, installez l’application OpenVPN Connect. Ensuite, transférez votre fichier .ovpn n’importe où / de toute façon sur votre appareil (je viens d’utiliser Google Drive, mais cela peut ne pas être recommandé). Dans l’application, ouvrez le menu et cliquez sur “Importer”. Accédez à votre fichier .ovpn , cliquez dessus, puis appuyez sur “IMPORT” en haut à droite. Une fois terminé, vous devriez pouvoir vous connecter au VPN. Test du VPN Le moyen le plus simple de tester votre VPN serait de Google “quelle est mon adresse IP” avant et après la connexion. Votre adresse IP doit passer à l’adresse IP publique externe de votre instance GCE une fois que vous êtes connecté au VPN, puis à l’adresse IP de votre réseau une fois déconnectée du VPN. Si tout s’est bien passé, c’est tout! Votre nouveau VPN est prêt à être utilisé. Crédits Cet article est basé en grande partie sur ce didacticiel de la communauté DigitalOcean. Bien que la configuration elle-même soit assez similaire, j’ai pensé écrire un article séparé, car il existe quelques éléments clés différents dans GCE et il est assez facile de se tromper si vous le faites pour la première fois (je parle par expérience).","frontmatter":{"title":"Configuration d'un serveur OpenVPN sur Google Compute Engine","subtitle":""},"fields":{"slug":"/openvpn-google/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/openvpn-google/","prev":{"excerpt":"Ces trois fonctions sont utiles pour parcourir une liste (ou un tableau) et effectuer une sorte de transformation ou de calcul. Cela produira alors une nouvelle liste ou le résultat du calcul effectué sur la liste précédente. Les types Avant de plonger dans map, filter et reduce, configurons la liste. types.ts Chaque objet de l’assistant a un nom, une maison et le nombre de points qu’il a gagnés pour sa maison. Déclarons un groupe de magiciens et mettons-les dans une liste. wizards.ts Map Maintenant que nous avons la base, allons-y. La première fonction est la plus simple, map. Map itère (ou boucle) sur une liste, applique une fonction à chaque élément de cette liste, puis renvoie une nouvelle liste d’éléments transformés. Regardons un exemple. wizard-names.ts Cette fonction parcourt la liste des assistants, obtient leur nom et le place dans un nouveau tableau. Le résultat de ceci ressemble à ceci. Dans cet exemple, nous utilisions une fonction lambda (ou fonction anonyme), mais nous pouvons également utiliser une fonction nommée. wizardToString.ts Dans cet exemple, nous avons une fonction appelée wizardToString que nous transmettons directement au map. Il retournera alors une nouvelle liste qui ressemble à ceci. Filter Le filter se comporte comme un map dans la mesure où il itère sur la liste, mais au lieu de transformer chaque élément, il transforme la liste entière. Le filter prend une fonction qui renvoie true ou false ou un prédicat. Il renvoie ensuite une nouvelle liste avec des éléments où le prédicat renvoie true. Regardons un exemple. slytherins.ts Dans cet exemple, nous filtrons par-dessus la liste et n’incluons que les sorciers qui se trouvent dans la maison Serpentard. Le résultat serait ceci. En passant, Taylor et Lin sont deux des Serpentards les plus acclamés de notre époque. Comme avec map, nous n’avons pas besoin d’utiliser un lambda , nous pouvons également utiliser une fonction prédéfinie. winners-losers.ts Dans cet exemple, nous faisons deux listes, la liste des Serpentards ayant gagné des points (gagnants) et la liste des Serpentards ayant perdu des points (perdants). Nous pouvons voir ces résultats ci-dessous. Reduce Nous arrivons maintenant à la fonction la plus intéressante, reduce. Reduce itère sur une liste et produit une valeur unique. Regardons un exemple. Supposons que nous voulions obtenir le nombre total de points pour tous les assistants. Nous pouvons utiliser réduire pour faire cela. Que se passe t-il ici? Bien réduire est une fonction qui prend deux arguments, une fonction et une valeur initiale pour l’accumulateur. L’accumulateur est le nom de la chose réduire les rendements. Dans ce cas, nous commençons le compte de points à 0. Maintenant, la fonction prend l’état actuel de l’accumulateur et de l’élément dans la liste qu’il est supposé traiter. Pour le premier assistant, il passera 0 pour l’accumulateur. Cette fonction retourne ensuite accumulator + points. Cela finira par résumer tous les points. Si vous êtes curieux, le résultat est 5487. Maintenant, l’accumulateur peut être n’importe quoi, on peut même utiliser réduire pour produire un objet. Regardons un exemple où nous additionnons les points pour chaque maison. points-per-house.ts Dans ce cas, nous initialisons notre accumulateur ou acc avec {}. Ensuite, pour chaque assistant, nous appelons une fonction qui ajoute le nombre de points qu’il a gagnés pour sa maison. Si vous êtes curieux, ce résultat ressemble à ceci. Regardons un autre exemple, disons que nous voulons le meilleur assistant pour chaque maison. Nous pouvons modifier notre fonction précédente pour utiliser le meilleur assistant pour chaque maison. Si vous êtes curieux, le résultat est le suivant. Juste un peu plus de plaisir maintenant, nous pouvons utiliser Object.values pour transformer cet map. best-names-per-house.ts Maintenant, nous avons de beaux noms pour la meilleure personne dans chaque maison.","timeToRead":5,"frontmatter":{"title":"Map, filter, reduce","subtitle":"Ces trois fonctions sont utiles pour parcourir une liste (ou un tableau) et effectuer une sorte de transformation ou de calcul.","tags":["Javascript","Node.js"],"category":["Node.js"],"date":"2019-03-03T08:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7777777777777777,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtElEQVQoz2P4cNufbMRAV83vb4EQyZo/3/P/dNf/28OAr/cDIPoZiLQNqPPeaZ9nl3zP7fW6fNDr872A90RqfnvD/8/TwHmTnfpb7VMTLPasdfv2AGQ5sZr/vw2eM8lx8XTn6b2OM/ocifUz0AagVzcsds3LsFq3wGViu0N6kuWLK35AQQYigwroz5M7PN/e9Duwwf3WcR+Qn4l0NjBsgJ78/jDg4x3/n48CvpAU2sjRixzPABStw4O6JhVqAAAAAElFTkSuQmCC","sizes":"(max-width: 1600px) 100vw, 1600px","src":"/static/f10109a249e0ae09b060bb7269f1f4be/9ecf6/js.png","srcSet":"/static/f10109a249e0ae09b060bb7269f1f4be/4c9af/js.png 930w,\n/static/f10109a249e0ae09b060bb7269f1f4be/9ecf6/js.png 1600w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/js-map-filter-reduce/"}},"next":{"excerpt":"Principales commandes SQL/PostgreSQL que vous avez besoin de connaître. Ici, nous allons passer en revue les commandes les plus importantes et les plus élémentaires que vous devez connaître pour créer, gérer et supprimer vos données sur votre base de données. Outre les commandes ici, j’utilise la syntaxe PostgreSQL. La plupart des bases de données relationnelles partagent les mêmes concepts. En apprenant cela, vous pourrez créer et gérer votre base de données. Ce sont les commandes que vous pouvez vous attendre à apprendre ici: [toc] Create table Créons notre premier client: Creusons par étapes: Créez la table avec le nom CREATE TABLE <NAME> (qui pour nous est “customer”). Ajoutez les colonnes et le type de données approprié, comme l’email CHARACTER(255) C’est simple, nous n’entrerons pas dans le type de données que ous pourrions utiliser, car il est long et peut changer de base de données à une autre base de données, l’idée est d’apprendre le principe. Insert Nous passons maintenant à notre premier tableau et vous souhaitez maintenant à notre premier tableau et vous souhaitez maintenant ajouter des informations, sinon quel est le but, pour cela, vous lancerez cette commande: Le code parle tout seul, nous voulons ajouter <INSERT INTO> notre table appelée “customer” pour la colonne portant le nom de clé “name” et “age” les VALUES suivant l’ordre, nommez ”Felipe” et l’âge 31. Alter Table Il est normal que vous créiez votre base de données et que vous commenciez par la base, puis que vous commenciez à vous améliorer, et avec la commande, vous puissiez modifier la structure de la table. Mais bien sûr, ce n’est pas illimité si vous essayez de modifier des données existantes et susceptibles de provoquer un conflit, comme le passage d’un nombre entier à une chaîne . Comme vous pouvez le constater, nous ajoutons une nouvelle COLUMN avec le nom height et le type INTEGER.  Cette commande a beaucoup d’autres propriétés, vous pouvez donc consulter la documentation afin de voir toutes les autres variations. Update  Nous avons ajouté des données à l’intérieur, mais considérons que vous avez commis une erreur ou, en fait, que vous souhaitez simplement mettre à jour, car c’est l’idée, pouvoir conserver des données et les manipuler. Ce sera utile non? Comme nous venons de modifier notre table et que nous ne voulons pas avoir de valeur vide pour une raison quelconque, nous faisons un UPDATE sur notre table client avec cette commande et SET la hauteur pour que tout le monde soit à 0, comme une valeur par défaut. Mais je ne veux pas faire cela à tout le monde, bien sûr, alors ce qui suit est plus spécifique. Nous avons fait la même chose qu’avant, à la différence que nous utilisons une nouvelle clause WHERE préciser ce que nous voulons changer, je parlerai plus en détail de cette question. Pour le moment, il vous suffit de comprendre que, si vous utilisez cette clause, je valide si “name” correspond au nom, et seulement s’il est vrai, je mets à jour les valeurs. Et ce genre de validation est vraiment important, et parce que ceci est une autre façon de faire avec encore plus de “validations”. Nous avons deux différences importantes où, voyons: Notre clause WHERE a maintenant une autre clause appelée AND , et cela nous permet de “concaténer” deux valeurs que nous voulons vérifier, nous disons que les deux doivent correspondre pour que notre validation soit réussie . Il est important de noter qu’ils sont à l’intérieur de ”()”, il s’agit en quelque sorte de “retenir” en tant que valeur ou contrainte , nous vérifions en gros ce qui est à l’intérieur qui donnera le “résultat” qui sera vrai ou faux . Le second est OR et correspond exactement à ce que suggère le “nom”. Si notre clause WHERE ne convient pas, nous vérifions celle-ci. Upsert En plus du nom qui a l’air bizarre, cette commande est très utile, car nous parlons de mise à jour, l’un des scénarios les plus courants consiste à vouloir mettre à jour quelque chose qui existe déjà, mais comment savez-vous qu’il existe déjà? Pour cela, vous pouvez généralement penser, commencez par vérifier s’il existe et si vous utilisez la commande update, non? Mais en réalité vous savez déjà ce que vous voulez, vous voulez que si cette valeur est déjà mise à jour. PostgreSQL implémente cela il n’y a pas si longtemps, comme d’autres bases de données l’avaient déjà assez longtemps, voyons comment implémenter l’utilisation de Postgres. Vous devez d’abord savoir que nous disposons de deux contraintes que nous pouvons utiliser pour “dire” ce que nous voulons faire si cette valeur existe déjà. ON CONFLICT DO NOTHING ON CONFLICT DO UPDATE Par le nom, vous pouvez déjà imaginer ce qui se passe, lors de la mise à jour si vous trouvez un “conflit” avec un autre, ne faites rien. Regardons comment utiliser ON CONFLICT DO NOTHING : En gros, ce qui va se passer n’est rien, si la base de données trouve déjà une valeur, ne fait rien. D’autre part pour ON CONFLICT DO UPDATE : Voici exactement ce que dit le nom, si vous trouvez un conflit, mettez-le à jour. Il est simple d’utiliser ce scénario lorsque vous savez que vous souhaitez mettre à jour lorsque vous avez la même valeur. Rappelez-vous que l’implémentation change légèrement pour chaque base de données, mais qu’il est important de connaître le concept, il suffit de regarder sur Internet le nom de contrainte spécifique de votre base de données. Select Maintenant que nous avons en principe commencé le début en suivant une méthode logique, comme créer votre base de données, mettre à jour, supprimer, la plupart des bases afin de configurer votre base de données, nous devons obtenir les données. Très probablement, ce sera l’une des commandes les plus utilisées par vous, alors voyons-le. La base est très simple, allons-y étape par étape: SELECT * - Ce que vous faites est de dire “je veux” (SELECT) tout (*); FROM - D’où je veux (FROM) c’est à partir du nom de la table (customer). Ici, je reçois tout ce qui se trouve dans ma table client, soyons plus précis. Maintenant que vous avez déjà compris comment vous créez, vous avez probablement compris que nous voulions des données spécifiques, à savoir les données des colonnes “height” et “name” de ma table customer . Cette contrainte offre de nombreuses autres possibilités dont vous avez absolument besoin dans la documentation pour pouvoir visualiser toutes les autres variantes. Un de plus, est pour la situation que vous ne voulez pas réellement sélectionner par le nom de la colonne, mais si elle correspond à la valeur, essayez ceci: Comme je l’ai dit, nous rechercherons des données dans la colonne “hauteur” et toutes les valeurs correspondant à la chaîne “Felipe” en regard du nom de la colonne correspondante. Where Cette contrainte est une autre que vous utiliserez encore plus avec la contrainte SELECT . Voyons comment nous utilisons, vous utiliserez ceci pour filtrer ce que vous voulez lors de la sélection de vos données. Comme vous pouvez le constater, nous recherchons la taille du client et WHERE la “height” est supérieure à 50 . Mais vous pouvez ajouter encore plus de contraintes (filtres). Nous avons ajouté ici une nouvelle contrainte AND qui fait exactement ce que son nom suggère, qui doit être plus haut que 50 ET inférieur à 80. Une autre contrainte que nous pouvons utiliser est OR. Ici nous avons ajouté une autre contrainte OR cela signifie que si notre vérification “précédente” ne correspond pas comme son nom l’indique “OU”, nous retournons sous forme de correspondance. Join C’est certainement un sujet très important, non seulement parce que dans un entretien d’embauche, ils vous le demanderont certainement, mais aussi parce qu’il y a beaucoup de possibilités. Même si la première fois que vous essayez de comprendre, ça a l’air bizarre. Pour cela nous avons 5 types: CROSS JOIN INNER JOIN LEFT JOIN RIGHT JOIN FULL JOIN Je vais essayer d’expliquer de la manière la plus simple, mais je vous recommande d’essayer cela en direct. Lorsque vous le ferez, vous comprendrez mieux et vous verrez comme cela est facile. Pour cela, nous avons besoin de quelques données pour pouvoir visualiser. Pour cela, je vais mettre une donnée à insérer, je reconnais que vous savez déjà comment créer une table. Nous aurons notre client et la table de contact . Nos données clients: Et pour nos coordonnées: Vous devez juste exécuter ceci sur votre table déjà créée et l’insérer. Cross join Je dirais que vous n’utiliserez pas trop celle-ci, car elle peut générer beaucoup de données. En gros, il joint ici les deux tables et génère une sortie avec toutes les données. La façon dont cette contrainte fonctionne consiste à renvoyer des données de produit cartésiennes entre les deux tables. Cette commande multiplie la première table par la quantité de données de la seconde table. Elle renverra toujours la combinaison possible. Je crois que vous pouvez imaginer combien de données cela peut créer, non?! Il est facile de voir la représentation de la façon dont cette requête sera traitée à partir de cette image, mais cela ne correspond pas seulement:  Allons à la commande: Je n’ajouterai pas une impression de la sortie complète ici, car elle est trop grande, mais cette opération générera un total de 36 éléments/lignes, c’est-à-dire la multiplication entre le premier client de la table ayant 9 éléments multiplié par la table de contacts contenant 4 Mais une information précieuse ici est que, avec cela, nous allons générer une sortie qui contient toutes les lignes de la première table et toutes les lignes de la seconde:  Et pourquoi répéter table? Eh bien, nous avons SELECT *, nous avons choisi d’obtenir toutes les données des deux, mais montrons-leur comment ne pas répéter ou, mieux, comment choisir la ligne de sortie que nous voulons. Utilisez cette requête: Une partie de la sortie:  Si vous faites attention, ce que nous avons fait était de dire comment sera généré, en spécifiant la ligne que nous voulons et d’où customer.\"name\" et contact.zip_code afin que la sortie suive cet ordre. Je n’ai pas ajouté la “fin” de cette requête, ni même la précédente, mais parlons du concept de “jointure”, nous cherchons fondamentalement une correspondance, mais pour cette contrainte, nous “obtenons tout” à partir d’une table et “Tout à partir de” deuxième table, mais dans le type CROSS si un élément ne correspond pas retournera quand même, mais s’il n’y a pas de correspondance, la valeur sera vide.  Parce que si vous faites attention à notre table de contact pour l’utilisateur “felipe@gmail.com ”, il n’y a pas de correspondance avec personne à la table des clients , mais sera quand même retournée. Inner join Maintenant que nous savons déjà quelque chose de base concernant ce que nous pouvons faire en matière de jointure , passons à la suivante, qui ressemble beaucoup à la jointure croisée, mais avec une simple différence qu’ici ne renverra que des correspondances. C’est la représentation du type de jointure que nous faisons ici entre les tables, car vous ne voyez que le “centre” qui correspond à ce que nous aurons comme données.  Ici, la syntaxe est un peu différente, nous devons ajouter une contrainte supplémentaire, celle qui recherchera la ligne “validateur “. La principale différence que nous avons ici est que nous allons rechercher une correspondance en utilisant la table client et la table de contact , pour cela nous utiliserons la ligne “zip_code “. C’est ce que vous aurez comme récupération de données.  Il est facile de voir que lorsque nous retournons toutes les cellules, nous avons le code postal de la cellule du client et du contact , toutes les correspond. Cette jointure est très utile pour récupérer des données que vous souhaitez faire correspondre à une valeur spécifique, différente de la relation ay. Left joint Comme vous le savez peut-être, l’objectif principal est de faire correspondre les données et, si les données correspondent, nous renvoyons cette ligne. Vous pouvez voir ici que nous avons au centre la partie jointure , c’est-à-dire le validateur, et la partie gauche qui signifie que si la jointure ne correspond pas, les données seront renvoyées mais avec la ligne pour les données qui ne correspond pas “vide”.  Mais ici maintenant, nous commençons à faire les choses différemment. Voyons en quoi consiste cette requête: La “transcription” de ce que nous demandons ici est la suivante: nous voulons toutes les données de LEFT qui, dans notre scénario, sont des clients , et nous voulons uniquement contacter la table celles qui correspondent à notre validation. En faisant cela, vous devriez avoir ces données comme résultat de cette requête:  Right join Maintenant que nous avons déjà vu comment il est laissé joindre cela n’est pas différent, la seule différence est que nous voulons maintenant que le côté “droit” soit la table principale. Cela signifie que nous renverrons toutes les données de la table droite même si elles ne correspondent pas. Bien sûr ce qui n’a pas de correspondance est vide.  Question: Mais il est important de ne pas se méprendre pour obtenir toutes les données de droite ou de gauche avec uniquement la quantité exacte de données dont nous disposons à cette table spécifique. Ce que je veux dire par là, c’est que pour cette jointure, nous voulons “tout” du côté droit, c’est notre table de contact qui contient 4 éléments que nous avons ajoutés, et voici le résultat:  Nous avons 6 éléments et non 4, mais rappelez-vous, ce n’est pas une requête de “tout renvoyer d’un côté s’il y a correspondance ”, c’est une requête qui renvoie tout d’ un “côté” qui correspond, nous avons 2 correspondances pour le code postal 3423PO , c’est un match alors revenez. Full join Maintenant le dernier, qui ressemble à la jointure croisée, la différence ici est que nous recherchons une correspondance et non un produit cartésien comme la jointure croisée. Nous chercherons la jointure dans toute la zone bleue, en validant fondamentalement les deux côtés en fonction de notre contrainte de “validation”, qui dans notre scénario est zip_code.  La jointure complète combine les deux tables, les données gauche et droite, et renvoie toutes les correspondances et toutes les correspondances , regardons la requête Voici ce que nous aurons comme retour:  Ici, nous suivons le même principe que les “jointures” avant, c’est ce qui n’a pas de correspondance nous avons encore les données, mais “vide” Union Cette commande est très utile, car il est question d’obtenir des données à partir de 2 tables, mais ne confondez bien sûr pas les deux. Ce que fait Union, c’est que nous allons combiner les données des deux côtés, mais que nous ne renverrons que des données “uniques” entre les deux, si “identiques” ne renvoient pas les doublons, par exemple, c’est ce qui se produit avec join. C’est la requête que nous utilisons: C’est ce que nous aurons comme retour:  Comme vous pouvez le constater, nous spécifions les colonnes que nous voulons, ce qui est obligatoire, car nous devons préciser lesquelles sont “égales” afin qu’il puisse comparer et renvoyer des éléments uniques entre les deux. Une chose importante concernant cette commande est qu’il opère de manière très efficace, cela signifie que l’ordre peut changer. Order C’est une contrainte très utile pour organiser les données que vous demandez. Par conséquent, nous ne “filtrons” pas les données. En fait, il organise votre réponse en fonction de certains critères. Simplement, ordonnons notre requête en fonction de l’âge de nos clients: Et voici la réponse à laquelle vous devez vous attendre:  Alias Ceci n’est pas destiné à interroger quelque chose ou quelque chose comme ça, c’est juste un moyen de vous aider à organiser le nom d’une table, c’est simplement un surnom . La syntaxe de base est la suivante: Et vous devriez obtenir quelque chose comme ça:  Séparons pour chaque partie, d’abord ce que nous avons fait, nous sélectionnons ce que nous voulons, mais si vous faites attention, nous ajoutons un caractère ”A” avant le nom de la colonne , dans notre nom de scénario et code postal . Mais nous devons dire à notre code SQL ce que ce personnage ou “pseudo” signifie, n’est-ce pas?! Et nous le faisons après, lorsque nous disons FROM customer A, nous disons ici comment SQL devrait interpréter cette lettre, ce devrait être l’alias du client . Vous pouvez également le faire lorsque vous avez plusieurs tables, par exemple: Vous pouvez voir que les deux sont “identiques”, mais nous renommons pour avoir un autre alias. Une autre chose que vous pouvez faire est de “changer” le nom de la table que vous retournez, par exemple: Si vous voyez ici, j’ai utilisé deux formats d’alias, pour le premier, je n’utilise pas l’alias pour savoir quelle colonne est, mais ce que je veux, c’est que le retour de cette colonne soit appelé “Âge de la personne” et le second est l’alias façon de l’appel que nous avons déjà appris, c’est le résultat.  Delete Comme son nom l’indique, il s’agit d’une suppression, et je n’ai pas besoin de vous avertir qu’il s’agit d’une commande très “dangereuse”, alors faites attention, je vais montrer 2 syntaxe de base: Vous avez peut-être remarqué que nous ne spécifions aucune donnée particulière. Nous allons donc tout supprimer, c’est simple, mais nous souhaitons supprimer une donnée spécifique. Pour cela, procédez comme suit: Ici, je dirais que la façon la plus sûre de faire, utilisez une personne spécifique. Drop table Le sujet est sur la suppression, continuons avec ceci, la commande précédente est de supprimer les données d’une table / colonne, maintenant nous allons continuer, mais avec un autre type de suppression, celle qui supprime la table ou la supprime. C’est simple comme ça, mais vous devez être encore plus prudent que la commande delete . Ici, vous allez laisser tomber la table des trous et il n’y a aucun moyen de récupérer. Une autre différence majeure est que cela ne devrait pas être utilisé dans votre “programme”. Cette commande ne devrait être utilisée que par la commande de terminal lorsque vous savez ce qui doit être fait ou supprimé.","timeToRead":17,"frontmatter":{"title":"Principales commandes SQL/PostgreSQL que vous avez besoin de connaître","subtitle":"","tags":["SQL","PostgreSQL"],"category":["Database"],"date":"2019-04-14T08:00:00.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7777777777777777,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz2P4jwT+/fsHJB8/ftw9Z/WMFdsmL9nYPW9d66zVs1ds/vL5E1wBHDD8Rwd/ZyzbqJXYF9uxyrlktnZSf3THGuf8SYeOngDJ/f2LV/O/39OWbTbOmJTRtyarf5117tTSmdvSOpedPH2WgGaI3K4DRywzJwQ1LAuuX2yfPz2uc3XfvNWfPrwj4GyI3LMnj/xLJsbXzWxfuE03eUJ8+4rJsxddvXqFsLP/AvX/+3fg8LHV6zctWLVJP21iYuPsM2dOv/vwgZgAg7gfpOjS5atGyd1N05f///8bqzJ0zdevX799+/bTp08fPHj45MnTRctXHz194cHLDzcevfqD6mYsmk+fPr1v377169dv27Zt69ZtO7dvPXb28pErD7ccu/bq/ReQy/E7+/fv38CA+f79+7Nnz/6BAdDOn7/+ELYZovo/cQAAExNKPTC47rUAAAAASUVORK5CYII=","sizes":"(max-width: 1600px) 100vw, 1600px","src":"/static/769fd2188f26939bc5770b83a10e20f3/9ecf6/postgres.png","srcSet":"/static/769fd2188f26939bc5770b83a10e20f3/4c9af/postgres.png 930w,\n/static/769fd2188f26939bc5770b83a10e20f3/9ecf6/postgres.png 1600w"}}},"author":{"id":"ludo","bio":"Développeur senior. Fullstack + DevOps","avatar":{"children":[{"fixed":{"src":"/static/5f2c129e42248a92c87b13b4293950cf/4e842/ghost.png"}}]}}},"fields":{"layout":"post","slug":"/sql-principes/"}},"primaryTag":"Google Cloud","primaryCategory":"Cloud"}}}